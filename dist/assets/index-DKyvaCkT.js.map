{"version":3,"file":"index-DKyvaCkT.js","sources":["../../src/js/constants.js","../../src/js/api.js","../../src/js/models/story-model.js","../../src/js/map.js","../../src/js/presenters/home-presenter.js","../../src/js/utils/dom.js","../../src/js/db.js","../../src/js/views/home.js","../../src/js/utils/auth.js","../../src/js/views/landing.js","../../src/js/views/stories.js","../../src/js/notification.js","../../src/js/presenters/add-story-presenter.js","../../src/js/camera.js","../../src/js/views/add-story.js","../../src/js/presenters/detail-presenter.js","../../src/js/views/detail.js","../../src/js/presenters/login-presenter.js","../../src/js/views/login.js","../../src/js/presenters/register-presenter.js","../../src/js/views/register.js","../../src/js/views/subscribe.js","../../src/js/views/favorites.js","../../src/js/views/about.js","../../src/js/views/not-found.js","../../src/js/utils/transition.js","../../src/js/router.js","../../src/js/utils/performance.js","../../src/js/utils/error-handler.js","../../src/js/utils/analytics.js","../../src/js/utils/accessibility.js","../../src/js/main.js"],"sourcesContent":["// src/js/constants.js\n\n// =======================================================\n// KONFIGURASI SUDAH BENAR: Arahkan URL ke path proxy\n// =======================================================\n// URL ini akan di-intercept oleh Vite Dev Server dan diteruskan ke API Dicoding\nexport const BASE_URL = \"/api/v1\";\n\n// VAPID key Anda untuk push notifications\nexport const VAPID_PUBLIC_KEY =\n  \"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk\";\n","// src/js/api.js - Enhanced API with Push Notification endpoints\nimport { BASE_URL } from \"./constants.js\";\n\nasync function handleResponse(response) {\n  const data = await response.json();\n  if (!response.ok) {\n    const errorMessage = data.message || `Server error: ${response.status}`;\n    throw new Error(errorMessage);\n  }\n  return data;\n}\n\nexport async function register({ name, email, password }) {\n  try {\n    if (!name || typeof name !== \"string\" || name.trim().length === 0) {\n      throw new Error(\"Nama tidak boleh kosong\");\n    }\n    if (!email || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n      throw new Error(\"Email tidak valid\");\n    }\n    if (!password || password.length < 8) {\n      throw new Error(\"Password harus minimal 8 karakter\");\n    }\n\n    console.log(\"Mengirim data registrasi:\", { name, email, password });\n\n    const response = await fetch(`${BASE_URL}/register`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ name, email, password }),\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (register):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error registering:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\nexport async function login({ email, password }) {\n  try {\n    if (!email || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n      throw new Error(\"Email tidak valid\");\n    }\n    if (!password || password.length < 8) {\n      throw new Error(\"Password harus minimal 8 karakter\");\n    }\n\n    console.log(\"Mengirim data login:\", { email, password });\n\n    const response = await fetch(`${BASE_URL}/login`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ email, password }),\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (login):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error logging in:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\nexport async function addStory({ description, photo, lat, lon, token }) {\n  try {\n    if (!description || description.trim().length === 0) {\n      throw new Error(\"Deskripsi tidak boleh kosong\");\n    }\n    if (!photo) {\n      throw new Error(\"Foto wajib diunggah\");\n    }\n    if (!token) {\n      throw new Error(\"Token tidak ditemukan, silakan login terlebih dahulu\");\n    }\n\n    const formData = new FormData();\n    formData.append(\"description\", description);\n    formData.append(\"photo\", photo);\n    if (lat && lon) {\n      formData.append(\"lat\", lat);\n      formData.append(\"lon\", lon);\n    }\n\n    console.log(\"Mengirim data cerita:\", { description, lat, lon, token });\n\n    const response = await fetch(`${BASE_URL}/stories`, {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n      body: formData,\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (addStory):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error adding story:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\nexport async function addGuestStory({ description, photo, lat, lon }) {\n  try {\n    if (!description || description.trim().length === 0) {\n      throw new Error(\"Deskripsi tidak boleh kosong\");\n    }\n    if (!photo) {\n      throw new Error(\"Foto wajib diunggah\");\n    }\n\n    const formData = new FormData();\n    formData.append(\"description\", description);\n    formData.append(\"photo\", photo);\n    if (lat && lon) {\n      formData.append(\"lat\", lat);\n      formData.append(\"lon\", lon);\n    }\n\n    console.log(\"Mengirim data cerita guest:\", { description, lat, lon });\n\n    const response = await fetch(`${BASE_URL}/stories/guest`, {\n      method: \"POST\",\n      body: formData,\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (addGuestStory):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error adding guest story:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\nexport async function getStories({ token, page = 1, size = 10, location = 0 }) {\n  try {\n    if (!token) {\n      throw new Error(\"Token tidak ditemukan, silakan login terlebih dahulu\");\n    }\n\n    const params = new URLSearchParams({ page, size, location });\n    console.log(\"Mengambil daftar cerita dengan params:\", params.toString());\n\n    const response = await fetch(`${BASE_URL}/stories?${params}`, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (getStories):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error getting stories:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\nexport async function getStoryDetail(id, token) {\n  try {\n    if (!id) {\n      throw new Error(\"ID cerita tidak boleh kosong\");\n    }\n    if (!token) {\n      throw new Error(\"Token tidak ditemukan, silakan login terlebih dahulu\");\n    }\n\n    console.log(\"Mengambil detail cerita dengan ID:\", id);\n\n    const response = await fetch(`${BASE_URL}/stories/${id}`, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (getStoryDetail):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error getting story detail:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\n// Enhanced Push Notification API functions\nexport async function subscribeNotifications(subscription, token) {\n  try {\n    if (!subscription) {\n      throw new Error(\"Data subscription tidak boleh kosong\");\n    }\n    if (!token) {\n      throw new Error(\"Token tidak ditemukan, silakan login terlebih dahulu\");\n    }\n\n    // Clean subscription object - remove expirationTime and other browser-specific fields\n    const cleanSubscription = {\n      endpoint: subscription.endpoint,\n      keys: {\n        p256dh: subscription.keys.p256dh,\n        auth: subscription.keys.auth,\n      },\n    };\n\n    console.log(\"Mengirim data subscription ke server:\", cleanSubscription);\n\n    const response = await fetch(`${BASE_URL}/notifications/subscribe`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${token}`,\n      },\n      body: JSON.stringify(cleanSubscription),\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (subscribeNotifications):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error subscribing to notifications:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\nexport async function unsubscribeFromNotifications(endpoint, token) {\n  try {\n    if (!endpoint) {\n      throw new Error(\"Endpoint tidak boleh kosong\");\n    }\n    if (!token) {\n      throw new Error(\"Token tidak ditemukan, silakan login terlebih dahulu\");\n    }\n\n    console.log(\"Menghapus subscription dengan endpoint:\", endpoint);\n\n    const response = await fetch(`${BASE_URL}/notifications/subscribe`, {\n      method: \"DELETE\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${token}`,\n      },\n      body: JSON.stringify({ endpoint }),\n    });\n\n    const data = await handleResponse(response);\n    console.log(\"Respons dari server (unsubscribeFromNotifications):\", data);\n    return data;\n  } catch (error) {\n    console.error(\"Error unsubscribing from notifications:\", error.message);\n    throw new Error(error.message);\n  }\n}\n\n// Trigger notification for new story (example implementation)\nexport async function triggerStoryNotification(storyData, token) {\n  try {\n    if (!token) {\n      throw new Error(\"Token tidak ditemukan, silakan login terlebih dahulu\");\n    }\n\n    const notificationPayload = {\n      title: \"New Story Added!\",\n      body: `${storyData.name} just shared a new story: ${storyData.description.substring(0, 50)}...`,\n      data: {\n        storyId: storyData.id,\n        url: `/#/detail/${storyData.id}`\n      }\n    };\n\n    console.log(\"Triggering story notification:\", notificationPayload);\n\n    const response = await fetch(`${BASE_URL}/notifications/trigger`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${token}`,\n      },\n      body: JSON.stringify(notificationPayload),\n    });\n\n    // Note: This endpoint might not exist in the actual API\n    // This is an example of how you would trigger notifications\n    if (response.ok) {\n      const data = await response.json();\n      console.log(\"Notification triggered successfully:\", data);\n      return data;\n    } else {\n      console.warn(\"Notification trigger endpoint not available\");\n      return null;\n    }\n  } catch (error) {\n    console.error(\"Error triggering story notification:\", error.message);\n    // Don't throw error here as this is not critical functionality\n    return null;\n  }\n}","// src/js/models/story-model.js\nimport { getStories, getStoryDetail, addStory, addGuestStory } from \"../api.js\"; // dari src/js/models/ ke src/js/api.js\n\nexport default class StoryModel {\n  async getStories({ token, page = 1, size = 10, location = 1 }) {\n    const response = await getStories({ token, page, size, location });\n    if (response.error) throw new Error(response.message);\n    return response.listStory;\n  }\n\n  async getStoryDetail(id, token) {\n    const response = await getStoryDetail(id, token);\n    if (response.error) throw new Error(response.message);\n    return response.story;\n  }\n\n  async addStory({ description, photo, lat, lon, token }) {\n    const response = await addStory({ description, photo, lat, lon, token });\n    if (response.error) throw new Error(response.message);\n    return response;\n  }\n\n  async addGuestStory({ description, photo, lat, lon }) {\n    const response = await addGuestStory({ description, photo, lat, lon });\n    if (response.error) throw new Error(response.message);\n    return response;\n  }\n}\n","// src/js/map.js\nimport L from \"leaflet\";\n\nexport function initMap(containerId, lat = -6.2, lon = 106.8, zoom = 13) {\n  const map = L.map(containerId).setView([lat, lon], zoom);\n  L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n    attribution:\n      '© <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  }).addTo(map);\n  return map;\n}\n\nexport function addMarker(map, lat, lon, popupText) {\n  const marker = L.marker([lat, lon]).addTo(map);\n  if (popupText) {\n    marker.bindPopup(popupText).openPopup();\n  }\n  return marker;\n}\n\nexport function onMapClick(map, callback) {\n  map.on(\"click\", (e) => {\n    const { lat, lng } = e.latlng;\n    callback(lat, lng);\n  });\n}","// src/js/presenters/home-presenter.js\nimport StoryModel from \"../models/story-model.js\"; // dari src/js/presenters/ ke src/js/models/story-model.js\nimport { initMap, addMarker } from \"../map.js\"; // dari src/js/presenters/ ke src/js/map.js\n\nexport default class HomePresenter {\n  constructor(view) {\n    this.view = view;\n    this.model = new StoryModel();\n  }\n\n  async loadStories() {\n    try {\n      const token = localStorage.getItem(\"token\");\n      if (!token) {\n        this.view.showMessage(\"Silakan login terlebih dahulu!\", () => {\n          window.location.hash = \"#/login\";\n        });\n        return;\n      }\n\n      const response = await this.getStories(token);\n      if (response.error) {\n        throw new Error(response.message);\n      }\n\n      this.view.displayStories(response);\n    } catch (error) {\n      this.view.showMessage(`Gagal memuat cerita: ${error.message}`, () => {\n        this.loadStories();\n      });\n    }\n  }\n\n  async getStories(token) {\n    return await this.model.getStories({\n      token,\n      page: 1,\n      size: 10,\n      location: 1,\n    });\n  }\n\n  initMap(containerId, lat, lon, popupText) {\n    if (lat && lon) {\n      const map = initMap(containerId, lat, lon, 13);\n      addMarker(map, lat, lon, popupText);\n    }\n  }\n}\n","// src/js/utils/dom.js\nexport function createElement(tag, attributes = {}) {\n  const element = document.createElement(tag);\n  Object.entries(attributes).forEach(([key, value]) => {\n    element.setAttribute(key, value);\n  });\n  return element;\n}\n","import { openDB } from 'idb';\n\nconst DB_NAME = 'story-app-db';\nconst DB_VERSION = 1;\nconst STORY_STORE = 'stories';\n\nexport async function initDB() {\n  const db = await openDB(DB_NAME, DB_VERSION, {\n    upgrade(db) {\n      if (!db.objectStoreNames.contains(STORY_STORE)) {\n        const storyStore = db.createObjectStore(STORY_STORE, { keyPath: 'id' });\n        storyStore.createIndex('createdAt', 'createdAt');\n      }\n    },\n  });\n  return db;\n}\n\nexport async function saveStories(stories) {\n  const db = await initDB();\n  const tx = db.transaction(STORY_STORE, 'readwrite');\n  await Promise.all([\n    ...stories.map(story => tx.store.put(story)),\n    tx.done\n  ]);\n}\n\nexport async function getStoredStories() {\n  const db = await initDB();\n  return db.getAllFromIndex(STORY_STORE, 'createdAt');\n}\n\nexport async function deleteStory(id) {\n  const db = await initDB();\n  await db.delete(STORY_STORE, id);\n}\n\nexport async function clearStories() {\n  const db = await initDB();\n  await db.clear(STORY_STORE);\n}","// src/js/views/home.js\nimport HomePresenter from \"../presenters/home-presenter.js\";\nimport { createElement } from \"../utils/dom.js\";\nimport { saveStories } from \"../db.js\";\n\nexport default class HomeView {\n  constructor() {\n    this.presenter = new HomePresenter(this);\n  }\n\n  async init() {\n    const content = createElement(\"div\", { \n      class: \"home-container\",\n      role: \"region\",\n      \"aria-label\": \"Daftar cerita\"\n    });\n    \n    content.innerHTML = `\n      <h2 id=\"story-list-title\">Daftar Cerita</h2>\n      <div \n        id=\"story-list\" \n        role=\"feed\" \n        aria-labelledby=\"story-list-title\"\n        class=\"stories-container\"\n      ></div>\n    `;\n    \n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    await this.presenter.loadStories();\n  }\n\n  displayStories(stories) {\n    const storyList = document.getElementById(\"story-list\");\n    storyList.innerHTML = \"\";\n    \n    stories.forEach((story) => {\n      const storyItem = createElement(\"div\", { \n        class: \"story-item\",\n        role: \"article\"\n      });\n      \n      storyItem.innerHTML = `\n        <h3>${story.name}</h3>\n        <p>${story.description}</p>\n        <img \n          src=\"${story.photoUrl}\" \n          alt=\"Foto untuk cerita: ${story.description.substring(0, 50)}...\" \n          loading=\"lazy\"\n          class=\"story-image\"\n        >\n        <p>Dibuat pada: ${new Date(story.createdAt).toLocaleDateString('id-ID', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric'\n        })}</p>\n        ${\n          story.lat && story.lon\n            ? `<div \n                id=\"map-${story.id}\" \n                class=\"story-map\" \n                role=\"complementary\" \n                aria-label=\"Lokasi cerita di peta\"\n              ></div>`\n            : \"\"\n        }\n        <div class=\"story-actions\">\n          <a \n            href=\"#/detail/${story.id}\" \n            class=\"detail-link\"\n            aria-label=\"Lihat detail cerita dari ${story.name}\"\n          >Lihat Detail</a>\n          <button \n            class=\"save-favorite-btn\" \n            data-story='${JSON.stringify(story).replace(/'/g, \"&apos;\")}'\n            aria-label=\"Simpan ke favorit\"\n          >\n            ❤️ Simpan ke Favorit\n          </button>\n        </div>\n      `;\n      \n      storyList.appendChild(storyItem);\n\n      if (story.lat && story.lon) {\n        this.presenter.initMap(\n          `map-${story.id}`,\n          story.lat,\n          story.lon,\n          story.name\n        );\n      }\n    });\n\n    // Add event listeners for save buttons\n    document.querySelectorAll('.save-favorite-btn').forEach(btn => {\n      btn.addEventListener('click', async (e) => {\n        const storyData = JSON.parse(e.target.dataset.story.replace(/&apos;/g, \"'\"));\n        await this.saveFavorite(storyData);\n      });\n    });\n  }\n\n  async saveFavorite(story) {\n    try {\n      await saveStories([story]);\n      this.showMessage(\"Cerita berhasil disimpan ke favorit!\");\n    } catch (error) {\n      this.showMessage(`Gagal menyimpan cerita: ${error.message}`);\n    }\n  }\n\n  showMessage(message, retryCallback) {\n    const storyList = document.getElementById(\"story-list\");\n    if (retryCallback) {\n      storyList.innerHTML = `\n        <div role=\"alert\">\n          <p>${message}</p>\n          <button id=\"retry-btn\" class=\"retry-button\">Coba Lagi</button>\n        </div>\n      `;\n      \n      document\n        .getElementById(\"retry-btn\")\n        .addEventListener(\"click\", retryCallback);\n    } else {\n      alert(message);\n    }\n  }\n}","// src/js/utils/auth.js\nexport function saveToken(token) {\n  localStorage.setItem(\"token\", token);\n}\n\nexport function getToken() {\n  return localStorage.getItem(\"token\");\n}\n\nexport function removeToken() {\n  localStorage.removeItem(\"token\");\n}\n","// src/js/views/landing.js\nimport { createElement } from \"../utils/dom.js\";\nimport { getToken } from \"../utils/auth.js\";\n\nexport default class LandingView {\n  constructor() {\n    this.installPrompt = null;\n  }\n\n  async init() {\n    const token = getToken();\n    \n    const content = createElement(\"div\", { \n      class: \"landing-container\",\n      role: \"main\"\n    });\n    \n    content.innerHTML = `\n      <section class=\"hero-section\">\n        <div class=\"hero-content\">\n          <h1 class=\"hero-title\">Share Your Stories</h1>\n          <p class=\"hero-subtitle\">Capture and share your special moments with the Dicoding community</p>\n          <div class=\"hero-actions\">\n            <a href=\"#/add-story\" class=\"btn btn-primary\">Create New Story</a>\n            <a href=\"#/stories\" class=\"btn btn-secondary\">Browse Stories</a>\n          </div>\n        </div>\n        <div class=\"hero-image\">\n          <div class=\"story-preview\">\n            <div class=\"story-card\">\n              <div class=\"story-placeholder\"></div>\n              <h3>Your Story Here</h3>\n              <p>Share your amazing experiences</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <section class=\"features-section\">\n        <div class=\"container\">\n          <h2 class=\"section-title\">Why Choose StoryApp?</h2>\n          <div class=\"features-grid\">\n            <div class=\"feature-card\">\n              <div class=\"feature-icon\">📸</div>\n              <h3>Photo Stories</h3>\n              <p>Capture moments with your camera and share them instantly</p>\n            </div>\n            <div class=\"feature-card\">\n              <div class=\"feature-icon\">🗺️</div>\n              <h3>Location Sharing</h3>\n              <p>Add location data to your stories and explore places</p>\n            </div>\n            <div class=\"feature-card\">\n              <div class=\"feature-icon\">❤️</div>\n              <h3>Save Favorites</h3>\n              <p>Keep your favorite stories for offline reading</p>\n            </div>\n            <div class=\"feature-card\">\n              <div class=\"feature-icon\">🔔</div>\n              <h3>Push Notifications</h3>\n              <p>Get notified when new stories are shared</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <section class=\"install-section\">\n        <div class=\"install-card\">\n          <div class=\"install-content\">\n            <h3>Install StoryApp for a better experience!</h3>\n            <p>Get the full app experience with offline access and push notifications</p>\n            <div class=\"install-actions\">\n              <button id=\"install-btn\" class=\"btn btn-install\">Install</button>\n              <button id=\"not-now-btn\" class=\"btn btn-outline\">Not Now</button>\n            </div>\n          </div>\n          <div class=\"install-icon\">📱</div>\n        </div>\n      </section>\n\n      ${token ? `\n        <section class=\"featured-stories-section\">\n          <div class=\"container\">\n            <h2 class=\"section-title\">Featured Stories</h2>\n            <div id=\"featured-stories\" class=\"stories-preview\"></div>\n            <div class=\"view-all-container\">\n              <a href=\"#/stories\" class=\"btn btn-outline\">View All Stories</a>\n            </div>\n          </div>\n        </section>\n      ` : ''}\n    `;\n    \n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    this.setupInstallPrompt();\n    \n    if (token) {\n      await this.loadFeaturedStories();\n    }\n  }\n\n  setupInstallPrompt() {\n    const installBtn = document.getElementById(\"install-btn\");\n    const notNowBtn = document.getElementById(\"not-now-btn\");\n    const installSection = document.querySelector(\".install-section\");\n\n    // Listen for beforeinstallprompt event\n    window.addEventListener('beforeinstallprompt', (e) => {\n      e.preventDefault();\n      this.installPrompt = e;\n      installSection.style.display = 'block';\n    });\n\n    installBtn.addEventListener(\"click\", async () => {\n      if (this.installPrompt) {\n        this.installPrompt.prompt();\n        const result = await this.installPrompt.userChoice;\n        if (result.outcome === 'accepted') {\n          installSection.style.display = 'none';\n        }\n        this.installPrompt = null;\n      } else {\n        // Fallback for browsers that don't support PWA installation\n        this.showMessage(\"To install this app, use your browser's 'Add to Home Screen' option in the menu.\");\n      }\n    });\n\n    notNowBtn.addEventListener(\"click\", () => {\n      installSection.style.display = 'none';\n    });\n\n    // Hide install section if app is already installed\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      installSection.style.display = 'none';\n    }\n  }\n\n  async loadFeaturedStories() {\n    try {\n      const token = getToken();\n      if (!token) return;\n\n      const response = await fetch('https://story-api.dicoding.dev/v1/stories?page=1&size=3&location=1', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n\n      const data = await response.json();\n      if (data.listStory && data.listStory.length > 0) {\n        this.displayFeaturedStories(data.listStory);\n      }\n    } catch (error) {\n      console.error('Error loading featured stories:', error);\n    }\n  }\n\n  displayFeaturedStories(stories) {\n    const container = document.getElementById(\"featured-stories\");\n    if (!container) return;\n\n    container.innerHTML = stories.map(story => `\n      <div class=\"featured-story-card\">\n        <div class=\"story-image-container\">\n          <img src=\"${story.photoUrl}\" alt=\"${story.description.substring(0, 50)}...\" loading=\"lazy\">\n        </div>\n        <div class=\"story-content\">\n          <h3>${story.name}</h3>\n          <p class=\"story-date\">${new Date(story.createdAt).toLocaleDateString('id-ID', {\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric'\n          })}</p>\n          <p class=\"story-description\">${story.description.substring(0, 100)}...</p>\n          <a href=\"#/detail/${story.id}\" class=\"view-details-btn\">View Details</a>\n        </div>\n      </div>\n    `).join('');\n  }\n\n  showMessage(message) {\n    alert(message);\n  }\n}","// src/js/views/stories.js\nimport HomePresenter from \"../presenters/home-presenter.js\";\nimport { createElement } from \"../utils/dom.js\";\nimport { saveStories } from \"../db.js\";\n\nexport default class StoriesView {\n  constructor() {\n    this.presenter = new HomePresenter(this);\n  }\n\n  async init() {\n    const content = createElement(\"div\", { \n      class: \"stories-page-container\",\n      role: \"region\",\n      \"aria-label\": \"Daftar semua cerita\"\n    });\n    \n    content.innerHTML = `\n      <div class=\"stories-header\">\n        <h1>All Stories</h1>\n        <p>Discover amazing stories from our community</p>\n      </div>\n      \n      <div class=\"stories-filters\">\n        <div class=\"filter-group\">\n          <label for=\"sort-select\">Sort by:</label>\n          <select id=\"sort-select\">\n            <option value=\"newest\">Newest First</option>\n            <option value=\"oldest\">Oldest First</option>\n          </select>\n        </div>\n        <div class=\"filter-group\">\n          <button id=\"refresh-btn\" class=\"btn btn-outline\">🔄 Refresh</button>\n        </div>\n      </div>\n      \n      <div \n        id=\"stories-list\" \n        role=\"feed\" \n        aria-label=\"Daftar cerita\"\n        class=\"stories-container\"\n      ></div>\n      \n      <div id=\"loading-indicator\" class=\"loading-indicator\" style=\"display: none;\">\n        <div class=\"spinner\"></div>\n        <p>Loading stories...</p>\n      </div>\n    `;\n    \n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    this.setupEventListeners();\n    await this.presenter.loadStories();\n  }\n\n  setupEventListeners() {\n    const refreshBtn = document.getElementById(\"refresh-btn\");\n    const sortSelect = document.getElementById(\"sort-select\");\n\n    refreshBtn.addEventListener(\"click\", () => {\n      this.presenter.loadStories();\n    });\n\n    sortSelect.addEventListener(\"change\", (e) => {\n      this.sortStories(e.target.value);\n    });\n  }\n\n  displayStories(stories) {\n    const storiesList = document.getElementById(\"stories-list\");\n    storiesList.innerHTML = \"\";\n    \n    if (stories.length === 0) {\n      storiesList.innerHTML = `\n        <div class=\"empty-state\">\n          <div class=\"empty-icon\">📖</div>\n          <h3>No Stories Yet</h3>\n          <p>Be the first to share your story!</p>\n          <a href=\"#/add-story\" class=\"btn btn-primary\">Create Story</a>\n        </div>\n      `;\n      return;\n    }\n    \n    stories.forEach((story) => {\n      const storyItem = createElement(\"div\", { \n        class: \"story-item\",\n        role: \"article\"\n      });\n      \n      storyItem.innerHTML = `\n        <div class=\"story-header\">\n          <div class=\"story-author\">\n            <div class=\"author-avatar\">\n              ${story.name.charAt(0).toUpperCase()}\n            </div>\n            <div class=\"author-info\">\n              <h3>${story.name}</h3>\n              <p class=\"story-date\">${new Date(story.createdAt).toLocaleDateString('id-ID', {\n                year: 'numeric',\n                month: 'long',\n                day: 'numeric',\n                hour: '2-digit',\n                minute: '2-digit'\n              })}</p>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"story-content\">\n          <p class=\"story-description\">${story.description}</p>\n          <img \n            src=\"${story.photoUrl}\" \n            alt=\"Foto untuk cerita: ${story.description.substring(0, 50)}...\" \n            loading=\"lazy\"\n            class=\"story-image\"\n          >\n        </div>\n        \n        ${story.lat && story.lon ? `\n          <div class=\"story-location\">\n            <div class=\"location-info\">\n              <span class=\"location-icon\">📍</span>\n              <span>Location: ${story.lat.toFixed(4)}, ${story.lon.toFixed(4)}</span>\n            </div>\n            <div \n              id=\"map-${story.id}\" \n              class=\"story-map\" \n              role=\"complementary\" \n              aria-label=\"Lokasi cerita di peta\"\n            ></div>\n          </div>\n        ` : ''}\n        \n        <div class=\"story-actions\">\n          <a \n            href=\"#/detail/${story.id}\" \n            class=\"action-btn detail-btn\"\n            aria-label=\"Lihat detail cerita dari ${story.name}\"\n          >\n            <span class=\"btn-icon\">👁️</span>\n            View Details\n          </a>\n          <button \n            class=\"action-btn favorite-btn\" \n            data-story='${JSON.stringify(story).replace(/'/g, \"&apos;\")}'\n            aria-label=\"Simpan ke favorit\"\n          >\n            <span class=\"btn-icon\">❤️</span>\n            Save to Favorites\n          </button>\n        </div>\n      `;\n      \n      storiesList.appendChild(storyItem);\n\n      if (story.lat && story.lon) {\n        this.presenter.initMap(\n          `map-${story.id}`,\n          story.lat,\n          story.lon,\n          story.name\n        );\n      }\n    });\n\n    // Add event listeners for favorite buttons\n    document.querySelectorAll('.favorite-btn').forEach(btn => {\n      btn.addEventListener('click', async (e) => {\n        const storyData = JSON.parse(e.target.closest('.favorite-btn').dataset.story.replace(/&apos;/g, \"'\"));\n        await this.saveFavorite(storyData);\n      });\n    });\n  }\n\n  async saveFavorite(story) {\n    try {\n      await saveStories([story]);\n      this.showMessage(\"Cerita berhasil disimpan ke favorit!\");\n    } catch (error) {\n      this.showMessage(`Gagal menyimpan cerita: ${error.message}`);\n    }\n  }\n\n  sortStories(sortType) {\n    const storiesContainer = document.getElementById(\"stories-list\");\n    const storyItems = Array.from(storiesContainer.querySelectorAll('.story-item'));\n    \n    storyItems.sort((a, b) => {\n      const dateA = new Date(a.querySelector('.story-date').textContent);\n      const dateB = new Date(b.querySelector('.story-date').textContent);\n      \n      return sortType === 'newest' ? dateB - dateA : dateA - dateB;\n    });\n    \n    storiesContainer.innerHTML = '';\n    storyItems.forEach(item => storiesContainer.appendChild(item));\n  }\n\n  showMessage(message, retryCallback) {\n    if (retryCallback) {\n      const storiesList = document.getElementById(\"stories-list\");\n      storiesList.innerHTML = `\n        <div class=\"error-state\" role=\"alert\">\n          <div class=\"error-icon\">⚠️</div>\n          <h3>Oops! Something went wrong</h3>\n          <p>${message}</p>\n          <button id=\"retry-btn\" class=\"btn btn-primary\">Try Again</button>\n        </div>\n      `;\n      \n      document.getElementById(\"retry-btn\").addEventListener(\"click\", retryCallback);\n    } else {\n      alert(message);\n    }\n  }\n}","// src/js/notification.js - Enhanced Notification Management\n\nimport { VAPID_PUBLIC_KEY } from \"./constants.js\";\nimport { subscribeNotifications, unsubscribeFromNotifications } from \"./api.js\";\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = \"=\".repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = (base64String + padding).replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n\nexport function isPushNotificationSupported() {\n  return \"serviceWorker\" in navigator && \"PushManager\" in window;\n}\n\nexport async function requestNotificationPermission() {\n  if (!(\"Notification\" in window)) {\n    console.warn(\"Browser ini tidak mendukung notifikasi.\");\n    return false;\n  }\n\n  const permission = await Notification.requestPermission();\n  if (permission !== \"granted\") {\n    console.warn(\"Izin notifikasi tidak diberikan oleh pengguna.\");\n    return false;\n  }\n  return true;\n}\n\nexport async function getNotificationStatus() {\n  const isSupported = isPushNotificationSupported();\n  if (!isSupported) {\n    return { isSupported: false, permission: \"denied\", isSubscribed: false };\n  }\n\n  const permission = Notification.permission;\n  const registration = await navigator.serviceWorker.ready;\n  const subscription = await registration.pushManager.getSubscription();\n\n  return {\n    isSupported,\n    permission,\n    isSubscribed: !!subscription,\n  };\n}\n\nexport async function subscribePushNotification(token) {\n  if (!isPushNotificationSupported()) {\n    throw new Error(\"Push notification tidak didukung di browser ini.\");\n  }\n\n  if (Notification.permission === \"denied\") {\n    throw new Error(\n      \"Izin notifikasi telah ditolak. Ubah di pengaturan browser.\"\n    );\n  }\n\n  const registration = await navigator.serviceWorker.ready;\n  let subscription = await registration.pushManager.getSubscription();\n\n  if (!subscription) {\n    const permissionGranted = await requestNotificationPermission();\n    if (!permissionGranted) {\n      throw new Error(\"Izin notifikasi tidak diberikan.\");\n    }\n\n    const applicationServerKey = urlBase64ToUint8Array(VAPID_PUBLIC_KEY);\n    subscription = await registration.pushManager.subscribe({\n      userVisibleOnly: true,\n      applicationServerKey,\n    });\n  }\n\n  // Kirim subscription ke server.\n  try {\n    // =======================================================\n    // PERBAIKAN DI SINI: Tambahkan .toJSON()\n    // =======================================================\n    await subscribeNotifications(subscription.toJSON(), token);\n    console.log(\"Berhasil berlangganan push notification.\");\n    return subscription;\n  } catch (serverError) {\n    console.error(\n      \"Gagal mendaftar ke server, membatalkan subscription...\",\n      serverError\n    );\n    await subscription.unsubscribe();\n    throw new Error(\n      `Gagal mendaftarkan subscription ke server: ${serverError.message}`\n    );\n  }\n}\n\nexport async function unsubscribePushNotification(token) {\n  if (!isPushNotificationSupported()) {\n    console.warn(\"Push notification tidak didukung.\");\n    return false;\n  }\n\n  const registration = await navigator.serviceWorker.ready;\n  const subscription = await registration.pushManager.getSubscription();\n\n  if (!subscription) {\n    console.log(\"Tidak ada subscription aktif untuk dihentikan.\");\n    return true;\n  }\n\n  const unsubscribedSuccessfully = await subscription.unsubscribe();\n  if (!unsubscribedSuccessfully) {\n    console.error(\"Gagal berhenti berlangganan di sisi client.\");\n    return false;\n  }\n\n  try {\n    await unsubscribeFromNotifications(subscription.endpoint, token);\n    console.log(\"Berhasil berhenti berlangganan sepenuhnya.\");\n  } catch (serverError) {\n    console.warn(\n      \"Berhasil berhenti di client, tapi gagal memberitahu server.\",\n      serverError\n    );\n  }\n\n  return true;\n}\n\nexport async function showStoryNotification(title, body, data = {}) {\n  if (Notification.permission !== \"granted\") {\n    return;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.ready;\n    await registration.showNotification(title, {\n      body,\n      icon: \"/icons/icon-192x192.png\",\n      badge: \"/icons/icon-96x96.png\",\n      tag: \"story-notification\",\n      vibrate: [200, 100, 200],\n      data,\n    });\n  } catch (error) {\n    console.error(\"Gagal menampilkan notifikasi:\", error);\n  }\n}\n","// src/js/presenters/add-story-presenter.js\n\nimport StoryModel from \"../models/story-model.js\";\nimport { initMap, onMapClick, addMarker } from \"../map.js\";\nimport { showStoryNotification } from \"../notification.js\";\nimport { triggerStoryNotification } from \"../api.js\";\nimport { getToken } from \"../utils/auth.js\"; // Import getToken\n\nexport default class AddStoryPresenter {\n  constructor(view) {\n    this.view = view;\n    this.model = new StoryModel();\n    this.coordinates = {};\n    this.currentMarker = null;\n    this.map = null;\n  }\n\n  initMap(containerId) {\n    this.map = initMap(containerId);\n\n    onMapClick(this.map, (lat, lon) => {\n      this.setCoordinates(lat, lon);\n      this.view.updateLocationDisplay(lat, lon);\n    });\n\n    return this.map;\n  }\n\n  setCoordinates(lat, lon) {\n    this.coordinates = { lat, lon };\n    if (this.currentMarker) {\n      this.map.removeLayer(this.currentMarker);\n    }\n    this.currentMarker = addMarker(this.map, lat, lon, \"Selected location\");\n  }\n\n  updateMapLocation(lat, lon) {\n    if (this.map) {\n      this.map.setView([lat, lon], 15);\n      this.setCoordinates(lat, lon);\n    }\n  }\n\n  getCoordinates() {\n    return this.coordinates;\n  }\n\n  /**\n   * Fungsi utama untuk menambah cerita.\n   * Logika trigger notifikasi dipisahkan agar tidak memblokir UI.\n   */\n  async addStory(description, photo, lat, lon) {\n    const token = getToken();\n    if (!token) {\n      this.view.showMessage(\n        \"Authentication error. Please login again.\",\n        \"error\"\n      );\n      return;\n    }\n\n    try {\n      // Panggil metode di view untuk menampilkan state loading\n      this.view.showLoading(true);\n\n      const response = await this.model.addStory({\n        description,\n        photo,\n        lat: lat || this.coordinates.lat,\n        lon: lon || this.coordinates.lon,\n        token,\n      });\n\n      // Tampilkan notifikasi lokal bahwa cerita berhasil di-share\n      await showStoryNotification(\n        \"Story Shared Successfully!\",\n        `Your story \"${description.substring(0, 30)}...\" has been shared.`\n      );\n\n      this.view.showMessage(\"Story shared successfully!\", \"success\");\n\n      // Arahkan ke halaman stories setelah sukses\n      window.location.hash = \"#/stories\";\n\n      // Jalankan trigger notifikasi di latar belakang (tanpa 'await')\n      // Jika ini gagal, tidak akan mempengaruhi alur utama.\n      this.triggerNotificationInBackground(token);\n    } catch (error) {\n      this.view.showMessage(`Failed to share story: ${error.message}`, \"error\");\n    } finally {\n      // Pastikan state loading selalu dihentikan, baik sukses maupun gagal\n      this.view.showLoading(false);\n    }\n  }\n\n  /**\n   * Fungsi helper untuk men-trigger notifikasi secara asynchronous\n   * dan menangani error-nya secara terpisah.\n   */\n  async triggerNotificationInBackground(token) {\n    try {\n      console.log(\"Attempting to trigger push notification to other users...\");\n      await triggerStoryNotification(token); // Menggunakan token yang sudah ada\n      console.log(\"Push notification triggered successfully.\");\n    } catch (notificationError) {\n      // Jika gagal, cukup catat di console. Pengguna tidak perlu tahu.\n      console.warn(\n        \"Could not trigger push notification:\",\n        notificationError.message\n      );\n    }\n  }\n}\n","// src/js/camera.js\n\n/**\n * Memulai kamera dan menampilkannya di elemen video.\n * Mencoba kamera belakang terlebih dahulu, lalu beralih jika gagal.\n * @param {HTMLVideoElement} videoElement - Elemen <video> untuk menampilkan pratinjau.\n * @returns {Promise<MediaStream>} - Promise yang resolve dengan objek MediaStream.\n */\nexport async function startCamera(videoElement) {\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: { facingMode: \"environment\" }, // Prioritaskan kamera belakang\n    });\n    videoElement.srcObject = stream;\n    return stream;\n  } catch (error) {\n    if (\n      error.name === \"NotFoundError\" ||\n      error.name === \"DevicesNotFoundError\"\n    ) {\n      console.warn(\"Kamera belakang tidak ditemukan, mencoba kamera depan.\");\n      try {\n        const fallbackStream = await navigator.mediaDevices.getUserMedia({\n          video: true, // Gunakan kamera apa pun yang tersedia\n        });\n        videoElement.srcObject = fallbackStream;\n        return fallbackStream;\n      } catch (fallbackError) {\n        console.error(\"Gagal mengakses kamera fallback:\", fallbackError);\n        throw fallbackError;\n      }\n    }\n    console.error(\"Error saat mengakses kamera:\", error);\n    throw error;\n  }\n}\n\n/**\n * Mengambil gambar dari elemen video dan menampilkannya di canvas.\n * @param {HTMLVideoElement} videoElement - Elemen video yang sedang berjalan.\n * @param {HTMLCanvasElement} canvasElement - Elemen canvas untuk menggambar frame.\n * @returns {string} - Data URL dari gambar yang diambil (format JPEG).\n */\nexport function captureImage(videoElement, canvasElement) {\n  const context = canvasElement.getContext(\"2d\");\n  canvasElement.width = videoElement.videoWidth;\n  canvasElement.height = videoElement.videoHeight;\n  context.drawImage(\n    videoElement,\n    0,\n    0,\n    canvasElement.width,\n    canvasElement.height\n  );\n  return canvasElement.toDataURL(\"image/jpeg\");\n}\n\n/**\n * Menghentikan semua trek (video) dari MediaStream.\n * @param {MediaStream} stream - Objek stream yang ingin dihentikan.\n */\nexport function stopCamera(stream) {\n  if (stream && typeof stream.getTracks === \"function\") {\n    stream.getTracks().forEach((track) => track.stop());\n    console.log(\"Aliran kamera berhasil dihentikan.\");\n  }\n}\n\n/**\n * Mengubah Data URL menjadi objek File.\n * @param {string} dataURL - String Data URL dari gambar.\n * @param {string} filename - Nama file yang diinginkan.\n * @returns {File} - Objek File yang bisa di-upload.\n */\nexport function dataURLtoFile(dataURL, filename) {\n  const arr = dataURL.split(\",\");\n  const mimeMatch = arr[0].match(/:(.*?);/);\n  if (!mimeMatch) {\n    throw new Error(\"Data URL tidak valid\");\n  }\n  const mime = mimeMatch[1];\n  const bstr = atob(arr[1]);\n  let n = bstr.length;\n  const u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new File([u8arr], filename, { type: mime });\n}\n","// src/js/views/add-story.js\n\nimport AddStoryPresenter from \"../presenters/add-story-presenter.js\";\nimport { createElement } from \"../utils/dom.js\";\nimport {\n  startCamera,\n  captureImage,\n  stopCamera,\n  dataURLtoFile,\n} from \"../camera.js\";\nimport { getToken } from \"../utils/auth.js\";\n\nexport default class AddStoryView {\n  constructor() {\n    this.presenter = new AddStoryPresenter(this);\n    this.stream = null;\n    this.photo = null;\n    this.userLocation = null;\n  }\n\n  async init() {\n    const token = getToken();\n    if (!token) {\n      this.showMessage(\"Silakan login terlebih dahulu!\");\n      window.location.hash = \"#/login\";\n      return;\n    }\n\n    const content = createElement(\"div\", { class: \"add-story-container\" });\n    content.innerHTML = `\n      <div class=\"form-header\">\n        <h2>Create New Story</h2>\n        <p>Share your amazing experience with the community</p>\n      </div>\n      \n      <form id=\"add-story-form\" class=\"story-form\">\n        <div class=\"form-group\">\n          <label for=\"description\">Story Description</label>\n          <textarea \n            id=\"description\" \n            required \n            aria-required=\"true\" \n            placeholder=\"Tell us about your experience...\"\n            rows=\"4\"\n          ></textarea>\n          <div class=\"char-counter\">\n            <span id=\"char-count\">0</span>/500 characters\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"photo\">Photo</label>\n          <div class=\"photo-section\">\n            <video id=\"camera\" autoplay playsinline class=\"camera-preview\"></video>\n            <img id=\"preview\" class=\"photo-preview\" alt=\"Photo Preview\" style=\"display:none;\" />\n            <canvas id=\"canvas\" style=\"display:none;\"></canvas>\n            \n            <div class=\"camera-controls\">\n              <button type=\"button\" id=\"capture\" class=\"btn btn-camera\">\n                <span class=\"btn-icon\">📷</span>\n                Capture Photo\n              </button>\n              <button type=\"button\" id=\"retake\" class=\"btn btn-outline\" style=\"display:none;\">\n                <span class=\"btn-icon\">🔄</span>\n                Retake\n              </button>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"location\">Location</label>\n          <p class=\"location-help\">Click on the map to set your story's location (optional)</p>\n          \n          <div class=\"location-controls\">\n            <button type=\"button\" id=\"use-my-location\" class=\"btn btn-location\">\n              <span class=\"btn-icon\">📍</span>\n              Use My Location\n            </button>\n            <div class=\"location-inputs\">\n              <div class=\"input-group\">\n                <label for=\"latitude\">Latitude</label>\n                <input type=\"number\" id=\"latitude\" step=\"any\" placeholder=\"Latitude\" readonly>\n              </div>\n              <div class=\"input-group\">\n                <label for=\"longitude\">Longitude</label>\n                <input type=\"number\" id=\"longitude\" step=\"any\" placeholder=\"Longitude\" readonly>\n              </div>\n            </div>\n          </div>\n          \n          <div id=\"location-info\" class=\"location-info\">\n            <span class=\"location-icon\">📍</span>\n            <span class=\"location-text\">No location selected</span>\n          </div>\n          \n          <div id=\"map\" class=\"story-map\"></div>\n        </div>\n        \n        <div class=\"form-actions\">\n          <button type=\"button\" id=\"cancel-btn\" class=\"btn btn-outline\">\n            Cancel\n          </button>\n          <button type=\"submit\" class=\"btn btn-primary\">\n            <span class=\"btn-icon\">📝</span>\n            Share Story\n          </button>\n        </div>\n      </form>\n    `;\n\n    const contentElement = document.getElementById(\"content\") || document.body;\n    contentElement.innerHTML = \"\";\n    contentElement.appendChild(content);\n\n    await this.initializeForm();\n  }\n\n  async initializeForm() {\n    const video = document.getElementById(\"camera\");\n\n    try {\n      this.stream = await startCamera(video);\n    } catch (error) {\n      this.showMessage(\n        `Failed to access camera: ${error.message}. Please ensure camera is available and allow camera access in browser settings.`\n      );\n      return;\n    }\n\n    this.presenter.initMap(\"map\");\n    this.setupEventListeners();\n  }\n\n  setupEventListeners() {\n    const descriptionTextarea = document.getElementById(\"description\");\n    const charCount = document.getElementById(\"char-count\");\n    const captureBtn = document.getElementById(\"capture\");\n    const retakeBtn = document.getElementById(\"retake\");\n    const useLocationBtn = document.getElementById(\"use-my-location\");\n    const cancelBtn = document.getElementById(\"cancel-btn\");\n    const form = document.getElementById(\"add-story-form\");\n\n    descriptionTextarea.addEventListener(\"input\", (e) => {\n      const length = e.target.value.length;\n      charCount.textContent = length;\n      charCount.style.color = length > 500 ? \"#ef476f\" : \"#6c757d\";\n    });\n\n    captureBtn.addEventListener(\"click\", () => {\n      this.capturePhoto();\n    });\n\n    retakeBtn.addEventListener(\"click\", () => {\n      this.retakePhoto();\n    });\n\n    useLocationBtn.addEventListener(\"click\", () => {\n      this.getCurrentLocation();\n    });\n\n    cancelBtn.addEventListener(\"click\", () => {\n      if (\n        confirm(\"Are you sure you want to cancel? Your story will be lost.\")\n      ) {\n        this.destroy(); // Panggil destroy saat cancel\n        window.location.hash = \"#/stories\";\n      }\n    });\n\n    form.addEventListener(\"submit\", async (e) => {\n      e.preventDefault();\n      await this.submitStory();\n    });\n  }\n\n  capturePhoto() {\n    const video = document.getElementById(\"camera\");\n    const canvas = document.getElementById(\"canvas\");\n    const preview = document.getElementById(\"preview\");\n    const captureBtn = document.getElementById(\"capture\");\n    const retakeBtn = document.getElementById(\"retake\");\n\n    const dataURL = captureImage(video, canvas);\n    this.photo = dataURLtoFile(dataURL, \"story.jpg\");\n\n    preview.src = dataURL;\n    preview.style.display = \"block\";\n    video.style.display = \"none\";\n    captureBtn.style.display = \"none\";\n    retakeBtn.style.display = \"inline-flex\";\n  }\n\n  retakePhoto() {\n    const video = document.getElementById(\"camera\");\n    const preview = document.getElementById(\"preview\");\n    const captureBtn = document.getElementById(\"capture\");\n    const retakeBtn = document.getElementById(\"retake\");\n\n    this.photo = null;\n    preview.style.display = \"none\";\n    video.style.display = \"block\";\n    captureBtn.style.display = \"inline-flex\";\n    retakeBtn.style.display = \"none\";\n  }\n\n  async getCurrentLocation() {\n    const useLocationBtn = document.getElementById(\"use-my-location\");\n    const originalText = useLocationBtn.innerHTML;\n\n    useLocationBtn.innerHTML =\n      '<span class=\"spinner-small\"></span> Getting location...';\n    useLocationBtn.disabled = true;\n\n    try {\n      const position = await new Promise((resolve, reject) => {\n        navigator.geolocation.getCurrentPosition(resolve, reject, {\n          enableHighAccuracy: true,\n          timeout: 10000,\n          maximumAge: 60000,\n        });\n      });\n\n      const { latitude, longitude } = position.coords;\n      this.updateLocationDisplay(latitude, longitude);\n      this.presenter.setCoordinates(latitude, longitude);\n      this.presenter.updateMapLocation(latitude, longitude);\n    } catch (error) {\n      this.showMessage(`Failed to get location: ${error.message}`);\n    } finally {\n      useLocationBtn.innerHTML = originalText;\n      useLocationBtn.disabled = false;\n    }\n  }\n\n  updateLocationDisplay(lat, lon) {\n    const locationInfo = document.getElementById(\"location-info\");\n    const latInput = document.getElementById(\"latitude\");\n    const lonInput = document.getElementById(\"longitude\");\n\n    locationInfo.innerHTML = `\n      <span class=\"location-icon\">📍</span>\n      <span class=\"location-text\">Location: ${lat.toFixed(6)}, ${lon.toFixed(\n      6\n    )}</span>\n    `;\n    locationInfo.classList.add(\"location-selected\");\n\n    latInput.value = lat.toFixed(6);\n    lonInput.value = lon.toFixed(6);\n  }\n\n  async submitStory() {\n    const description = document.getElementById(\"description\").value.trim();\n\n    if (!description) {\n      this.showMessage(\"Please enter a story description!\");\n      return;\n    }\n    if (description.length > 500) {\n      this.showMessage(\"Story description must be 500 characters or less!\");\n      return;\n    }\n    if (!this.photo) {\n      this.showMessage(\"Please capture a photo first!\");\n      return;\n    }\n\n    const { lat, lon } = this.presenter.getCoordinates();\n\n    // Memanggil presenter untuk menangani logika submit yang kompleks\n    await this.presenter.addStory(description, this.photo, lat, lon);\n  }\n\n  // =======================================================\n  // FUNGSI BARU DITAMBAHKAN DI SINI\n  // =======================================================\n  /**\n   * Mengelola tampilan tombol submit (loading state)\n   * @param {boolean} isLoading - True jika sedang loading, false jika tidak.\n   */\n  showLoading(isLoading) {\n    const submitBtn = document.querySelector('button[type=\"submit\"]');\n    if (!submitBtn) return;\n\n    if (isLoading) {\n      submitBtn.innerHTML = '<span class=\"spinner-small\"></span> Sharing...';\n      submitBtn.disabled = true;\n    } else {\n      // Mengembalikan ke state awal\n      const defaultText = '<span class=\"btn-icon\">📝</span> Share Story';\n      submitBtn.innerHTML = defaultText;\n      submitBtn.disabled = false;\n    }\n  }\n\n  /**\n   * Metode 'destroy' ini akan dipanggil oleh router sebelum halaman diganti.\n   * Fungsinya adalah untuk membersihkan resource seperti stream kamera.\n   */\n  destroy() {\n    stopCamera(this.stream);\n  }\n\n  showMessage(message, type = \"info\") {\n    // Implementasi toast notification yang lebih baik bisa diletakkan di sini\n    console.log(`[${type.toUpperCase()}]: ${message}`);\n    alert(message);\n  }\n}\n","// src/js/presenters/detail-presenter.js\nimport StoryModel from \"../models/story-model.js\"; // dari src/js/presenters/ ke src/js/models/story-model.js\nimport { initMap, addMarker } from \"../map.js\"; // dari src/js/presenters/ ke src/js/map.js\n\nexport default class DetailPresenter {\n  constructor(view) {\n    this.view = view;\n    this.model = new StoryModel();\n  }\n\n  async getStoryDetail(id, token) {\n    try {\n      const story = await this.model.getStoryDetail(id, token);\n      return story;\n    } catch (error) {\n      throw new Error(`Gagal mengambil detail cerita: ${error.message}`);\n    }\n  }\n\n  initMap(containerId, lat, lon, popupText) {\n    if (lat && lon) {\n      const map = initMap(containerId, lat, lon, 13);\n      addMarker(map, lat, lon, popupText);\n    }\n  }\n}\n","// src/js/views/detail.js\nimport DetailPresenter from \"../presenters/detail-presenter.js\";\nimport { createElement } from \"../utils/dom.js\";\nimport { getToken } from \"../utils/auth.js\";\nimport { saveStories } from \"../db.js\";\n\nexport default class DetailView {\n  constructor() {\n    this.presenter = new DetailPresenter(this);\n  }\n\n  async init({ id }) {\n    const token = getToken();\n    if (!token) {\n      window.location.hash = \"#/login\";\n      return;\n    }\n\n    const content = createElement(\"div\", { class: \"detail-container\" });\n    content.innerHTML = `\n      <div class=\"detail-header\">\n        <button id=\"back-btn\" class=\"btn btn-outline\">\n          <span class=\"btn-icon\">←</span>\n          Back to Stories\n        </button>\n        <div class=\"detail-actions\">\n          <button id=\"save-favorite\" class=\"btn btn-outline\">\n            <span class=\"btn-icon\">❤️</span>\n            Save to Favorites\n          </button>\n          <button id=\"share-story\" class=\"btn btn-outline\">\n            <span class=\"btn-icon\">📤</span>\n            Share\n          </button>\n        </div>\n      </div>\n      \n      <div id=\"story-detail\" class=\"story-detail-content\">\n        <div class=\"loading-state\">\n          <div class=\"spinner\"></div>\n          <p>Loading story...</p>\n        </div>\n      </div>\n    `;\n    \n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    this.setupEventListeners();\n\n    try {\n      const story = await this.presenter.getStoryDetail(id, token);\n      this.displayStory(story);\n    } catch (error) {\n      this.showError(error.message);\n    }\n  }\n\n  setupEventListeners() {\n    const backBtn = document.getElementById(\"back-btn\");\n    const saveFavoriteBtn = document.getElementById(\"save-favorite\");\n    const shareBtn = document.getElementById(\"share-story\");\n\n    backBtn.addEventListener(\"click\", () => {\n      window.history.back();\n    });\n\n    saveFavoriteBtn.addEventListener(\"click\", () => {\n      if (this.currentStory) {\n        this.saveFavorite(this.currentStory);\n      }\n    });\n\n    shareBtn.addEventListener(\"click\", () => {\n      if (this.currentStory) {\n        this.shareStory(this.currentStory);\n      }\n    });\n  }\n\n  displayStory(story) {\n    this.currentStory = story;\n    const storyDetail = document.getElementById(\"story-detail\");\n    \n    storyDetail.innerHTML = `\n      <article class=\"story-article\">\n        <header class=\"story-header\">\n          <div class=\"author-section\">\n            <div class=\"author-avatar\">\n              ${story.name.charAt(0).toUpperCase()}\n            </div>\n            <div class=\"author-info\">\n              <h1 class=\"story-author\">${story.name}</h1>\n              <time class=\"story-date\" datetime=\"${story.createdAt}\">\n                ${new Date(story.createdAt).toLocaleDateString('id-ID', {\n                  weekday: 'long',\n                  year: 'numeric',\n                  month: 'long',\n                  day: 'numeric',\n                  hour: '2-digit',\n                  minute: '2-digit'\n                })}\n              </time>\n            </div>\n          </div>\n        </header>\n\n        <div class=\"story-content\">\n          <div class=\"story-image-container\">\n            <img \n              src=\"${story.photoUrl}\" \n              alt=\"Story photo by ${story.name}\" \n              class=\"story-image\"\n              loading=\"lazy\"\n            >\n          </div>\n          \n          <div class=\"story-text\">\n            <p class=\"story-description\">${story.description}</p>\n          </div>\n\n          ${story.lat && story.lon ? `\n            <div class=\"story-location-section\">\n              <h3 class=\"location-title\">\n                <span class=\"location-icon\">📍</span>\n                Story Location\n              </h3>\n              <div class=\"location-coordinates\">\n                <span class=\"coordinate\">\n                  <strong>Latitude:</strong> ${story.lat.toFixed(6)}\n                </span>\n                <span class=\"coordinate\">\n                  <strong>Longitude:</strong> ${story.lon.toFixed(6)}\n                </span>\n              </div>\n              <div id=\"map-detail\" class=\"story-map-detail\"></div>\n            </div>\n          ` : ''}\n        </div>\n\n        <footer class=\"story-footer\">\n          <div class=\"story-stats\">\n            <span class=\"stat-item\">\n              <span class=\"stat-icon\">👁️</span>\n              <span class=\"stat-text\">Story viewed</span>\n            </span>\n          </div>\n        </footer>\n      </article>\n    `;\n\n    if (story.lat && story.lon) {\n      setTimeout(() => {\n        this.presenter.initMap(\"map-detail\", story.lat, story.lon, story.name);\n      }, 100);\n    }\n  }\n\n  async saveFavorite(story) {\n    try {\n      await saveStories([story]);\n      this.showMessage(\"Story saved to favorites!\");\n      \n      // Update button state\n      const saveBtn = document.getElementById(\"save-favorite\");\n      saveBtn.innerHTML = '<span class=\"btn-icon\">✅</span> Saved';\n      saveBtn.disabled = true;\n      setTimeout(() => {\n        saveBtn.innerHTML = '<span class=\"btn-icon\">❤️</span> Save to Favorites';\n        saveBtn.disabled = false;\n      }, 2000);\n    } catch (error) {\n      this.showMessage(`Failed to save story: ${error.message}`);\n    }\n  }\n\n  shareStory(story) {\n    if (navigator.share) {\n      navigator.share({\n        title: `Story by ${story.name}`,\n        text: story.description,\n        url: window.location.href\n      }).catch(err => console.log('Error sharing:', err));\n    } else {\n      // Fallback for browsers that don't support Web Share API\n      const url = window.location.href;\n      navigator.clipboard.writeText(url).then(() => {\n        this.showMessage(\"Story link copied to clipboard!\");\n      }).catch(() => {\n        this.showMessage(\"Unable to share story. Please copy the URL manually.\");\n      });\n    }\n  }\n\n  showError(message) {\n    const storyDetail = document.getElementById(\"story-detail\");\n    storyDetail.innerHTML = `\n      <div class=\"error-state\">\n        <div class=\"error-icon\">⚠️</div>\n        <h3>Unable to Load Story</h3>\n        <p>${message}</p>\n        <button id=\"retry-btn\" class=\"btn btn-primary\">Try Again</button>\n        <a href=\"#/stories\" class=\"btn btn-outline\">Back to Stories</a>\n      </div>\n    `;\n\n    document.getElementById(\"retry-btn\").addEventListener(\"click\", () => {\n      window.location.reload();\n    });\n  }\n\n  showMessage(message) {\n    // Create a toast notification\n    const toast = createElement(\"div\", { class: \"toast-notification\" });\n    toast.textContent = message;\n    document.body.appendChild(toast);\n\n    setTimeout(() => {\n      toast.classList.add(\"show\");\n    }, 100);\n\n    setTimeout(() => {\n      toast.classList.remove(\"show\");\n      setTimeout(() => {\n        document.body.removeChild(toast);\n      }, 300);\n    }, 3000);\n  }\n}","// src/js/presenters/login-presenter.js\nimport { login } from \"../api.js\";\nimport { saveToken } from \"../utils/auth.js\";\n\nexport default class LoginPresenter {\n  constructor(view) {\n    this.view = view;\n  }\n\n  async login({ email, password }) {\n    try {\n      const response = await login({ email, password });\n      if (response.error) throw new Error(response.message);\n      \n      saveToken(response.loginResult.token);\n      \n      // Save user data for welcome message\n      localStorage.setItem('userData', JSON.stringify({\n        name: response.loginResult.name || email.split('@')[0],\n        email: email\n      }));\n      \n      this.view.showMessage(\"Login berhasil!\");\n      window.location.hash = \"#/\";\n    } catch (error) {\n      if (error.message === \"User not found\") {\n        this.view.showMessage(\n          \"Pengguna tidak ditemukan. Silakan registrasi terlebih dahulu.\"\n        );\n      } else {\n        this.view.showMessage(`Login gagal: ${error.message}`);\n      }\n    }\n  }\n}","// src/js/views/login.js\nimport LoginPresenter from \"../presenters/login-presenter.js\"; // dari src/js/views/ ke src/js/presenters/login-presenter.js\nimport { createElement } from \"../utils/dom.js\"; // dari src/js/views/ ke src/js/utils/dom.js\n\nexport default class LoginView {\n  constructor() {\n    this.presenter = new LoginPresenter(this);\n  }\n\n  async init() {\n    const content = createElement(\"div\", { class: \"auth-container\" });\n    content.innerHTML = `\n      <h2>Login</h2>\n      <form id=\"login-form\">\n        <div class=\"form-group\">\n          <label for=\"email\">Email</label>\n          <input type=\"email\" id=\"email\" required aria-required=\"true\">\n        </div>\n        <div class=\"form-group\">\n          <label for=\"password\">Password</label>\n          <input type=\"password\" id=\"password\" required aria-required=\"true\">\n        </div>\n        <button type=\"submit\" aria-label=\"Masuk ke akun\">Login</button>\n      </form>\n      <p>Belum punya akun? <a href=\"#/register\" aria-label=\"Daftar akun baru\">Register di sini</a></p>\n    `;\n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    document\n      .getElementById(\"login-form\")\n      .addEventListener(\"submit\", async (e) => {\n        e.preventDefault();\n        const email = document.getElementById(\"email\").value;\n        const password = document.getElementById(\"password\").value;\n        await this.presenter.login({ email, password });\n      });\n  }\n\n  showMessage(message) {\n    alert(message);\n  }\n}\n","// src/js/presenters/register-presenter.js\nimport { register } from \"../api.js\";\nimport { saveToken } from \"../utils/auth.js\";\nimport { login } from \"../api.js\";\n\nexport default class RegisterPresenter {\n  constructor(view) {\n    this.view = view;\n  }\n\n  async register({ name, email, password }) {\n    try {\n      const response = await register({ name, email, password });\n      if (response.error) throw new Error(response.message);\n      \n      const loginResponse = await login({ email, password });\n      saveToken(loginResponse.loginResult.token);\n      \n      // Save user data for welcome message\n      localStorage.setItem('userData', JSON.stringify({\n        name: name,\n        email: email\n      }));\n      \n      this.view.showMessage(\"Registrasi berhasil! Anda telah login.\");\n      window.location.hash = \"#/\";\n    } catch (error) {\n      if (error.message === \"Email is already taken\") {\n        this.view.showMessage(\n          \"Email sudah terdaftar. Silakan login atau gunakan email lain.\"\n        );\n      } else if (error.message === \"terjadi kesalahan pada server kami\") {\n        this.view.showMessage(\n          \"Server sedang bermasalah. Silakan coba lagi nanti.\"\n        );\n      } else {\n        this.view.showMessage(`Registrasi gagal: ${error.message}`);\n      }\n    }\n  }\n}","// src/js/views/register.js\nimport RegisterPresenter from \"../presenters/register-presenter.js\";\nimport { createElement } from \"../utils/dom.js\";\n\nexport default class RegisterView {\n  constructor() {\n    this.presenter = new RegisterPresenter(this);\n  }\n\n  async init() {\n    const content = createElement(\"div\", { class: \"auth-container\" });\n    content.innerHTML = `\n      <h2>Register</h2>\n      <form id=\"register-form\">\n        <div class=\"form-group\">\n          <label for=\"name\">Nama</label>\n          <input type=\"text\" id=\"name\" required aria-required=\"true\">\n        </div>\n        <div class=\"form-group\">\n          <label for=\"email\">Email</label>\n          <input type=\"email\" id=\"email\" required aria-required=\"true\">\n        </div>\n        <div class=\"form-group\">\n          <label for=\"password\">Password</label>\n          <input type=\"password\" id=\"password\" required aria-required=\"true\" minlength=\"8\">\n        </div>\n        <button type=\"submit\" aria-label=\"Daftar akun baru\">Register</button>\n      </form>\n      <p>Sudah punya akun? <a href=\"#/login\" aria-label=\"Masuk ke akun\">Login di sini</a></p>\n    `;\n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    document\n      .getElementById(\"register-form\")\n      .addEventListener(\"submit\", async (e) => {\n        e.preventDefault();\n        const name = document.getElementById(\"name\").value.trim();\n        const email = document.getElementById(\"email\").value.trim();\n        const password = document.getElementById(\"password\").value;\n\n        if (!name || !email || !password) {\n          this.showMessage(\"Semua kolom harus diisi!\");\n          return;\n        }\n        await this.presenter.register({ name, email, password });\n      });\n  }\n\n  showMessage(message) {\n    alert(message);\n  }\n}\n","// src/js/views/subscribe.js\nimport { createElement } from \"../utils/dom.js\";\nimport { getToken } from \"../utils/auth.js\";\nimport { subscribePushNotification, requestNotificationPermission } from \"../notification.js\";\n\nexport default class SubscribeView {\n  constructor() {\n    this.isSubscribed = false;\n    this.subscription = null;\n  }\n\n  async init() {\n    const token = getToken();\n    if (!token) {\n      this.showMessage(\"Please login first!\");\n      window.location.hash = \"#/login\";\n      return;\n    }\n\n    const content = createElement(\"div\", { class: \"subscribe-container\" });\n    content.innerHTML = `\n      <div class=\"subscribe-header\">\n        <h2>Push Notifications</h2>\n        <p>Stay updated with the latest stories from our community</p>\n      </div>\n      \n      <div class=\"notification-info\">\n        <div class=\"info-card\">\n          <div class=\"info-icon\">🔔</div>\n          <div class=\"info-content\">\n            <h3>Why Enable Notifications?</h3>\n            <ul>\n              <li>Get notified when new stories are shared</li>\n              <li>Never miss interesting content from the community</li>\n              <li>Receive updates even when the app is closed</li>\n              <li>Stay connected with your favorite storytellers</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"subscription-status-card\">\n        <div class=\"status-header\">\n          <h3>Notification Status</h3>\n          <div id=\"status-indicator\" class=\"status-indicator\">\n            <span class=\"status-dot\"></span>\n            <span id=\"status-text\">Checking...</span>\n          </div>\n        </div>\n        \n        <div class=\"status-details\">\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">Browser Support:</span>\n            <span id=\"browser-support\" class=\"detail-value\">Checking...</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">Permission Status:</span>\n            <span id=\"permission-status\" class=\"detail-value\">Checking...</span>\n          </div>\n          <div class=\"detail-item\">\n            <span class=\"detail-label\">Subscription Status:</span>\n            <span id=\"subscription-status\" class=\"detail-value\">Checking...</span>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"subscription-actions\">\n        <button id=\"subscribe-btn\" class=\"btn btn-primary\" style=\"display: none;\">\n          <span class=\"btn-icon\">🔔</span>\n          Enable Notifications\n        </button>\n        <button id=\"unsubscribe-btn\" class=\"btn btn-danger\" style=\"display: none;\">\n          <span class=\"btn-icon\">🔕</span>\n          Disable Notifications\n        </button>\n        <button id=\"test-notification-btn\" class=\"btn btn-outline\" style=\"display: none;\">\n          <span class=\"btn-icon\">🧪</span>\n          Test Notification\n        </button>\n      </div>\n\n      <div class=\"help-section\">\n        <h3>Troubleshooting</h3>\n        <div class=\"help-content\">\n          <details>\n            <summary>Notifications not working?</summary>\n            <div class=\"help-text\">\n              <p>If notifications aren't working, try these steps:</p>\n              <ol>\n                <li>Make sure notifications are enabled in your browser settings</li>\n                <li>Check that the website has permission to send notifications</li>\n                <li>Ensure you're using a supported browser (Chrome, Firefox, Safari, Edge)</li>\n                <li>Try refreshing the page and subscribing again</li>\n              </ol>\n            </div>\n          </details>\n          \n          <details>\n            <summary>How to manage notifications</summary>\n            <div class=\"help-text\">\n              <p>You can control notifications in several ways:</p>\n              <ul>\n                <li>Use the buttons above to enable/disable notifications</li>\n                <li>Manage notification settings in your browser</li>\n                <li>Block notifications from specific websites in browser settings</li>\n              </ul>\n            </div>\n          </details>\n        </div>\n      </div>\n    `;\n    \n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    await this.initializeSubscription(token);\n  }\n\n  async initializeSubscription(token) {\n    // Check browser support\n    this.checkBrowserSupport();\n    \n    // Check permission status\n    await this.checkPermissionStatus();\n    \n    // Check subscription status\n    await this.checkSubscriptionStatus();\n    \n    // Setup event listeners\n    this.setupEventListeners(token);\n    \n    // Update UI\n    this.updateUI();\n  }\n\n  checkBrowserSupport() {\n    const browserSupportEl = document.getElementById(\"browser-support\");\n    \n    if (\"serviceWorker\" in navigator && \"PushManager\" in window) {\n      browserSupportEl.textContent = \"✅ Supported\";\n      browserSupportEl.className = \"detail-value success\";\n    } else {\n      browserSupportEl.textContent = \"❌ Not Supported\";\n      browserSupportEl.className = \"detail-value error\";\n    }\n  }\n\n  async checkPermissionStatus() {\n    const permissionStatusEl = document.getElementById(\"permission-status\");\n    \n    if (\"Notification\" in window) {\n      const permission = Notification.permission;\n      switch (permission) {\n        case \"granted\":\n          permissionStatusEl.textContent = \"✅ Granted\";\n          permissionStatusEl.className = \"detail-value success\";\n          break;\n        case \"denied\":\n          permissionStatusEl.textContent = \"❌ Denied\";\n          permissionStatusEl.className = \"detail-value error\";\n          break;\n        default:\n          permissionStatusEl.textContent = \"⏳ Not Requested\";\n          permissionStatusEl.className = \"detail-value warning\";\n      }\n    } else {\n      permissionStatusEl.textContent = \"❌ Not Available\";\n      permissionStatusEl.className = \"detail-value error\";\n    }\n  }\n\n  async checkSubscriptionStatus() {\n    const subscriptionStatusEl = document.getElementById(\"subscription-status\");\n    \n    if (\"serviceWorker\" in navigator && \"PushManager\" in window) {\n      try {\n        const registration = await navigator.serviceWorker.ready;\n        this.subscription = await registration.pushManager.getSubscription();\n        \n        if (this.subscription) {\n          this.isSubscribed = true;\n          subscriptionStatusEl.textContent = \"✅ Active\";\n          subscriptionStatusEl.className = \"detail-value success\";\n        } else {\n          this.isSubscribed = false;\n          subscriptionStatusEl.textContent = \"❌ Not Subscribed\";\n          subscriptionStatusEl.className = \"detail-value error\";\n        }\n      } catch (error) {\n        console.error(\"Error checking subscription status:\", error);\n        subscriptionStatusEl.textContent = \"❌ Error\";\n        subscriptionStatusEl.className = \"detail-value error\";\n      }\n    } else {\n      subscriptionStatusEl.textContent = \"❌ Not Available\";\n      subscriptionStatusEl.className = \"detail-value error\";\n    }\n  }\n\n  setupEventListeners(token) {\n    const subscribeBtn = document.getElementById(\"subscribe-btn\");\n    const unsubscribeBtn = document.getElementById(\"unsubscribe-btn\");\n    const testBtn = document.getElementById(\"test-notification-btn\");\n\n    subscribeBtn.addEventListener(\"click\", async () => {\n      await this.handleSubscribe(token);\n    });\n\n    unsubscribeBtn.addEventListener(\"click\", async () => {\n      await this.handleUnsubscribe();\n    });\n\n    testBtn.addEventListener(\"click\", () => {\n      this.testNotification();\n    });\n  }\n\n  async handleSubscribe(token) {\n    const subscribeBtn = document.getElementById(\"subscribe-btn\");\n    const originalText = subscribeBtn.innerHTML;\n    \n    subscribeBtn.innerHTML = '<span class=\"spinner-small\"></span> Subscribing...';\n    subscribeBtn.disabled = true;\n\n    try {\n      const hasPermission = await requestNotificationPermission();\n      if (!hasPermission) {\n        this.showMessage(\"Notification permission is required to subscribe.\");\n        return;\n      }\n\n      await subscribePushNotification(token);\n      this.isSubscribed = true;\n      await this.checkSubscriptionStatus();\n      this.updateUI();\n      this.showMessage(\"Successfully subscribed to notifications!\");\n    } catch (error) {\n      console.error(\"Subscription error:\", error);\n      this.showMessage(`Failed to subscribe: ${error.message}`);\n    } finally {\n      subscribeBtn.innerHTML = originalText;\n      subscribeBtn.disabled = false;\n    }\n  }\n\n  async handleUnsubscribe() {\n    const unsubscribeBtn = document.getElementById(\"unsubscribe-btn\");\n    const originalText = unsubscribeBtn.innerHTML;\n    \n    unsubscribeBtn.innerHTML = '<span class=\"spinner-small\"></span> Unsubscribing...';\n    unsubscribeBtn.disabled = true;\n\n    try {\n      if (this.subscription) {\n        await this.subscription.unsubscribe();\n        this.isSubscribed = false;\n        this.subscription = null;\n        await this.checkSubscriptionStatus();\n        this.updateUI();\n        this.showMessage(\"Successfully unsubscribed from notifications!\");\n      }\n    } catch (error) {\n      console.error(\"Unsubscription error:\", error);\n      this.showMessage(`Failed to unsubscribe: ${error.message}`);\n    } finally {\n      unsubscribeBtn.innerHTML = originalText;\n      unsubscribeBtn.disabled = false;\n    }\n  }\n\n  testNotification() {\n    if (Notification.permission === \"granted\") {\n      new Notification(\"Test Notification\", {\n        body: \"This is a test notification from StoryApp!\",\n        icon: \"/icons/icon-192x192.png\",\n        badge: \"/icons/icon-96x96.png\"\n      });\n    } else {\n      this.showMessage(\"Notifications are not enabled. Please enable them first.\");\n    }\n  }\n\n  updateUI() {\n    const statusIndicator = document.getElementById(\"status-indicator\");\n    const statusText = document.getElementById(\"status-text\");\n    const subscribeBtn = document.getElementById(\"subscribe-btn\");\n    const unsubscribeBtn = document.getElementById(\"unsubscribe-btn\");\n    const testBtn = document.getElementById(\"test-notification-btn\");\n\n    const canSubscribe = \"serviceWorker\" in navigator && \n                        \"PushManager\" in window && \n                        Notification.permission !== \"denied\";\n\n    if (this.isSubscribed) {\n      statusIndicator.className = \"status-indicator active\";\n      statusText.textContent = \"Active\";\n      subscribeBtn.style.display = \"none\";\n      unsubscribeBtn.style.display = \"inline-flex\";\n      testBtn.style.display = \"inline-flex\";\n    } else if (canSubscribe) {\n      statusIndicator.className = \"status-indicator inactive\";\n      statusText.textContent = \"Not Subscribed\";\n      subscribeBtn.style.display = \"inline-flex\";\n      unsubscribeBtn.style.display = \"none\";\n      testBtn.style.display = \"none\";\n    } else {\n      statusIndicator.className = \"status-indicator error\";\n      statusText.textContent = \"Not Available\";\n      subscribeBtn.style.display = \"none\";\n      unsubscribeBtn.style.display = \"none\";\n      testBtn.style.display = \"none\";\n    }\n  }\n\n  showMessage(message) {\n    // Create a toast notification\n    const toast = createElement(\"div\", { class: \"toast-notification\" });\n    toast.textContent = message;\n    document.body.appendChild(toast);\n\n    setTimeout(() => {\n      toast.classList.add(\"show\");\n    }, 100);\n\n    setTimeout(() => {\n      toast.classList.remove(\"show\");\n      setTimeout(() => {\n        document.body.removeChild(toast);\n      }, 300);\n    }, 4000);\n  }\n}","// src/js/views/favorites.js\nimport { createElement } from \"../utils/dom.js\";\nimport { getStoredStories, deleteStory } from \"../db.js\";\nimport { initMap, addMarker } from \"../map.js\";\n\nexport default class FavoritesView {\n  constructor() {\n    this.stories = [];\n  }\n\n  async init() {\n    const content = createElement(\"div\", { \n      class: \"home-container\",\n      role: \"region\",\n      \"aria-label\": \"Cerita Favorit\"\n    });\n    \n    content.innerHTML = `\n      <h2 id=\"favorites-title\">Cerita Favorit</h2>\n      <div \n        id=\"favorites-list\" \n        role=\"feed\" \n        aria-labelledby=\"favorites-title\"\n      ></div>\n    `;\n    \n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n\n    await this.loadFavorites();\n  }\n\n  async loadFavorites() {\n    try {\n      this.stories = await getStoredStories();\n      this.displayStories();\n    } catch (error) {\n      this.showMessage(`Gagal memuat cerita favorit: ${error.message}`);\n    }\n  }\n\n  displayStories() {\n    const favoritesList = document.getElementById(\"favorites-list\");\n    \n    if (this.stories.length === 0) {\n      favoritesList.innerHTML = `\n        <div class=\"empty-state\">\n          <p>Belum ada cerita favorit.</p>\n          <a href=\"#/home\" class=\"back-home\">Kembali ke Beranda</a>\n        </div>\n      `;\n      return;\n    }\n\n    favoritesList.innerHTML = \"\";\n    \n    this.stories.forEach((story) => {\n      const storyItem = createElement(\"div\", { \n        class: \"story-item\",\n        role: \"article\"\n      });\n      \n      storyItem.innerHTML = `\n        <h3>${story.name}</h3>\n        <p>${story.description}</p>\n        <img \n          src=\"${story.photoUrl}\" \n          alt=\"Foto untuk cerita: ${story.description.substring(0, 50)}...\" \n          loading=\"lazy\"\n          class=\"story-image\"\n        >\n        <p>Dibuat pada: ${new Date(story.createdAt).toLocaleDateString('id-ID', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric'\n        })}</p>\n        ${\n          story.lat && story.lon\n            ? `<div \n                id=\"map-${story.id}\" \n                class=\"story-map\" \n                role=\"complementary\" \n                aria-label=\"Lokasi cerita di peta\"\n              ></div>`\n            : \"\"\n        }\n        <div class=\"story-actions\">\n          <button \n            class=\"remove-favorite-btn\" \n            data-story-id=\"${story.id}\"\n            aria-label=\"Hapus dari favorit\"\n          >\n            Hapus dari Favorit\n          </button>\n        </div>\n      `;\n      \n      favoritesList.appendChild(storyItem);\n\n      if (story.lat && story.lon) {\n        this.initMap(`map-${story.id}`, story.lat, story.lon, story.name);\n      }\n    });\n\n    // Add event listeners for remove buttons\n    document.querySelectorAll('.remove-favorite-btn').forEach(btn => {\n      btn.addEventListener('click', async (e) => {\n        const storyId = e.target.dataset.storyId;\n        await this.removeFavorite(storyId);\n      });\n    });\n  }\n\n  async removeFavorite(storyId) {\n    try {\n      await deleteStory(storyId);\n      await this.loadFavorites(); // Reload the list\n      this.showMessage(\"Cerita berhasil dihapus dari favorit!\");\n    } catch (error) {\n      this.showMessage(`Gagal menghapus cerita: ${error.message}`);\n    }\n  }\n\n  initMap(containerId, lat, lon, popupText) {\n    if (lat && lon) {\n      const map = initMap(containerId, lat, lon, 13);\n      addMarker(map, lat, lon, popupText);\n    }\n  }\n\n  showMessage(message) {\n    alert(message);\n  }\n}","// src/js/views/about.js\nimport { createElement } from \"../utils/dom.js\";\n\nexport default class AboutView {\n  async init() {\n    const content = createElement(\"div\", { \n      class: \"about-container\",\n      role: \"main\"\n    });\n    \n    content.innerHTML = `\n      <div class=\"about-hero\">\n        <div class=\"container\">\n          <h1>About StoryApp</h1>\n          <p class=\"hero-subtitle\">Connecting people through shared experiences</p>\n        </div>\n      </div>\n\n      <div class=\"about-content\">\n        <div class=\"container\">\n          <section class=\"about-section\">\n            <div class=\"section-content\">\n              <div class=\"text-content\">\n                <h2>Our Mission</h2>\n                <p>StoryApp is designed to bring people together through the power of storytelling. We believe that every moment has a story worth sharing, and every story has the potential to inspire, connect, and create meaningful relationships within the Dicoding community.</p>\n                <p>Built as part of the Dicoding Web Development course, this application demonstrates modern web technologies while providing a platform for authentic human connection.</p>\n              </div>\n              <div class=\"image-content\">\n                <div class=\"mission-icon\">🌟</div>\n              </div>\n            </div>\n          </section>\n\n          <section class=\"features-showcase\">\n            <h2>What Makes Us Special</h2>\n            <div class=\"features-grid\">\n              <div class=\"feature-item\">\n                <div class=\"feature-icon\">📱</div>\n                <h3>Progressive Web App</h3>\n                <p>Install on any device for a native app experience with offline capabilities</p>\n              </div>\n              <div class=\"feature-item\">\n                <div class=\"feature-icon\">🗺️</div>\n                <h3>Location Integration</h3>\n                <p>Share where your stories happen with interactive maps powered by OpenStreetMap</p>\n              </div>\n              <div class=\"feature-item\">\n                <div class=\"feature-icon\">📸</div>\n                <h3>Camera Integration</h3>\n                <p>Capture moments directly from your device's camera</p>\n              </div>\n              <div class=\"feature-item\">\n                <div class=\"feature-icon\">🔔</div>\n                <h3>Push Notifications</h3>\n                <p>Stay updated with new stories from the community</p>\n              </div>\n              <div class=\"feature-item\">\n                <div class=\"feature-icon\">♿</div>\n                <h3>Accessibility First</h3>\n                <p>Built with WCAG standards for inclusive user experience</p>\n              </div>\n              <div class=\"feature-item\">\n                <div class=\"feature-icon\">⚡</div>\n                <h3>Fast & Responsive</h3>\n                <p>Optimized performance with smooth transitions and modern design</p>\n              </div>\n            </div>\n          </section>\n\n          <section class=\"tech-stack\">\n            <h2>Technology Stack</h2>\n            <div class=\"tech-grid\">\n              <div class=\"tech-item\">\n                <h4>Frontend</h4>\n                <ul>\n                  <li>Vanilla JavaScript (ES6+)</li>\n                  <li>HTML5 & CSS3</li>\n                  <li>Progressive Web App</li>\n                  <li>Service Workers</li>\n                </ul>\n              </div>\n              <div class=\"tech-item\">\n                <h4>Architecture</h4>\n                <ul>\n                  <li>Single Page Application (SPA)</li>\n                  <li>MVP Pattern</li>\n                  <li>Hash-based Routing</li>\n                  <li>Modular Design</li>\n                </ul>\n              </div>\n              <div class=\"tech-item\">\n                <h4>APIs & Libraries</h4>\n                <ul>\n                  <li>Dicoding Story API</li>\n                  <li>Leaflet.js for Maps</li>\n                  <li>IndexedDB for Storage</li>\n                  <li>Web Push API</li>\n                </ul>\n              </div>\n              <div class=\"tech-item\">\n                <h4>Features</h4>\n                <ul>\n                  <li>Camera Access</li>\n                  <li>Geolocation</li>\n                  <li>Offline Support</li>\n                  <li>Push Notifications</li>\n                </ul>\n              </div>\n            </div>\n          </section>\n\n          <section class=\"team-section\">\n            <h2>Development Team</h2>\n            <div class=\"team-info\">\n              <div class=\"team-member\">\n                <div class=\"member-avatar\">👨‍💻</div>\n                <h3>Dicoding Student</h3>\n                <p>Full Stack Developer</p>\n                <p>Passionate about creating meaningful web applications that connect people and communities.</p>\n              </div>\n            </div>\n          </section>\n\n          <section class=\"contact-section\">\n            <h2>Get In Touch</h2>\n            <div class=\"contact-info\">\n              <p>Have questions, suggestions, or feedback? We'd love to hear from you!</p>\n              <div class=\"contact-methods\">\n                <div class=\"contact-item\">\n                  <span class=\"contact-icon\">🌐</span>\n                  <span>Visit Dicoding.com</span>\n                </div>\n                <div class=\"contact-item\">\n                  <span class=\"contact-icon\">💬</span>\n                  <span>Join our Community</span>\n                </div>\n                <div class=\"contact-item\">\n                  <span class=\"contact-icon\">📧</span>\n                  <span>Share your feedback</span>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          <section class=\"acknowledgments\">\n            <h2>Acknowledgments</h2>\n            <p>Special thanks to:</p>\n            <ul>\n              <li><strong>Dicoding Indonesia</strong> - For providing excellent web development education</li>\n              <li><strong>OpenStreetMap</strong> - For free and open map data</li>\n              <li><strong>Leaflet.js</strong> - For beautiful interactive maps</li>\n              <li><strong>The Web Community</strong> - For continuous innovation and open source contributions</li>\n            </ul>\n          </section>\n        </div>\n      </div>\n    `;\n    \n    document.getElementById(\"content\").innerHTML = \"\";\n    document.getElementById(\"content\").appendChild(content);\n  }\n}","import { createElement } from '../utils/dom.js';\n\nexport default class NotFoundView {\n  init() {\n    const content = createElement('div', { class: 'not-found-container' });\n    content.innerHTML = `\n      <h2>404 - Halaman Tidak Ditemukan</h2>\n      <p>Maaf, halaman yang Anda cari tidak ditemukan.</p>\n      <a href=\"#/home\" class=\"back-home\">Kembali ke Beranda</a>\n    `;\n    document.getElementById('content').innerHTML = '';\n    document.getElementById('content').appendChild(content);\n  }\n}","// src/js/utils/transition.js\nexport function navigateWithTransition(callback) {\n  const content = document.getElementById(\"content\");\n  content.style.opacity = \"0\";\n  setTimeout(() => {\n    callback();\n    content.style.opacity = \"1\";\n  }, 300);\n}\n","// src/js/router.js\n\nimport HomeView from \"./views/home.js\";\nimport LandingView from \"./views/landing.js\";\nimport StoriesView from \"./views/stories.js\";\nimport AddStoryView from \"./views/add-story.js\";\nimport DetailView from \"./views/detail.js\";\nimport LoginView from \"./views/login.js\";\nimport RegisterView from \"./views/register.js\";\nimport SubscribeView from \"./views/subscribe.js\";\nimport FavoritesView from \"./views/favorites.js\";\nimport AboutView from \"./views/about.js\";\nimport NotFoundView from \"./views/not-found.js\";\nimport { navigateWithTransition } from \"./utils/transition.js\";\nimport { getToken, removeToken } from \"./utils/auth.js\";\n\nconst routes = {\n  \"#/\": LandingView,\n  \"#/home\": HomeView,\n  \"#/stories\": StoriesView,\n  \"#/add-story\": AddStoryView,\n  \"#/detail/:id\": DetailView,\n  \"#/login\": LoginView,\n  \"#/register\": RegisterView,\n  \"#/subscribe\": SubscribeView,\n  \"#/favorites\": FavoritesView,\n  \"#/about\": AboutView,\n  \"#/404\": NotFoundView,\n};\n\n// =======================================================\n// PERBAIKAN: Variabel untuk menyimpan instance view saat ini\n// =======================================================\nlet currentViewInstance = null;\n\nexport function initRouter() {\n  updateNavLinks();\n  window.addEventListener(\"hashchange\", () => {\n    updateNavLinks();\n    renderPage();\n  });\n  window.addEventListener(\"load\", () => {\n    updateNavLinks();\n    renderPage();\n  });\n\n  document.getElementById(\"logout-link\").addEventListener(\"click\", (e) => {\n    e.preventDefault();\n    removeToken();\n    updateNavLinks();\n    window.location.hash = \"#/login\";\n  });\n}\n\nfunction updateNavLinks() {\n  // ... (Fungsi ini tidak berubah) ...\n  const token = getToken();\n  const loginLink = document.getElementById(\"login-link\");\n  const logoutLink = document.getElementById(\"logout-link\");\n  const subscribeLink = document.getElementById(\"subscribe-link\");\n  const favoritesLink = document.getElementById(\"favorites-link\");\n  const userWelcome = document.getElementById(\"user-welcome\");\n\n  if (token) {\n    loginLink.style.display = \"none\";\n    logoutLink.style.display = \"inline\";\n    if (subscribeLink) subscribeLink.style.display = \"inline\";\n    if (favoritesLink) favoritesLink.style.display = \"inline\";\n\n    if (userWelcome) {\n      const userData = getUserData();\n      userWelcome.textContent = `Hi, ${userData.name || \"User\"}`;\n      userWelcome.style.display = \"inline\";\n    }\n  } else {\n    loginLink.style.display = \"inline\";\n    logoutLink.style.display = \"none\";\n    if (subscribeLink) subscribeLink.style.display = \"none\";\n    if (favoritesLink) favoritesLink.style.display = \"none\";\n    if (userWelcome) userWelcome.style.display = \"none\";\n  }\n}\n\nfunction getUserData() {\n  // ... (Fungsi ini tidak berubah) ...\n  try {\n    const userData = localStorage.getItem(\"userData\");\n    return userData ? JSON.parse(userData) : { name: \"User\" };\n  } catch (error) {\n    return { name: \"User\" };\n  }\n}\n\nfunction renderPage() {\n  // =======================================================\n  // PERBAIKAN: Panggil metode destroy dari view lama jika ada\n  // =======================================================\n  if (\n    currentViewInstance &&\n    typeof currentViewInstance.destroy === \"function\"\n  ) {\n    currentViewInstance.destroy();\n  }\n  // =======================================================\n\n  const hash = window.location.hash || \"#/\";\n  const route = Object.keys(routes).find((key) => {\n    const regex = new RegExp(`^${key.replace(\":id\", \"([^/]+)\")}$`);\n    return regex.test(hash);\n  });\n\n  if (route) {\n    const ViewClass = routes[route];\n    const view = new ViewClass();\n\n    // Simpan instance view baru ke variabel global\n    currentViewInstance = view;\n\n    if (route === \"#/detail/:id\") {\n      const match = hash.match(\n        new RegExp(`^${route.replace(\":id\", \"([^/]+)\")}$`)\n      );\n      const id = match ? match[1] : null;\n      navigateWithTransition(() => view.init({ id }));\n    } else {\n      navigateWithTransition(() => view.init());\n    }\n  } else {\n    const notFoundView = new NotFoundView();\n    currentViewInstance = notFoundView; // Simpan juga untuk halaman not found\n    window.location.hash = \"#/404\";\n    navigateWithTransition(() => notFoundView.init());\n  }\n}\n","// src/js/utils/performance.js - Performance optimization utilities\nexport class PerformanceMonitor {\n  constructor() {\n    this.metrics = new Map();\n    this.observers = new Map();\n  }\n\n  // Measure page load performance\n  measurePageLoad(pageName) {\n    const startTime = performance.now();\n    \n    return {\n      end: () => {\n        const endTime = performance.now();\n        const duration = endTime - startTime;\n        this.metrics.set(`page-load-${pageName}`, duration);\n        console.log(`Page ${pageName} loaded in ${duration.toFixed(2)}ms`);\n        return duration;\n      }\n    };\n  }\n\n  // Lazy load images with Intersection Observer\n  lazyLoadImages() {\n    if ('IntersectionObserver' in window) {\n      const imageObserver = new IntersectionObserver((entries, observer) => {\n        entries.forEach(entry => {\n          if (entry.isIntersecting) {\n            const img = entry.target;\n            img.src = img.dataset.src;\n            img.classList.remove('lazy');\n            observer.unobserve(img);\n          }\n        });\n      });\n\n      document.querySelectorAll('img[data-src]').forEach(img => {\n        imageObserver.observe(img);\n      });\n    }\n  }\n\n  // Preload critical resources\n  preloadCriticalResources() {\n    const criticalResources = [\n      '/assets/css/styles.css',\n      'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css',\n      'https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap'\n    ];\n\n    criticalResources.forEach(resource => {\n      const link = document.createElement('link');\n      link.rel = 'preload';\n      link.as = resource.endsWith('.css') ? 'style' : 'script';\n      link.href = resource;\n      document.head.appendChild(link);\n    });\n  }\n\n  // Monitor Core Web Vitals\n  monitorWebVitals() {\n    // Largest Contentful Paint\n    if ('PerformanceObserver' in window) {\n      const lcpObserver = new PerformanceObserver((entryList) => {\n        const entries = entryList.getEntries();\n        const lastEntry = entries[entries.length - 1];\n        console.log('LCP:', lastEntry.startTime);\n      });\n      lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });\n\n      // First Input Delay\n      const fidObserver = new PerformanceObserver((entryList) => {\n        const entries = entryList.getEntries();\n        entries.forEach(entry => {\n          console.log('FID:', entry.processingStart - entry.startTime);\n        });\n      });\n      fidObserver.observe({ entryTypes: ['first-input'] });\n    }\n  }\n\n  // Get performance metrics\n  getMetrics() {\n    return Object.fromEntries(this.metrics);\n  }\n}\n\n// Image optimization utility\nexport function optimizeImage(file, maxWidth = 1200, quality = 0.8) {\n  return new Promise((resolve) => {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    const img = new Image();\n\n    img.onload = () => {\n      // Calculate new dimensions\n      const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);\n      canvas.width = img.width * ratio;\n      canvas.height = img.height * ratio;\n\n      // Draw and compress\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      canvas.toBlob(resolve, 'image/jpeg', quality);\n    };\n\n    img.src = URL.createObjectURL(file);\n  });\n}\n\n// Debounce utility for performance\nexport function debounce(func, wait) {\n  let timeout;\n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n\n// Throttle utility for scroll events\nexport function throttle(func, limit) {\n  let inThrottle;\n  return function() {\n    const args = arguments;\n    const context = this;\n    if (!inThrottle) {\n      func.apply(context, args);\n      inThrottle = true;\n      setTimeout(() => inThrottle = false, limit);\n    }\n  };\n}","// src/js/utils/error-handler.js - Centralized error handling\nexport class ErrorHandler {\n  constructor() {\n    this.setupGlobalErrorHandling();\n    this.errorQueue = [];\n    this.maxErrors = 50;\n  }\n\n  setupGlobalErrorHandling() {\n    // Handle JavaScript errors\n    window.addEventListener('error', (event) => {\n      this.logError({\n        type: 'javascript',\n        message: event.message,\n        filename: event.filename,\n        lineno: event.lineno,\n        colno: event.colno,\n        stack: event.error?.stack,\n        timestamp: new Date().toISOString()\n      });\n    });\n\n    // Handle unhandled promise rejections\n    window.addEventListener('unhandledrejection', (event) => {\n      this.logError({\n        type: 'promise',\n        message: event.reason?.message || 'Unhandled promise rejection',\n        stack: event.reason?.stack,\n        timestamp: new Date().toISOString()\n      });\n    });\n\n    // Handle network errors\n    window.addEventListener('offline', () => {\n      this.showUserFriendlyError('You are offline. Some features may not work.');\n    });\n\n    window.addEventListener('online', () => {\n      this.showUserFriendlyMessage('Connection restored!');\n    });\n  }\n\n  logError(error) {\n    console.error('Error logged:', error);\n    \n    // Add to error queue\n    this.errorQueue.push(error);\n    \n    // Keep only recent errors\n    if (this.errorQueue.length > this.maxErrors) {\n      this.errorQueue.shift();\n    }\n\n    // Store in localStorage for debugging\n    try {\n      localStorage.setItem('app-errors', JSON.stringify(this.errorQueue.slice(-10)));\n    } catch (e) {\n      // localStorage might be full\n    }\n\n    // Show user-friendly message for critical errors\n    if (this.isCriticalError(error)) {\n      this.showUserFriendlyError('Something went wrong. Please try refreshing the page.');\n    }\n  }\n\n  isCriticalError(error) {\n    const criticalPatterns = [\n      /network/i,\n      /fetch/i,\n      /api/i,\n      /authentication/i,\n      /authorization/i\n    ];\n    \n    return criticalPatterns.some(pattern => \n      pattern.test(error.message) || pattern.test(error.stack || '')\n    );\n  }\n\n  showUserFriendlyError(message) {\n    this.showToast(message, 'error');\n  }\n\n  showUserFriendlyMessage(message) {\n    this.showToast(message, 'success');\n  }\n\n  showToast(message, type = 'info') {\n    const toast = document.createElement('div');\n    toast.className = `toast-notification ${type}`;\n    toast.textContent = message;\n    \n    document.body.appendChild(toast);\n    \n    setTimeout(() => toast.classList.add('show'), 100);\n    \n    setTimeout(() => {\n      toast.classList.remove('show');\n      setTimeout(() => {\n        if (document.body.contains(toast)) {\n          document.body.removeChild(toast);\n        }\n      }, 300);\n    }, 4000);\n  }\n\n  // Get error reports for debugging\n  getErrorReports() {\n    return this.errorQueue;\n  }\n\n  // Clear error queue\n  clearErrors() {\n    this.errorQueue = [];\n    localStorage.removeItem('app-errors');\n  }\n}\n\n// API error handler\nexport function handleApiError(error, context = '') {\n  const errorHandler = new ErrorHandler();\n  \n  let userMessage = 'Something went wrong. Please try again.';\n  \n  if (error.message.includes('network') || error.message.includes('fetch')) {\n    userMessage = 'Network error. Please check your connection.';\n  } else if (error.message.includes('401') || error.message.includes('unauthorized')) {\n    userMessage = 'Please log in again.';\n    // Redirect to login\n    setTimeout(() => {\n      window.location.hash = '#/login';\n    }, 2000);\n  } else if (error.message.includes('403') || error.message.includes('forbidden')) {\n    userMessage = 'You do not have permission to perform this action.';\n  } else if (error.message.includes('404')) {\n    userMessage = 'The requested resource was not found.';\n  } else if (error.message.includes('500')) {\n    userMessage = 'Server error. Please try again later.';\n  }\n\n  errorHandler.logError({\n    type: 'api',\n    context,\n    message: error.message,\n    stack: error.stack,\n    timestamp: new Date().toISOString()\n  });\n\n  errorHandler.showUserFriendlyError(userMessage);\n  \n  return userMessage;\n}","// src/js/utils/analytics.js - Privacy-focused analytics\nexport class Analytics {\n  constructor() {\n    this.events = [];\n    this.sessionId = this.generateSessionId();\n    this.startTime = Date.now();\n  }\n\n  generateSessionId() {\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n  }\n\n  // Track page views\n  trackPageView(page) {\n    this.trackEvent('page_view', {\n      page,\n      timestamp: Date.now(),\n      session_id: this.sessionId\n    });\n  }\n\n  // Track user interactions\n  trackEvent(eventName, properties = {}) {\n    const event = {\n      event: eventName,\n      properties: {\n        ...properties,\n        timestamp: Date.now(),\n        session_id: this.sessionId,\n        user_agent: navigator.userAgent,\n        viewport: `${window.innerWidth}x${window.innerHeight}`,\n        connection: navigator.connection?.effectiveType || 'unknown'\n      }\n    };\n\n    this.events.push(event);\n    console.log('Analytics event:', event);\n\n    // Keep only recent events in memory\n    if (this.events.length > 100) {\n      this.events.shift();\n    }\n\n    // Store in localStorage for offline analysis\n    this.storeEvents();\n  }\n\n  // Track story interactions\n  trackStoryInteraction(action, storyId) {\n    this.trackEvent('story_interaction', {\n      action, // 'view', 'like', 'share', 'save'\n      story_id: storyId\n    });\n  }\n\n  // Track app performance\n  trackPerformance(metric, value) {\n    this.trackEvent('performance', {\n      metric,\n      value,\n      page: window.location.hash\n    });\n  }\n\n  // Track errors (privacy-safe)\n  trackError(errorType, message) {\n    this.trackEvent('error', {\n      type: errorType,\n      message: message.substring(0, 100), // Limit message length\n      page: window.location.hash\n    });\n  }\n\n  // Store events locally\n  storeEvents() {\n    try {\n      const recentEvents = this.events.slice(-50); // Keep only 50 recent events\n      localStorage.setItem('analytics_events', JSON.stringify(recentEvents));\n    } catch (error) {\n      console.warn('Could not store analytics events:', error);\n    }\n  }\n\n  // Get analytics summary\n  getAnalyticsSummary() {\n    const sessionDuration = Date.now() - this.startTime;\n    const pageViews = this.events.filter(e => e.event === 'page_view').length;\n    const storyInteractions = this.events.filter(e => e.event === 'story_interaction').length;\n    const errors = this.events.filter(e => e.event === 'error').length;\n\n    return {\n      session_id: this.sessionId,\n      session_duration: sessionDuration,\n      page_views: pageViews,\n      story_interactions: storyInteractions,\n      errors: errors,\n      total_events: this.events.length\n    };\n  }\n\n  // Export data for analysis (privacy-compliant)\n  exportData() {\n    return {\n      summary: this.getAnalyticsSummary(),\n      events: this.events.map(event => ({\n        ...event,\n        properties: {\n          ...event.properties,\n          // Remove potentially sensitive data\n          user_agent: undefined\n        }\n      }))\n    };\n  }\n}\n\n// Initialize analytics\nexport const analytics = new Analytics();\n\n// Auto-track page views\nwindow.addEventListener('hashchange', () => {\n  analytics.trackPageView(window.location.hash);\n});\n\n// Track app installation\nwindow.addEventListener('beforeinstallprompt', () => {\n  analytics.trackEvent('install_prompt_shown');\n});\n\n// Track app usage patterns\nwindow.addEventListener('visibilitychange', () => {\n  if (document.hidden) {\n    analytics.trackEvent('app_backgrounded');\n  } else {\n    analytics.trackEvent('app_foregrounded');\n  }\n});","// src/js/utils/accessibility.js - Enhanced accessibility features\nexport class AccessibilityManager {\n  constructor() {\n    this.setupKeyboardNavigation();\n    this.setupScreenReaderSupport();\n    this.setupFocusManagement();\n    this.setupColorContrastDetection();\n  }\n\n  setupKeyboardNavigation() {\n    // Global keyboard shortcuts\n    document.addEventListener('keydown', (event) => {\n      // Skip to main content (Alt + M)\n      if (event.altKey && event.key === 'm') {\n        event.preventDefault();\n        const mainContent = document.getElementById('main-content');\n        if (mainContent) {\n          mainContent.focus();\n          this.announceToScreenReader('Jumped to main content');\n        }\n      }\n\n      // Open navigation menu (Alt + N)\n      if (event.altKey && event.key === 'n') {\n        event.preventDefault();\n        const nav = document.querySelector('nav');\n        if (nav) {\n          const firstLink = nav.querySelector('a');\n          if (firstLink) {\n            firstLink.focus();\n            this.announceToScreenReader('Navigation menu focused');\n          }\n        }\n      }\n\n      // Search functionality (Alt + S)\n      if (event.altKey && event.key === 's') {\n        event.preventDefault();\n        // Focus search if available\n        const searchInput = document.querySelector('input[type=\"search\"]');\n        if (searchInput) {\n          searchInput.focus();\n          this.announceToScreenReader('Search focused');\n        }\n      }\n\n      // Escape key to close modals/overlays\n      if (event.key === 'Escape') {\n        this.closeActiveModal();\n      }\n    });\n\n    // Arrow key navigation for story grids\n    this.setupGridNavigation();\n  }\n\n  setupGridNavigation() {\n    document.addEventListener('keydown', (event) => {\n      const activeElement = document.activeElement;\n      const storyItems = Array.from(document.querySelectorAll('.story-item'));\n      \n      if (storyItems.includes(activeElement)) {\n        const currentIndex = storyItems.indexOf(activeElement);\n        let nextIndex = currentIndex;\n\n        switch (event.key) {\n          case 'ArrowRight':\n            nextIndex = Math.min(currentIndex + 1, storyItems.length - 1);\n            break;\n          case 'ArrowLeft':\n            nextIndex = Math.max(currentIndex - 1, 0);\n            break;\n          case 'ArrowDown':\n            // Move to next row (assuming 3 columns)\n            nextIndex = Math.min(currentIndex + 3, storyItems.length - 1);\n            break;\n          case 'ArrowUp':\n            // Move to previous row\n            nextIndex = Math.max(currentIndex - 3, 0);\n            break;\n          default:\n            return;\n        }\n\n        if (nextIndex !== currentIndex) {\n          event.preventDefault();\n          storyItems[nextIndex].focus();\n        }\n      }\n    });\n  }\n\n  setupScreenReaderSupport() {\n    // Create live region for announcements\n    this.liveRegion = document.createElement('div');\n    this.liveRegion.setAttribute('aria-live', 'polite');\n    this.liveRegion.setAttribute('aria-atomic', 'true');\n    this.liveRegion.className = 'sr-only';\n    this.liveRegion.style.cssText = `\n      position: absolute;\n      width: 1px;\n      height: 1px;\n      padding: 0;\n      margin: -1px;\n      overflow: hidden;\n      clip: rect(0, 0, 0, 0);\n      white-space: nowrap;\n      border: 0;\n    `;\n    document.body.appendChild(this.liveRegion);\n\n    // Announce page changes\n    this.observePageChanges();\n  }\n\n  observePageChanges() {\n    const observer = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (mutation.type === 'childList' && mutation.target.id === 'content') {\n          const newContent = mutation.target.querySelector('h1, h2');\n          if (newContent) {\n            setTimeout(() => {\n              this.announceToScreenReader(`Page loaded: ${newContent.textContent}`);\n            }, 500);\n          }\n        }\n      });\n    });\n\n    const contentElement = document.getElementById('content');\n    if (contentElement) {\n      observer.observe(contentElement, { childList: true, subtree: true });\n    }\n  }\n\n  announceToScreenReader(message) {\n    if (this.liveRegion) {\n      this.liveRegion.textContent = message;\n      // Clear after announcement\n      setTimeout(() => {\n        this.liveRegion.textContent = '';\n      }, 1000);\n    }\n  }\n\n  setupFocusManagement() {\n    // Track focus for better UX\n    let lastFocusedElement = null;\n\n    document.addEventListener('focusin', (event) => {\n      lastFocusedElement = event.target;\n    });\n\n    // Restore focus when returning from modal\n    this.restoreFocus = () => {\n      if (lastFocusedElement && document.contains(lastFocusedElement)) {\n        lastFocusedElement.focus();\n      }\n    };\n\n    // Focus trap for modals\n    this.setupFocusTrap();\n  }\n\n  setupFocusTrap() {\n    document.addEventListener('keydown', (event) => {\n      if (event.key === 'Tab') {\n        const modal = document.querySelector('.modal:not([hidden])');\n        if (modal) {\n          const focusableElements = modal.querySelectorAll(\n            'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n          );\n          \n          if (focusableElements.length === 0) return;\n\n          const firstElement = focusableElements[0];\n          const lastElement = focusableElements[focusableElements.length - 1];\n\n          if (event.shiftKey) {\n            if (document.activeElement === firstElement) {\n              event.preventDefault();\n              lastElement.focus();\n            }\n          } else {\n            if (document.activeElement === lastElement) {\n              event.preventDefault();\n              firstElement.focus();\n            }\n          }\n        }\n      }\n    });\n  }\n\n  setupColorContrastDetection() {\n    // Check if user prefers high contrast\n    if (window.matchMedia('(prefers-contrast: high)').matches) {\n      document.body.classList.add('high-contrast');\n    }\n\n    // Check if user prefers reduced motion\n    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {\n      document.body.classList.add('reduced-motion');\n    }\n\n    // Listen for changes\n    window.matchMedia('(prefers-contrast: high)').addEventListener('change', (e) => {\n      document.body.classList.toggle('high-contrast', e.matches);\n    });\n\n    window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', (e) => {\n      document.body.classList.toggle('reduced-motion', e.matches);\n    });\n  }\n\n  closeActiveModal() {\n    const activeModal = document.querySelector('.modal:not([hidden])');\n    if (activeModal) {\n      activeModal.hidden = true;\n      this.restoreFocus();\n      this.announceToScreenReader('Modal closed');\n    }\n  }\n\n  // Add ARIA labels dynamically\n  enhanceAriaLabels() {\n    // Enhance story items\n    document.querySelectorAll('.story-item').forEach((item, index) => {\n      if (!item.getAttribute('aria-label')) {\n        const title = item.querySelector('h3')?.textContent || 'Story';\n        const author = item.querySelector('.author-info h3')?.textContent || 'Unknown author';\n        item.setAttribute('aria-label', `Story ${index + 1}: ${title} by ${author}`);\n      }\n    });\n\n    // Enhance buttons without labels\n    document.querySelectorAll('button:not([aria-label])').forEach(button => {\n      const text = button.textContent.trim();\n      const icon = button.querySelector('.btn-icon')?.textContent;\n      if (text) {\n        button.setAttribute('aria-label', text);\n      } else if (icon) {\n        button.setAttribute('aria-label', `Button with ${icon} icon`);\n      }\n    });\n  }\n\n  // Check accessibility compliance\n  auditAccessibility() {\n    const issues = [];\n\n    // Check for missing alt text\n    document.querySelectorAll('img:not([alt])').forEach(img => {\n      issues.push(`Image missing alt text: ${img.src}`);\n    });\n\n    // Check for missing form labels\n    document.querySelectorAll('input:not([aria-label]):not([aria-labelledby])').forEach(input => {\n      const label = document.querySelector(`label[for=\"${input.id}\"]`);\n      if (!label) {\n        issues.push(`Input missing label: ${input.type} input`);\n      }\n    });\n\n    // Check for missing headings\n    const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');\n    if (headings.length === 0) {\n      issues.push('Page missing heading structure');\n    }\n\n    // Check for color contrast (basic check)\n    this.checkColorContrast(issues);\n\n    return issues;\n  }\n\n  checkColorContrast(issues) {\n    // This is a simplified check - in production, you'd use a proper contrast checking library\n    const elements = document.querySelectorAll('*');\n    elements.forEach(element => {\n      const styles = window.getComputedStyle(element);\n      const color = styles.color;\n      const backgroundColor = styles.backgroundColor;\n      \n      // Basic check for very light text on light background\n      if (color === 'rgb(255, 255, 255)' && backgroundColor === 'rgb(255, 255, 255)') {\n        issues.push(`Potential contrast issue: white text on white background`);\n      }\n    });\n  }\n}\n\n// Initialize accessibility manager\nexport const accessibilityManager = new AccessibilityManager();\n\n// Auto-enhance ARIA labels when content changes\nconst observer = new MutationObserver(() => {\n  accessibilityManager.enhanceAriaLabels();\n});\n\nobserver.observe(document.body, { childList: true, subtree: true });","// src/js/main.js - Enhanced main entry point with all improvements\nimport { initRouter } from \"./router.js\";\nimport { initDB } from \"./db.js\";\nimport { Workbox } from \"workbox-window\";\nimport {\n  getNotificationStatus,\n  subscribePushNotification,\n  unsubscribePushNotification,\n} from \"./notification.js\";\nimport { getToken } from \"./utils/auth.js\";\nimport { PerformanceMonitor } from \"./utils/performance.js\";\nimport { ErrorHandler } from \"./utils/error-handler.js\";\nimport { analytics } from \"./utils/analytics.js\";\nimport { accessibilityManager } from \"./utils/accessibility.js\";\n\n// Initialize performance monitoring\nconst performanceMonitor = new PerformanceMonitor();\nconst errorHandler = new ErrorHandler();\n\nasync function init() {\n  const pageLoadMetric = performanceMonitor.measurePageLoad(\"app-init\");\n\n  try {\n    // Initialize core systems\n    await initDB();\n    initRouter();\n\n    // Setup PWA features\n    setupInstallPrompt();\n    setupNotificationUI();\n\n    // Initialize performance optimizations\n    performanceMonitor.preloadCriticalResources();\n    performanceMonitor.lazyLoadImages();\n    performanceMonitor.monitorWebVitals();\n\n    // Setup Service Worker\n    if (\"serviceWorker\" in navigator) {\n      const wb = new Workbox(\"/sw.js\");\n\n      wb.addEventListener(\"installed\", (event) => {\n        if (event.isUpdate) {\n          showUpdateNotification(wb);\n        }\n        analytics.trackEvent(\"sw_installed\", { isUpdate: event.isUpdate });\n      });\n\n      wb.addEventListener(\"waiting\", (event) => {\n        showUpdateNotification(wb);\n        analytics.trackEvent(\"sw_waiting\");\n      });\n\n      wb.addEventListener(\"controlling\", (event) => {\n        window.location.reload();\n        analytics.trackEvent(\"sw_controlling\");\n      });\n\n      wb.register();\n    }\n\n    // Track successful initialization\n    analytics.trackEvent(\"app_initialized\");\n  } catch (error) {\n    errorHandler.logError({\n      type: \"initialization\",\n      message: error.message,\n      stack: error.stack,\n      timestamp: new Date().toISOString(),\n    });\n  } finally {\n    pageLoadMetric.end();\n  }\n}\n\nfunction setupInstallPrompt() {\n  let deferredPrompt;\n  const installBtn = document.getElementById(\"install-app-btn\");\n\n  window.addEventListener(\"beforeinstallprompt\", (e) => {\n    e.preventDefault();\n    deferredPrompt = e;\n\n    if (installBtn) {\n      installBtn.style.display = \"flex\";\n    }\n\n    analytics.trackEvent(\"install_prompt_available\");\n  });\n\n  if (installBtn) {\n    installBtn.addEventListener(\"click\", async () => {\n      if (deferredPrompt) {\n        deferredPrompt.prompt();\n        const result = await deferredPrompt.userChoice;\n\n        analytics.trackEvent(\"install_prompt_result\", {\n          outcome: result.outcome,\n        });\n\n        if (result.outcome === \"accepted\") {\n          installBtn.style.display = \"none\";\n        }\n        deferredPrompt = null;\n      }\n    });\n  }\n\n  // Hide install button if app is already installed\n  if (window.matchMedia(\"(display-mode: standalone)\").matches) {\n    if (installBtn) {\n      installBtn.style.display = \"none\";\n    }\n    analytics.trackEvent(\"app_running_standalone\");\n  }\n}\n\nfunction setupNotificationUI() {\n  const header = document.querySelector(\"header nav ul\");\n  if (!header) return;\n\n  // Create notification button container\n  const notificationContainer = document.createElement(\"li\");\n  notificationContainer.id = \"notification-container\";\n  notificationContainer.style.display = \"none\";\n\n  const notificationBtn = document.createElement(\"button\");\n  notificationBtn.id = \"notification-btn\";\n  notificationBtn.className = \"notification-btn\";\n  notificationBtn.innerHTML =\n    '<span class=\"btn-icon\">🔔</span><span class=\"btn-text\">Notifications</span>';\n  notificationBtn.setAttribute(\"aria-label\", \"Toggle push notifications\");\n\n  notificationContainer.appendChild(notificationBtn);\n\n  // Insert before install button\n  const installBtn = document.getElementById(\"install-app-btn\");\n  if (installBtn && installBtn.parentElement) {\n    header.insertBefore(notificationContainer, installBtn.parentElement);\n  } else {\n    header.appendChild(notificationContainer);\n  }\n\n  // Setup notification button click handler\n  notificationBtn.addEventListener(\"click\", handleNotificationToggle);\n\n  // Update notification UI based on current status\n  updateNotificationUI();\n}\n\nasync function handleNotificationToggle() {\n  const token = getToken();\n  if (!token) {\n    showToast(\"Please login first to enable notifications\", \"warning\");\n    window.location.hash = \"#/login\";\n    return;\n  }\n\n  const notificationBtn = document.getElementById(\"notification-btn\");\n  if (!notificationBtn) return;\n\n  try {\n    notificationBtn.innerHTML =\n      '<span class=\"spinner-small\"></span> Processing...';\n    notificationBtn.disabled = true;\n\n    const status = await getNotificationStatus();\n\n    if (status.isSubscribed) {\n      // Unsubscribe\n      await unsubscribePushNotification(token);\n      showToast(\"Notifications disabled successfully\", \"success\");\n      analytics.trackEvent(\"notifications_disabled\");\n    } else {\n      // Subscribe\n      await subscribePushNotification(token);\n      showToast(\"Notifications enabled successfully\", \"success\");\n      analytics.trackEvent(\"notifications_enabled\");\n    }\n  } catch (error) {\n    console.error(\"Error toggling notifications:\", error);\n    showToast(`Error: ${error.message}`, \"error\");\n    analytics.trackEvent(\"notification_toggle_error\", {\n      error: error.message,\n    });\n  } finally {\n    // Cukup panggil updateNotificationUI untuk mengembalikan status tombol ke kondisi yang benar\n    // (termasuk menonaktifkannya jika perlu).\n    await updateNotificationUI();\n  }\n}\n\nasync function updateNotificationUI() {\n  const notificationContainer = document.getElementById(\n    \"notification-container\"\n  );\n  const notificationBtn = document.getElementById(\"notification-btn\");\n\n  if (!notificationContainer || !notificationBtn) return;\n\n  try {\n    const status = await getNotificationStatus();\n    const token = getToken();\n\n    // Show notification button only if user is logged in and notifications are supported\n    if (token && status.isSupported) {\n      notificationContainer.style.display = \"block\";\n      notificationBtn.disabled = false;\n\n      if (status.isSubscribed) {\n        notificationBtn.innerHTML =\n          '<span class=\"btn-icon\">🔕</span><span class=\"btn-text\">Disable</span>';\n        notificationBtn.className = \"notification-btn subscribed\";\n        notificationBtn.setAttribute(\n          \"aria-label\",\n          \"Disable push notifications\"\n        );\n      } else if (status.permission !== \"denied\") {\n        notificationBtn.innerHTML =\n          '<span class=\"btn-icon\">🔔</span><span class=\"btn-text\">Enable</span>';\n        notificationBtn.className = \"notification-btn unsubscribed\";\n        notificationBtn.setAttribute(\"aria-label\", \"Enable push notifications\");\n      } else {\n        notificationBtn.innerHTML =\n          '<span class=\"btn-icon\">🚫</span><span class=\"btn-text\">Blocked</span>';\n        notificationBtn.className = \"notification-btn blocked\";\n        notificationBtn.setAttribute(\n          \"aria-label\",\n          \"Notifications blocked in browser settings\"\n        );\n        notificationBtn.disabled = true;\n      }\n    } else {\n      notificationContainer.style.display = \"none\";\n    }\n  } catch (error) {\n    console.error(\"Error updating notification UI:\", error);\n    notificationContainer.style.display = \"none\";\n  }\n}\n\nfunction showUpdateNotification(wb) {\n  const updateBanner = document.createElement(\"div\");\n  updateBanner.className = \"update-banner\";\n  updateBanner.setAttribute(\"role\", \"alert\");\n  updateBanner.setAttribute(\"aria-live\", \"assertive\");\n  updateBanner.innerHTML = `\n    <div class=\"update-content\">\n      <span>🔄 App update available!</span>\n      <button id=\"update-btn\" class=\"btn btn-primary\" aria-label=\"Update app now\">Update Now</button>\n      <button id=\"dismiss-update\" class=\"btn btn-outline\" aria-label=\"Update later\">Later</button>\n    </div>\n  `;\n\n  document.body.appendChild(updateBanner);\n\n  document.getElementById(\"update-btn\").addEventListener(\"click\", () => {\n    wb.messageSkipWaiting();\n    updateBanner.remove();\n    analytics.trackEvent(\"app_update_accepted\");\n  });\n\n  document.getElementById(\"dismiss-update\").addEventListener(\"click\", () => {\n    updateBanner.remove();\n    analytics.trackEvent(\"app_update_dismissed\");\n  });\n}\n\nfunction showToast(message, type = \"success\") {\n  const toast = document.createElement(\"div\");\n  toast.className = `toast-notification ${type}`;\n  toast.textContent = message;\n  toast.setAttribute(\"role\", \"alert\");\n  toast.setAttribute(\"aria-live\", \"polite\");\n\n  document.body.appendChild(toast);\n\n  setTimeout(() => {\n    toast.classList.add(\"show\");\n  }, 100);\n\n  setTimeout(() => {\n    toast.classList.remove(\"show\");\n    setTimeout(() => {\n      if (document.body.contains(toast)) {\n        document.body.removeChild(toast);\n      }\n    }, 300);\n  }, 3000);\n}\n\n// Update notification UI when auth state changes\nwindow.addEventListener(\"hashchange\", () => {\n  setTimeout(updateNotificationUI, 100);\n  analytics.trackPageView(window.location.hash);\n});\n\n// Listen for storage changes (login/logout in other tabs)\nwindow.addEventListener(\"storage\", (e) => {\n  if (e.key === \"token\") {\n    setTimeout(updateNotificationUI, 100);\n    analytics.trackEvent(\"auth_state_changed\", {\n      source: \"storage_event\",\n    });\n  }\n});\n\n// Listen for online/offline events\nwindow.addEventListener(\"online\", () => {\n  showToast(\"Connection restored\", \"success\");\n  analytics.trackEvent(\"connection_restored\");\n});\n\nwindow.addEventListener(\"offline\", () => {\n  showToast(\"You are offline. Some features may be limited.\", \"warning\");\n  analytics.trackEvent(\"connection_lost\");\n});\n\n// Performance monitoring\nwindow.addEventListener(\"load\", () => {\n  // Measure and report performance metrics\n  setTimeout(() => {\n    const navigation = performance.getEntriesByType(\"navigation\")[0];\n    if (navigation) {\n      analytics.trackPerformance(\n        \"page_load_time\",\n        navigation.loadEventEnd - navigation.loadEventStart\n      );\n      analytics.trackPerformance(\n        \"dom_content_loaded\",\n        navigation.domContentLoadedEventEnd -\n          navigation.domContentLoadedEventStart\n      );\n    }\n  }, 0);\n});\n\n// Initialize the app\ninit();\n"],"names":["BASE_URL","VAPID_PUBLIC_KEY","handleResponse","response","data","errorMessage","register","name","email","password","error","login","addStory","description","photo","lat","lon","token","formData","addGuestStory","getStories","page","size","location","params","getStoryDetail","id","subscribeNotifications","subscription","cleanSubscription","unsubscribeFromNotifications","endpoint","triggerStoryNotification","storyData","notificationPayload","StoryModel","initMap","containerId","zoom","map","addMarker","popupText","marker","onMapClick","callback","e","lng","HomePresenter","view","createElement","tag","attributes","element","key","value","DB_NAME","DB_VERSION","STORY_STORE","initDB","openDB","db","saveStories","stories","tx","story","getStoredStories","deleteStory","HomeView","content","storyList","storyItem","btn","message","retryCallback","saveToken","getToken","removeToken","LandingView","installBtn","notNowBtn","installSection","container","StoriesView","refreshBtn","sortSelect","storiesList","sortType","storiesContainer","storyItems","a","b","dateA","dateB","item","urlBase64ToUint8Array","base64String","padding","base64","rawData","outputArray","i","isPushNotificationSupported","requestNotificationPermission","getNotificationStatus","isSupported","permission","subscribePushNotification","registration","applicationServerKey","serverError","unsubscribePushNotification","showStoryNotification","title","body","AddStoryPresenter","notificationError","startCamera","videoElement","stream","fallbackStream","fallbackError","captureImage","canvasElement","context","stopCamera","track","dataURLtoFile","dataURL","filename","arr","mimeMatch","mime","bstr","n","u8arr","AddStoryView","contentElement","video","descriptionTextarea","charCount","captureBtn","retakeBtn","useLocationBtn","cancelBtn","form","length","canvas","preview","originalText","position","resolve","reject","latitude","longitude","locationInfo","latInput","lonInput","isLoading","submitBtn","defaultText","type","DetailPresenter","DetailView","backBtn","saveFavoriteBtn","shareBtn","storyDetail","saveBtn","err","url","toast","LoginPresenter","LoginView","RegisterPresenter","loginResponse","RegisterView","SubscribeView","browserSupportEl","permissionStatusEl","subscriptionStatusEl","subscribeBtn","unsubscribeBtn","testBtn","statusIndicator","statusText","canSubscribe","FavoritesView","favoritesList","storyId","AboutView","NotFoundView","navigateWithTransition","routes","currentViewInstance","initRouter","updateNavLinks","renderPage","loginLink","logoutLink","subscribeLink","favoritesLink","userWelcome","userData","getUserData","hash","route","ViewClass","match","notFoundView","PerformanceMonitor","pageName","startTime","duration","imageObserver","entries","observer","entry","img","resource","link","entryList","lastEntry","ErrorHandler","event","_a","_b","pattern","Analytics","eventName","properties","action","metric","errorType","recentEvents","sessionDuration","pageViews","storyInteractions","errors","analytics","AccessibilityManager","mainContent","nav","firstLink","searchInput","activeElement","currentIndex","nextIndex","mutations","mutation","newContent","lastFocusedElement","modal","focusableElements","firstElement","lastElement","activeModal","index","author","button","text","icon","issues","input","styles","color","backgroundColor","accessibilityManager","performanceMonitor","errorHandler","init","pageLoadMetric","setupInstallPrompt","setupNotificationUI","wb","Workbox","showUpdateNotification","deferredPrompt","result","header","notificationContainer","notificationBtn","handleNotificationToggle","updateNotificationUI","showToast","status","updateBanner","navigation"],"mappings":"2xBAMO,MAAMA,EAAW,UAGXC,EACX,0FCPF,eAAeC,EAAeC,EAAU,CACtC,MAAMC,EAAO,MAAMD,EAAS,KAAM,EAClC,GAAI,CAACA,EAAS,GAAI,CAChB,MAAME,EAAeD,EAAK,SAAW,iBAAiBD,EAAS,MAAM,GACrE,MAAM,IAAI,MAAME,CAAY,CAChC,CACE,OAAOD,CACT,CAEO,eAAeE,EAAS,CAAE,KAAAC,EAAM,MAAAC,EAAO,SAAAC,CAAQ,EAAI,CACxD,GAAI,CACF,GAAI,CAACF,GAAQ,OAAOA,GAAS,UAAYA,EAAK,KAAI,EAAG,SAAW,EAC9D,MAAM,IAAI,MAAM,yBAAyB,EAE3C,GAAI,CAACC,GAAS,CAAC,6BAA6B,KAAKA,CAAK,EACpD,MAAM,IAAI,MAAM,mBAAmB,EAErC,GAAI,CAACC,GAAYA,EAAS,OAAS,EACjC,MAAM,IAAI,MAAM,mCAAmC,EAGrD,QAAQ,IAAI,4BAA6B,CAAE,KAAAF,EAAM,MAAAC,EAAO,SAAAC,EAAU,EAElE,MAAMN,EAAW,MAAM,MAAM,GAAGH,CAAQ,YAAa,CACnD,OAAQ,OACR,QAAS,CACP,eAAgB,kBACjB,EACD,KAAM,KAAK,UAAU,CAAE,KAAAO,EAAM,MAAAC,EAAO,SAAAC,EAAU,CACpD,CAAK,EAEKL,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,kCAAmCC,CAAI,EAC5CA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,qBAAsBA,EAAM,OAAO,EAC3C,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAEO,eAAeC,EAAM,CAAE,MAAAH,EAAO,SAAAC,GAAY,CAC/C,GAAI,CACF,GAAI,CAACD,GAAS,CAAC,6BAA6B,KAAKA,CAAK,EACpD,MAAM,IAAI,MAAM,mBAAmB,EAErC,GAAI,CAACC,GAAYA,EAAS,OAAS,EACjC,MAAM,IAAI,MAAM,mCAAmC,EAGrD,QAAQ,IAAI,uBAAwB,CAAE,MAAAD,EAAO,SAAAC,CAAQ,CAAE,EAEvD,MAAMN,EAAW,MAAM,MAAM,GAAGH,CAAQ,SAAU,CAChD,OAAQ,OACR,QAAS,CACP,eAAgB,kBACjB,EACD,KAAM,KAAK,UAAU,CAAE,MAAAQ,EAAO,SAAAC,CAAQ,CAAE,CAC9C,CAAK,EAEKL,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,+BAAgCC,CAAI,EACzCA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,oBAAqBA,EAAM,OAAO,EAC1C,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAEO,eAAeE,EAAS,CAAE,YAAAC,EAAa,MAAAC,EAAO,IAAAC,EAAK,IAAAC,EAAK,MAAAC,GAAS,CACtE,GAAI,CACF,GAAI,CAACJ,GAAeA,EAAY,KAAI,EAAG,SAAW,EAChD,MAAM,IAAI,MAAM,8BAA8B,EAEhD,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,qBAAqB,EAEvC,GAAI,CAACG,EACH,MAAM,IAAI,MAAM,sDAAsD,EAGxE,MAAMC,EAAW,IAAI,SACrBA,EAAS,OAAO,cAAeL,CAAW,EAC1CK,EAAS,OAAO,QAASJ,CAAK,EAC1BC,GAAOC,IACTE,EAAS,OAAO,MAAOH,CAAG,EAC1BG,EAAS,OAAO,MAAOF,CAAG,GAG5B,QAAQ,IAAI,wBAAyB,CAAE,YAAAH,EAAa,IAAAE,EAAK,IAAAC,EAAK,MAAAC,EAAO,EAErE,MAAMd,EAAW,MAAM,MAAM,GAAGH,CAAQ,WAAY,CAClD,OAAQ,OACR,QAAS,CACP,cAAe,UAAUiB,CAAK,EAC/B,EACD,KAAMC,CACZ,CAAK,EAEKd,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,kCAAmCC,CAAI,EAC5CA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,sBAAuBA,EAAM,OAAO,EAC5C,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAEO,eAAeS,EAAc,CAAE,YAAAN,EAAa,MAAAC,EAAO,IAAAC,EAAK,IAAAC,CAAG,EAAI,CACpE,GAAI,CACF,GAAI,CAACH,GAAeA,EAAY,KAAI,EAAG,SAAW,EAChD,MAAM,IAAI,MAAM,8BAA8B,EAEhD,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,qBAAqB,EAGvC,MAAMI,EAAW,IAAI,SACrBA,EAAS,OAAO,cAAeL,CAAW,EAC1CK,EAAS,OAAO,QAASJ,CAAK,EAC1BC,GAAOC,IACTE,EAAS,OAAO,MAAOH,CAAG,EAC1BG,EAAS,OAAO,MAAOF,CAAG,GAG5B,QAAQ,IAAI,8BAA+B,CAAE,YAAAH,EAAa,IAAAE,EAAK,IAAAC,EAAK,EAEpE,MAAMb,EAAW,MAAM,MAAM,GAAGH,CAAQ,iBAAkB,CACxD,OAAQ,OACR,KAAMkB,CACZ,CAAK,EAEKd,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,uCAAwCC,CAAI,EACjDA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,4BAA6BA,EAAM,OAAO,EAClD,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAEO,eAAeU,EAAW,CAAE,MAAAH,EAAO,KAAAI,EAAO,EAAG,KAAAC,EAAO,GAAI,SAAAC,EAAW,GAAK,CAC7E,GAAI,CACF,GAAI,CAACN,EACH,MAAM,IAAI,MAAM,sDAAsD,EAGxE,MAAMO,EAAS,IAAI,gBAAgB,CAAE,KAAAH,EAAM,KAAAC,EAAM,SAAAC,EAAU,EAC3D,QAAQ,IAAI,yCAA0CC,EAAO,SAAQ,CAAE,EAEvE,MAAMrB,EAAW,MAAM,MAAM,GAAGH,CAAQ,YAAYwB,CAAM,GAAI,CAC5D,QAAS,CACP,cAAe,UAAUP,CAAK,EAC/B,CACP,CAAK,EAEKb,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,oCAAqCC,CAAI,EAC9CA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,yBAA0BA,EAAM,OAAO,EAC/C,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAEO,eAAee,EAAeC,EAAIT,EAAO,CAC9C,GAAI,CACF,GAAI,CAACS,EACH,MAAM,IAAI,MAAM,8BAA8B,EAEhD,GAAI,CAACT,EACH,MAAM,IAAI,MAAM,sDAAsD,EAGxE,QAAQ,IAAI,qCAAsCS,CAAE,EAEpD,MAAMvB,EAAW,MAAM,MAAM,GAAGH,CAAQ,YAAY0B,CAAE,GAAI,CACxD,QAAS,CACP,cAAe,UAAUT,CAAK,EAC/B,CACP,CAAK,EAEKb,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,wCAAyCC,CAAI,EAClDA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,8BAA+BA,EAAM,OAAO,EACpD,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAGO,eAAeiB,EAAuBC,EAAcX,EAAO,CAChE,GAAI,CACF,GAAI,CAACW,EACH,MAAM,IAAI,MAAM,sCAAsC,EAExD,GAAI,CAACX,EACH,MAAM,IAAI,MAAM,sDAAsD,EAIxE,MAAMY,EAAoB,CACxB,SAAUD,EAAa,SACvB,KAAM,CACJ,OAAQA,EAAa,KAAK,OAC1B,KAAMA,EAAa,KAAK,IACzB,CACF,EAED,QAAQ,IAAI,wCAAyCC,CAAiB,EAEtE,MAAM1B,EAAW,MAAM,MAAM,GAAGH,CAAQ,2BAA4B,CAClE,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAe,UAAUiB,CAAK,EAC/B,EACD,KAAM,KAAK,UAAUY,CAAiB,CAC5C,CAAK,EAEKzB,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,gDAAiDC,CAAI,EAC1DA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,sCAAuCA,EAAM,OAAO,EAC5D,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAEO,eAAeoB,EAA6BC,EAAUd,EAAO,CAClE,GAAI,CACF,GAAI,CAACc,EACH,MAAM,IAAI,MAAM,6BAA6B,EAE/C,GAAI,CAACd,EACH,MAAM,IAAI,MAAM,sDAAsD,EAGxE,QAAQ,IAAI,0CAA2Cc,CAAQ,EAE/D,MAAM5B,EAAW,MAAM,MAAM,GAAGH,CAAQ,2BAA4B,CAClE,OAAQ,SACR,QAAS,CACP,eAAgB,mBAChB,cAAe,UAAUiB,CAAK,EAC/B,EACD,KAAM,KAAK,UAAU,CAAE,SAAAc,CAAQ,CAAE,CACvC,CAAK,EAEK3B,EAAO,MAAMF,EAAeC,CAAQ,EAC1C,eAAQ,IAAI,sDAAuDC,CAAI,EAChEA,CACR,OAAQM,EAAO,CACd,cAAQ,MAAM,0CAA2CA,EAAM,OAAO,EAChE,IAAI,MAAMA,EAAM,OAAO,CACjC,CACA,CAGO,eAAesB,EAAyBC,EAAWhB,EAAO,CAC/D,GAAI,CACF,GAAI,CAACA,EACH,MAAM,IAAI,MAAM,sDAAsD,EAGxE,MAAMiB,EAAsB,CAC1B,MAAO,mBACP,KAAM,GAAGD,EAAU,IAAI,6BAA6BA,EAAU,YAAY,UAAU,EAAG,EAAE,CAAC,MAC1F,KAAM,CACJ,QAASA,EAAU,GACnB,IAAK,aAAaA,EAAU,EAAE,EACtC,CACK,EAED,QAAQ,IAAI,iCAAkCC,CAAmB,EAEjE,MAAM/B,EAAW,MAAM,MAAM,GAAGH,CAAQ,yBAA0B,CAChE,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAe,UAAUiB,CAAK,EAC/B,EACD,KAAM,KAAK,UAAUiB,CAAmB,CAC9C,CAAK,EAID,GAAI/B,EAAS,GAAI,CACf,MAAMC,EAAO,MAAMD,EAAS,KAAM,EAClC,eAAQ,IAAI,uCAAwCC,CAAI,EACjDA,CACb,KACM,gBAAQ,KAAK,6CAA6C,EACnD,IAEV,OAAQM,EAAO,CACd,eAAQ,MAAM,uCAAwCA,EAAM,OAAO,EAE5D,IACX,CACA,CC5Se,MAAMyB,CAAW,CAC9B,MAAM,WAAW,CAAE,MAAAlB,EAAO,KAAAI,EAAO,EAAG,KAAAC,EAAO,GAAI,SAAAC,EAAW,GAAK,CAC7D,MAAMpB,EAAW,MAAMiB,EAAW,CAAE,MAAAH,EAAO,KAAAI,EAAM,KAAAC,EAAM,SAAAC,EAAU,EACjE,GAAIpB,EAAS,MAAO,MAAM,IAAI,MAAMA,EAAS,OAAO,EACpD,OAAOA,EAAS,SACpB,CAEE,MAAM,eAAeuB,EAAIT,EAAO,CAC9B,MAAMd,EAAW,MAAMsB,EAAeC,EAAIT,CAAK,EAC/C,GAAId,EAAS,MAAO,MAAM,IAAI,MAAMA,EAAS,OAAO,EACpD,OAAOA,EAAS,KACpB,CAEE,MAAM,SAAS,CAAE,YAAAU,EAAa,MAAAC,EAAO,IAAAC,EAAK,IAAAC,EAAK,MAAAC,GAAS,CACtD,MAAMd,EAAW,MAAMS,EAAS,CAAE,YAAAC,EAAa,MAAAC,EAAO,IAAAC,EAAK,IAAAC,EAAK,MAAAC,EAAO,EACvE,GAAId,EAAS,MAAO,MAAM,IAAI,MAAMA,EAAS,OAAO,EACpD,OAAOA,CACX,CAEE,MAAM,cAAc,CAAE,YAAAU,EAAa,MAAAC,EAAO,IAAAC,EAAK,IAAAC,CAAG,EAAI,CACpD,MAAMb,EAAW,MAAMgB,EAAc,CAAE,YAAAN,EAAa,MAAAC,EAAO,IAAAC,EAAK,IAAAC,EAAK,EACrE,GAAIb,EAAS,MAAO,MAAM,IAAI,MAAMA,EAAS,OAAO,EACpD,OAAOA,CACX,CACA,CCxBO,SAASiC,EAAQC,EAAatB,EAAM,KAAMC,EAAM,MAAOsB,EAAO,GAAI,CACvE,MAAMC,EAAM,EAAE,IAAIF,CAAW,EAAE,QAAQ,CAACtB,EAAKC,CAAG,EAAGsB,CAAI,EACvD,SAAE,UAAU,qDAAsD,CAChE,YACE,oFACN,CAAG,EAAE,MAAMC,CAAG,EACLA,CACT,CAEO,SAASC,EAAUD,EAAKxB,EAAKC,EAAKyB,EAAW,CAClD,MAAMC,EAAS,EAAE,OAAO,CAAC3B,EAAKC,CAAG,CAAC,EAAE,MAAMuB,CAAG,EAC7C,OAAIE,GACFC,EAAO,UAAUD,CAAS,EAAE,UAAW,EAElCC,CACT,CAEO,SAASC,EAAWJ,EAAKK,EAAU,CACxCL,EAAI,GAAG,QAAUM,GAAM,CACrB,KAAM,CAAE,IAAA9B,EAAK,IAAA+B,CAAK,EAAGD,EAAE,OACvBD,EAAS7B,EAAK+B,CAAG,CACrB,CAAG,CACH,CCrBe,MAAMC,CAAc,CACjC,YAAYC,EAAM,CAChB,KAAK,KAAOA,EACZ,KAAK,MAAQ,IAAIb,CACrB,CAEE,MAAM,aAAc,CAClB,GAAI,CACF,MAAMlB,EAAQ,aAAa,QAAQ,OAAO,EAC1C,GAAI,CAACA,EAAO,CACV,KAAK,KAAK,YAAY,iCAAkC,IAAM,CAC5D,OAAO,SAAS,KAAO,SACjC,CAAS,EACD,MACR,CAEM,MAAMd,EAAW,MAAM,KAAK,WAAWc,CAAK,EAC5C,GAAId,EAAS,MACX,MAAM,IAAI,MAAMA,EAAS,OAAO,EAGlC,KAAK,KAAK,eAAeA,CAAQ,CAClC,OAAQO,EAAO,CACd,KAAK,KAAK,YAAY,wBAAwBA,EAAM,OAAO,GAAI,IAAM,CACnE,KAAK,YAAa,CAC1B,CAAO,CACP,CACA,CAEE,MAAM,WAAWO,EAAO,CACtB,OAAO,MAAM,KAAK,MAAM,WAAW,CACjC,MAAAA,EACA,KAAM,EACN,KAAM,GACN,SAAU,CAChB,CAAK,CACL,CAEE,QAAQoB,EAAatB,EAAKC,EAAKyB,EAAW,CACxC,GAAI1B,GAAOC,EAAK,CACd,MAAMuB,EAAMH,EAAQC,EAAatB,EAAKC,EAAK,EAAE,EAC7CwB,EAAUD,EAAKxB,EAAKC,EAAKyB,CAAS,CACxC,CACA,CACA,CC/CO,SAASQ,EAAcC,EAAKC,EAAa,GAAI,CAClD,MAAMC,EAAU,SAAS,cAAcF,CAAG,EAC1C,cAAO,QAAQC,CAAU,EAAE,QAAQ,CAAC,CAACE,EAAKC,CAAK,IAAM,CACnDF,EAAQ,aAAaC,EAAKC,CAAK,CACnC,CAAG,EACMF,CACT,CCLA,MAAMG,EAAU,eACVC,EAAa,EACbC,EAAc,UAEb,eAAeC,GAAS,CAS7B,OARW,MAAMC,EAAOJ,EAASC,EAAY,CAC3C,QAAQI,EAAI,CACLA,EAAG,iBAAiB,SAASH,CAAW,GACxBG,EAAG,kBAAkBH,EAAa,CAAE,QAAS,KAAM,EAC3D,YAAY,YAAa,WAAW,CAElD,CACL,CAAG,CAEH,CAEO,eAAeI,EAAYC,EAAS,CAEzC,MAAMC,GADK,MAAML,EAAQ,GACX,YAAYD,EAAa,WAAW,EAClD,MAAM,QAAQ,IAAI,CAChB,GAAGK,EAAQ,IAAIE,GAASD,EAAG,MAAM,IAAIC,CAAK,CAAC,EAC3CD,EAAG,IACP,CAAG,CACH,CAEO,eAAeE,GAAmB,CAEvC,OADW,MAAMP,EAAQ,GACf,gBAAgBD,EAAa,WAAW,CACpD,CAEO,eAAeS,GAAYxC,EAAI,CAEpC,MADW,MAAMgC,EAAQ,GAChB,OAAOD,EAAa/B,CAAE,CACjC,CC9Be,MAAMyC,EAAS,CAC5B,aAAc,CACZ,KAAK,UAAY,IAAIpB,EAAc,IAAI,CAC3C,CAEE,MAAM,MAAO,CACX,MAAMqB,EAAUnB,EAAc,MAAO,CACnC,MAAO,iBACP,KAAM,SACN,aAAc,eACpB,CAAK,EAEDmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAUpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,EAEtD,MAAM,KAAK,UAAU,YAAa,CACtC,CAEE,eAAeN,EAAS,CACtB,MAAMO,EAAY,SAAS,eAAe,YAAY,EACtDA,EAAU,UAAY,GAEtBP,EAAQ,QAASE,GAAU,CACzB,MAAMM,EAAYrB,EAAc,MAAO,CACrC,MAAO,aACP,KAAM,SACd,CAAO,EAEDqB,EAAU,UAAY;AAAA,cACdN,EAAM,IAAI;AAAA,aACXA,EAAM,WAAW;AAAA;AAAA,iBAEbA,EAAM,QAAQ;AAAA,oCACKA,EAAM,YAAY,UAAU,EAAG,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,0BAI5C,IAAI,KAAKA,EAAM,SAAS,EAAE,mBAAmB,QAAS,CACtE,KAAM,UACN,MAAO,OACP,IAAK,SACf,CAAS,CAAC;AAAA,UAEAA,EAAM,KAAOA,EAAM,IACf;AAAA,0BACYA,EAAM,EAAE;AAAA;AAAA;AAAA;AAAA,uBAKpB,EACd;AAAA;AAAA;AAAA,6BAG6BA,EAAM,EAAE;AAAA;AAAA,mDAEcA,EAAM,IAAI;AAAA;AAAA;AAAA;AAAA,0BAInC,KAAK,UAAUA,CAAK,EAAE,QAAQ,KAAM,QAAQ,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAQjEK,EAAU,YAAYC,CAAS,EAE3BN,EAAM,KAAOA,EAAM,KACrB,KAAK,UAAU,QACb,OAAOA,EAAM,EAAE,GACfA,EAAM,IACNA,EAAM,IACNA,EAAM,IACP,CAET,CAAK,EAGD,SAAS,iBAAiB,oBAAoB,EAAE,QAAQO,GAAO,CAC7DA,EAAI,iBAAiB,QAAS,MAAO1B,GAAM,CACzC,MAAMZ,EAAY,KAAK,MAAMY,EAAE,OAAO,QAAQ,MAAM,QAAQ,UAAW,GAAG,CAAC,EAC3E,MAAM,KAAK,aAAaZ,CAAS,CACzC,CAAO,CACP,CAAK,CACL,CAEE,MAAM,aAAa+B,EAAO,CACxB,GAAI,CACF,MAAMH,EAAY,CAACG,CAAK,CAAC,EACzB,KAAK,YAAY,sCAAsC,CACxD,OAAQtD,EAAO,CACd,KAAK,YAAY,2BAA2BA,EAAM,OAAO,EAAE,CACjE,CACA,CAEE,YAAY8D,EAASC,EAAe,CAClC,MAAMJ,EAAY,SAAS,eAAe,YAAY,EAClDI,GACFJ,EAAU,UAAY;AAAA;AAAA,eAEbG,CAAO;AAAA;AAAA;AAAA,QAKhB,SACG,eAAe,WAAW,EAC1B,iBAAiB,QAASC,CAAa,GAE1C,MAAMD,CAAO,CAEnB,CACA,CCjIO,SAASE,EAAUzD,EAAO,CAC/B,aAAa,QAAQ,QAASA,CAAK,CACrC,CAEO,SAAS0D,GAAW,CACzB,OAAO,aAAa,QAAQ,OAAO,CACrC,CAEO,SAASC,IAAc,CAC5B,aAAa,WAAW,OAAO,CACjC,CCPe,MAAMC,EAAY,CAC/B,aAAc,CACZ,KAAK,cAAgB,IACzB,CAEE,MAAM,MAAO,CACX,MAAM5D,EAAQ0D,EAAU,EAElBP,EAAUnB,EAAc,MAAO,CACnC,MAAO,oBACP,KAAM,MACZ,CAAK,EAEDmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QA+DhBnD,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAUN,EAAE;AAAA,MAGR,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYmD,CAAO,EAEtD,KAAK,mBAAoB,EAErBnD,GACF,MAAM,KAAK,oBAAqB,CAEtC,CAEE,oBAAqB,CACnB,MAAM6D,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAY,SAAS,eAAe,aAAa,EACjDC,EAAiB,SAAS,cAAc,kBAAkB,EAGhE,OAAO,iBAAiB,sBAAwBnC,GAAM,CACpDA,EAAE,eAAgB,EAClB,KAAK,cAAgBA,EACrBmC,EAAe,MAAM,QAAU,OACrC,CAAK,EAEDF,EAAW,iBAAiB,QAAS,SAAY,CAC3C,KAAK,eACP,KAAK,cAAc,OAAQ,GACZ,MAAM,KAAK,cAAc,YAC7B,UAAY,aACrBE,EAAe,MAAM,QAAU,QAEjC,KAAK,cAAgB,MAGrB,KAAK,YAAY,kFAAkF,CAE3G,CAAK,EAEDD,EAAU,iBAAiB,QAAS,IAAM,CACxCC,EAAe,MAAM,QAAU,MACrC,CAAK,EAGG,OAAO,WAAW,4BAA4B,EAAE,UAClDA,EAAe,MAAM,QAAU,OAErC,CAEE,MAAM,qBAAsB,CAC1B,GAAI,CACF,MAAM/D,EAAQ0D,EAAU,EACxB,GAAI,CAAC1D,EAAO,OAQZ,MAAMb,EAAO,MANI,MAAM,MAAM,qEAAsE,CACjG,QAAS,CACP,cAAiB,UAAUa,CAAK,EAC1C,CACA,CAAO,GAE2B,KAAM,EAC9Bb,EAAK,WAAaA,EAAK,UAAU,OAAS,GAC5C,KAAK,uBAAuBA,EAAK,SAAS,CAE7C,OAAQM,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,CAC5D,CACA,CAEE,uBAAuBoD,EAAS,CAC9B,MAAMmB,EAAY,SAAS,eAAe,kBAAkB,EACvDA,IAELA,EAAU,UAAYnB,EAAQ,IAAIE,GAAS;AAAA;AAAA;AAAA,sBAGzBA,EAAM,QAAQ,UAAUA,EAAM,YAAY,UAAU,EAAG,EAAE,CAAC;AAAA;AAAA;AAAA,gBAGhEA,EAAM,IAAI;AAAA,kCACQ,IAAI,KAAKA,EAAM,SAAS,EAAE,mBAAmB,QAAS,CAC5E,KAAM,UACN,MAAO,OACP,IAAK,SACjB,CAAW,CAAC;AAAA,yCAC6BA,EAAM,YAAY,UAAU,EAAG,GAAG,CAAC;AAAA,8BAC9CA,EAAM,EAAE;AAAA;AAAA;AAAA,KAGjC,EAAE,KAAK,EAAE,EACd,CAEE,YAAYQ,EAAS,CACnB,MAAMA,CAAO,CACjB,CACA,CCpLe,MAAMU,EAAY,CAC/B,aAAc,CACZ,KAAK,UAAY,IAAInC,EAAc,IAAI,CAC3C,CAEE,MAAM,MAAO,CACX,MAAMqB,EAAUnB,EAAc,MAAO,CACnC,MAAO,yBACP,KAAM,SACN,aAAc,qBACpB,CAAK,EAEDmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAgCpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,EAEtD,KAAK,oBAAqB,EAC1B,MAAM,KAAK,UAAU,YAAa,CACtC,CAEE,qBAAsB,CACpB,MAAMe,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAa,SAAS,eAAe,aAAa,EAExDD,EAAW,iBAAiB,QAAS,IAAM,CACzC,KAAK,UAAU,YAAa,CAClC,CAAK,EAEDC,EAAW,iBAAiB,SAAWvC,GAAM,CAC3C,KAAK,YAAYA,EAAE,OAAO,KAAK,CACrC,CAAK,CACL,CAEE,eAAeiB,EAAS,CACtB,MAAMuB,EAAc,SAAS,eAAe,cAAc,EAG1D,GAFAA,EAAY,UAAY,GAEpBvB,EAAQ,SAAW,EAAG,CACxBuB,EAAY,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAQxB,MACN,CAEIvB,EAAQ,QAASE,GAAU,CACzB,MAAMM,EAAYrB,EAAc,MAAO,CACrC,MAAO,aACP,KAAM,SACd,CAAO,EAEDqB,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,gBAIZN,EAAM,KAAK,OAAO,CAAC,EAAE,YAAa,CAAA;AAAA;AAAA;AAAA,oBAG9BA,EAAM,IAAI;AAAA,sCACQ,IAAI,KAAKA,EAAM,SAAS,EAAE,mBAAmB,QAAS,CAC5E,KAAM,UACN,MAAO,OACP,IAAK,UACL,KAAM,UACN,OAAQ,SACxB,CAAe,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAMyBA,EAAM,WAAW;AAAA;AAAA,mBAEvCA,EAAM,QAAQ;AAAA,sCACKA,EAAM,YAAY,UAAU,EAAG,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAM9DA,EAAM,KAAOA,EAAM,IAAM;AAAA;AAAA;AAAA;AAAA,gCAIHA,EAAM,IAAI,QAAQ,CAAC,CAAC,KAAKA,EAAM,IAAI,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA,wBAGrDA,EAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAMpB,EAAE;AAAA;AAAA;AAAA;AAAA,6BAIeA,EAAM,EAAE;AAAA;AAAA,mDAEcA,EAAM,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAOnC,KAAK,UAAUA,CAAK,EAAE,QAAQ,KAAM,QAAQ,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QASjEqB,EAAY,YAAYf,CAAS,EAE7BN,EAAM,KAAOA,EAAM,KACrB,KAAK,UAAU,QACb,OAAOA,EAAM,EAAE,GACfA,EAAM,IACNA,EAAM,IACNA,EAAM,IACP,CAET,CAAK,EAGD,SAAS,iBAAiB,eAAe,EAAE,QAAQO,GAAO,CACxDA,EAAI,iBAAiB,QAAS,MAAO1B,GAAM,CACzC,MAAMZ,EAAY,KAAK,MAAMY,EAAE,OAAO,QAAQ,eAAe,EAAE,QAAQ,MAAM,QAAQ,UAAW,GAAG,CAAC,EACpG,MAAM,KAAK,aAAaZ,CAAS,CACzC,CAAO,CACP,CAAK,CACL,CAEE,MAAM,aAAa+B,EAAO,CACxB,GAAI,CACF,MAAMH,EAAY,CAACG,CAAK,CAAC,EACzB,KAAK,YAAY,sCAAsC,CACxD,OAAQtD,EAAO,CACd,KAAK,YAAY,2BAA2BA,EAAM,OAAO,EAAE,CACjE,CACA,CAEE,YAAY4E,EAAU,CACpB,MAAMC,EAAmB,SAAS,eAAe,cAAc,EACzDC,EAAa,MAAM,KAAKD,EAAiB,iBAAiB,aAAa,CAAC,EAE9EC,EAAW,KAAK,CAACC,EAAGC,IAAM,CACxB,MAAMC,EAAQ,IAAI,KAAKF,EAAE,cAAc,aAAa,EAAE,WAAW,EAC3DG,EAAQ,IAAI,KAAKF,EAAE,cAAc,aAAa,EAAE,WAAW,EAEjE,OAAOJ,IAAa,SAAWM,EAAQD,EAAQA,EAAQC,CAC7D,CAAK,EAEDL,EAAiB,UAAY,GAC7BC,EAAW,QAAQK,GAAQN,EAAiB,YAAYM,CAAI,CAAC,CACjE,CAEE,YAAYrB,EAASC,EAAe,CAClC,GAAIA,EAAe,CACjB,MAAMY,EAAc,SAAS,eAAe,cAAc,EAC1DA,EAAY,UAAY;AAAA;AAAA;AAAA;AAAA,eAIfb,CAAO;AAAA;AAAA;AAAA,QAKhB,SAAS,eAAe,WAAW,EAAE,iBAAiB,QAASC,CAAa,CAClF,MACM,MAAMD,CAAO,CAEnB,CACA,CCpNA,SAASsB,GAAsBC,EAAc,CAC3C,MAAMC,EAAU,IAAI,QAAQ,EAAKD,EAAa,OAAS,GAAM,CAAC,EACxDE,GAAUF,EAAeC,GAAS,QAAQ,KAAM,GAAG,EAAE,QAAQ,KAAM,GAAG,EACtEE,EAAU,OAAO,KAAKD,CAAM,EAC5BE,EAAc,IAAI,WAAWD,EAAQ,MAAM,EACjD,QAASE,EAAI,EAAGA,EAAIF,EAAQ,OAAQ,EAAEE,EACpCD,EAAYC,CAAC,EAAIF,EAAQ,WAAWE,CAAC,EAEvC,OAAOD,CACT,CAEO,SAASE,GAA8B,CAC5C,MAAO,kBAAmB,WAAa,gBAAiB,MAC1D,CAEO,eAAeC,GAAgC,CACpD,MAAM,iBAAkB,OAKL,MAAM,aAAa,kBAAmB,IACtC,WACjB,QAAQ,KAAK,gDAAgD,EACtD,IAEF,IATL,QAAQ,KAAK,yCAAyC,EAC/C,GASX,CAEO,eAAeC,GAAwB,CAC5C,MAAMC,EAAcH,EAA6B,EACjD,GAAI,CAACG,EACH,MAAO,CAAE,YAAa,GAAO,WAAY,SAAU,aAAc,EAAO,EAG1E,MAAMC,EAAa,aAAa,WAE1B7E,EAAe,MADA,MAAM,UAAU,cAAc,OACX,YAAY,gBAAiB,EAErE,MAAO,CACL,YAAA4E,EACA,WAAAC,EACA,aAAc,CAAC,CAAC7E,CACjB,CACH,CAEO,eAAe8E,EAA0BzF,EAAO,CACrD,GAAI,CAACoF,EAA2B,EAC9B,MAAM,IAAI,MAAM,kDAAkD,EAGpE,GAAI,aAAa,aAAe,SAC9B,MAAM,IAAI,MACR,4DACD,EAGH,MAAMM,EAAe,MAAM,UAAU,cAAc,MACnD,IAAI/E,EAAe,MAAM+E,EAAa,YAAY,gBAAiB,EAEnE,GAAI,CAAC/E,EAAc,CAEjB,GAAI,CADsB,MAAM0E,EAA+B,EAE7D,MAAM,IAAI,MAAM,kCAAkC,EAGpD,MAAMM,EAAuBd,GAAsB7F,CAAgB,EACnE2B,EAAe,MAAM+E,EAAa,YAAY,UAAU,CACtD,gBAAiB,GACjB,qBAAAC,CACN,CAAK,CACL,CAGE,GAAI,CAIF,aAAMjF,EAAuBC,EAAa,OAAM,EAAIX,CAAK,EACzD,QAAQ,IAAI,0CAA0C,EAC/CW,CACR,OAAQiF,EAAa,CACpB,cAAQ,MACN,yDACAA,CACD,EACD,MAAMjF,EAAa,YAAa,EAC1B,IAAI,MACR,8CAA8CiF,EAAY,OAAO,EAClE,CACL,CACA,CAEO,eAAeC,GAA4B7F,EAAO,CACvD,GAAI,CAACoF,EAA2B,EAC9B,eAAQ,KAAK,mCAAmC,EACzC,GAIT,MAAMzE,EAAe,MADA,MAAM,UAAU,cAAc,OACX,YAAY,gBAAiB,EAErE,GAAI,CAACA,EACH,eAAQ,IAAI,gDAAgD,EACrD,GAIT,GAAI,CAD6B,MAAMA,EAAa,YAAa,EAE/D,eAAQ,MAAM,6CAA6C,EACpD,GAGT,GAAI,CACF,MAAME,EAA6BF,EAAa,SAAUX,CAAK,EAC/D,QAAQ,IAAI,4CAA4C,CACzD,OAAQ4F,EAAa,CACpB,QAAQ,KACN,8DACAA,CACD,CACL,CAEE,MAAO,EACT,CAEO,eAAeE,GAAsBC,EAAOC,EAAM7G,EAAO,CAAA,EAAI,CAClE,GAAI,aAAa,aAAe,UAIhC,GAAI,CAEF,MADqB,MAAM,UAAU,cAAc,OAChC,iBAAiB4G,EAAO,CACzC,KAAAC,EACA,KAAM,0BACN,MAAO,wBACP,IAAK,qBACL,QAAS,CAAC,IAAK,IAAK,GAAG,EACvB,KAAA7G,CACN,CAAK,CACF,OAAQM,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,CACxD,CACA,CC7Ie,MAAMwG,EAAkB,CACrC,YAAYlE,EAAM,CAChB,KAAK,KAAOA,EACZ,KAAK,MAAQ,IAAIb,EACjB,KAAK,YAAc,CAAE,EACrB,KAAK,cAAgB,KACrB,KAAK,IAAM,IACf,CAEE,QAAQE,EAAa,CACnB,YAAK,IAAMD,EAAQC,CAAW,EAE9BM,EAAW,KAAK,IAAK,CAAC5B,EAAKC,IAAQ,CACjC,KAAK,eAAeD,EAAKC,CAAG,EAC5B,KAAK,KAAK,sBAAsBD,EAAKC,CAAG,CAC9C,CAAK,EAEM,KAAK,GAChB,CAEE,eAAeD,EAAKC,EAAK,CACvB,KAAK,YAAc,CAAE,IAAAD,EAAK,IAAAC,CAAK,EAC3B,KAAK,eACP,KAAK,IAAI,YAAY,KAAK,aAAa,EAEzC,KAAK,cAAgBwB,EAAU,KAAK,IAAKzB,EAAKC,EAAK,mBAAmB,CAC1E,CAEE,kBAAkBD,EAAKC,EAAK,CACtB,KAAK,MACP,KAAK,IAAI,QAAQ,CAACD,EAAKC,CAAG,EAAG,EAAE,EAC/B,KAAK,eAAeD,EAAKC,CAAG,EAElC,CAEE,gBAAiB,CACf,OAAO,KAAK,WAChB,CAME,MAAM,SAASH,EAAaC,EAAOC,EAAKC,EAAK,CAC3C,MAAMC,EAAQ0D,EAAU,EACxB,GAAI,CAAC1D,EAAO,CACV,KAAK,KAAK,YACR,4CACA,OACD,EACD,MACN,CAEI,GAAI,CAEF,KAAK,KAAK,YAAY,EAAI,EAE1B,MAAMd,EAAW,MAAM,KAAK,MAAM,SAAS,CACzC,YAAAU,EACA,MAAAC,EACA,IAAKC,GAAO,KAAK,YAAY,IAC7B,IAAKC,GAAO,KAAK,YAAY,IAC7B,MAAAC,CACR,CAAO,EAGD,MAAM8F,GACJ,6BACA,eAAelG,EAAY,UAAU,EAAG,EAAE,CAAC,uBAC5C,EAED,KAAK,KAAK,YAAY,6BAA8B,SAAS,EAG7D,OAAO,SAAS,KAAO,YAIvB,KAAK,gCAAgCI,CAAK,CAC3C,OAAQP,EAAO,CACd,KAAK,KAAK,YAAY,0BAA0BA,EAAM,OAAO,GAAI,OAAO,CAC9E,QAAc,CAER,KAAK,KAAK,YAAY,EAAK,CACjC,CACA,CAME,MAAM,gCAAgCO,EAAO,CAC3C,GAAI,CACF,QAAQ,IAAI,2DAA2D,EACvE,MAAMe,EAAyBf,CAAK,EACpC,QAAQ,IAAI,2CAA2C,CACxD,OAAQkG,EAAmB,CAE1B,QAAQ,KACN,uCACAA,EAAkB,OACnB,CACP,CACA,CACA,CCxGO,eAAeC,GAAYC,EAAc,CAC9C,GAAI,CACF,MAAMC,EAAS,MAAM,UAAU,aAAa,aAAa,CACvD,MAAO,CAAE,WAAY,aAAe,CAC1C,CAAK,EACD,OAAAD,EAAa,UAAYC,EAClBA,CACR,OAAQ5G,EAAO,CACd,GACEA,EAAM,OAAS,iBACfA,EAAM,OAAS,uBACf,CACA,QAAQ,KAAK,wDAAwD,EACrE,GAAI,CACF,MAAM6G,EAAiB,MAAM,UAAU,aAAa,aAAa,CAC/D,MAAO,EACjB,CAAS,EACD,OAAAF,EAAa,UAAYE,EAClBA,CACR,OAAQC,EAAe,CACtB,cAAQ,MAAM,mCAAoCA,CAAa,EACzDA,CACd,CACA,CACI,cAAQ,MAAM,+BAAgC9G,CAAK,EAC7CA,CACV,CACA,CAQO,SAAS+G,GAAaJ,EAAcK,EAAe,CACxD,MAAMC,EAAUD,EAAc,WAAW,IAAI,EAC7C,OAAAA,EAAc,MAAQL,EAAa,WACnCK,EAAc,OAASL,EAAa,YACpCM,EAAQ,UACNN,EACA,EACA,EACAK,EAAc,MACdA,EAAc,MACf,EACMA,EAAc,UAAU,YAAY,CAC7C,CAMO,SAASE,GAAWN,EAAQ,CAC7BA,GAAU,OAAOA,EAAO,WAAc,aACxCA,EAAO,UAAS,EAAG,QAASO,GAAUA,EAAM,MAAM,EAClD,QAAQ,IAAI,oCAAoC,EAEpD,CAQO,SAASC,GAAcC,EAASC,EAAU,CAC/C,MAAMC,EAAMF,EAAQ,MAAM,GAAG,EACvBG,EAAYD,EAAI,CAAC,EAAE,MAAM,SAAS,EACxC,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,sBAAsB,EAExC,MAAMC,EAAOD,EAAU,CAAC,EAClBE,EAAO,KAAKH,EAAI,CAAC,CAAC,EACxB,IAAII,EAAID,EAAK,OACb,MAAME,EAAQ,IAAI,WAAWD,CAAC,EAC9B,KAAOA,KACLC,EAAMD,CAAC,EAAID,EAAK,WAAWC,CAAC,EAE9B,OAAO,IAAI,KAAK,CAACC,CAAK,EAAGN,EAAU,CAAE,KAAMG,EAAM,CACnD,CC5Ee,MAAMI,EAAa,CAChC,aAAc,CACZ,KAAK,UAAY,IAAIrB,GAAkB,IAAI,EAC3C,KAAK,OAAS,KACd,KAAK,MAAQ,KACb,KAAK,aAAe,IACxB,CAEE,MAAM,MAAO,CAEX,GAAI,CADUvC,EAAU,EACZ,CACV,KAAK,YAAY,gCAAgC,EACjD,OAAO,SAAS,KAAO,UACvB,MACN,CAEI,MAAMP,EAAUnB,EAAc,MAAO,CAAE,MAAO,qBAAqB,CAAE,EACrEmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAkFpB,MAAMoE,EAAiB,SAAS,eAAe,SAAS,GAAK,SAAS,KACtEA,EAAe,UAAY,GAC3BA,EAAe,YAAYpE,CAAO,EAElC,MAAM,KAAK,eAAgB,CAC/B,CAEE,MAAM,gBAAiB,CACrB,MAAMqE,EAAQ,SAAS,eAAe,QAAQ,EAE9C,GAAI,CACF,KAAK,OAAS,MAAMrB,GAAYqB,CAAK,CACtC,OAAQ/H,EAAO,CACd,KAAK,YACH,4BAA4BA,EAAM,OAAO,kFAC1C,EACD,MACN,CAEI,KAAK,UAAU,QAAQ,KAAK,EAC5B,KAAK,oBAAqB,CAC9B,CAEE,qBAAsB,CACpB,MAAMgI,EAAsB,SAAS,eAAe,aAAa,EAC3DC,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAa,SAAS,eAAe,SAAS,EAC9CC,EAAY,SAAS,eAAe,QAAQ,EAC5CC,EAAiB,SAAS,eAAe,iBAAiB,EAC1DC,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAO,SAAS,eAAe,gBAAgB,EAErDN,EAAoB,iBAAiB,QAAU7F,GAAM,CACnD,MAAMoG,EAASpG,EAAE,OAAO,MAAM,OAC9B8F,EAAU,YAAcM,EACxBN,EAAU,MAAM,MAAQM,EAAS,IAAM,UAAY,SACzD,CAAK,EAEDL,EAAW,iBAAiB,QAAS,IAAM,CACzC,KAAK,aAAc,CACzB,CAAK,EAEDC,EAAU,iBAAiB,QAAS,IAAM,CACxC,KAAK,YAAa,CACxB,CAAK,EAEDC,EAAe,iBAAiB,QAAS,IAAM,CAC7C,KAAK,mBAAoB,CAC/B,CAAK,EAEDC,EAAU,iBAAiB,QAAS,IAAM,CAEtC,QAAQ,2DAA2D,IAEnE,KAAK,QAAO,EACZ,OAAO,SAAS,KAAO,YAE/B,CAAK,EAEDC,EAAK,iBAAiB,SAAU,MAAOnG,GAAM,CAC3CA,EAAE,eAAgB,EAClB,MAAM,KAAK,YAAa,CAC9B,CAAK,CACL,CAEE,cAAe,CACb,MAAM4F,EAAQ,SAAS,eAAe,QAAQ,EACxCS,EAAS,SAAS,eAAe,QAAQ,EACzCC,EAAU,SAAS,eAAe,SAAS,EAC3CP,EAAa,SAAS,eAAe,SAAS,EAC9CC,EAAY,SAAS,eAAe,QAAQ,EAE5Cd,EAAUN,GAAagB,EAAOS,CAAM,EAC1C,KAAK,MAAQpB,GAAcC,EAAS,WAAW,EAE/CoB,EAAQ,IAAMpB,EACdoB,EAAQ,MAAM,QAAU,QACxBV,EAAM,MAAM,QAAU,OACtBG,EAAW,MAAM,QAAU,OAC3BC,EAAU,MAAM,QAAU,aAC9B,CAEE,aAAc,CACZ,MAAMJ,EAAQ,SAAS,eAAe,QAAQ,EACxCU,EAAU,SAAS,eAAe,SAAS,EAC3CP,EAAa,SAAS,eAAe,SAAS,EAC9CC,EAAY,SAAS,eAAe,QAAQ,EAElD,KAAK,MAAQ,KACbM,EAAQ,MAAM,QAAU,OACxBV,EAAM,MAAM,QAAU,QACtBG,EAAW,MAAM,QAAU,cAC3BC,EAAU,MAAM,QAAU,MAC9B,CAEE,MAAM,oBAAqB,CACzB,MAAMC,EAAiB,SAAS,eAAe,iBAAiB,EAC1DM,EAAeN,EAAe,UAEpCA,EAAe,UACb,0DACFA,EAAe,SAAW,GAE1B,GAAI,CACF,MAAMO,EAAW,MAAM,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtD,UAAU,YAAY,mBAAmBD,EAASC,EAAQ,CACxD,mBAAoB,GACpB,QAAS,IACT,WAAY,GACtB,CAAS,CACT,CAAO,EAEK,CAAE,SAAAC,EAAU,UAAAC,CAAW,EAAGJ,EAAS,OACzC,KAAK,sBAAsBG,EAAUC,CAAS,EAC9C,KAAK,UAAU,eAAeD,EAAUC,CAAS,EACjD,KAAK,UAAU,kBAAkBD,EAAUC,CAAS,CACrD,OAAQ/I,EAAO,CACd,KAAK,YAAY,2BAA2BA,EAAM,OAAO,EAAE,CACjE,QAAc,CACRoI,EAAe,UAAYM,EAC3BN,EAAe,SAAW,EAChC,CACA,CAEE,sBAAsB/H,EAAKC,EAAK,CAC9B,MAAM0I,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAW,SAAS,eAAe,UAAU,EAC7CC,EAAW,SAAS,eAAe,WAAW,EAEpDF,EAAa,UAAY;AAAA;AAAA,8CAEiB3I,EAAI,QAAQ,CAAC,CAAC,KAAKC,EAAI,QAC/D,CACN,CAAK;AAAA,MAED0I,EAAa,UAAU,IAAI,mBAAmB,EAE9CC,EAAS,MAAQ5I,EAAI,QAAQ,CAAC,EAC9B6I,EAAS,MAAQ5I,EAAI,QAAQ,CAAC,CAClC,CAEE,MAAM,aAAc,CAClB,MAAMH,EAAc,SAAS,eAAe,aAAa,EAAE,MAAM,KAAM,EAEvE,GAAI,CAACA,EAAa,CAChB,KAAK,YAAY,mCAAmC,EACpD,MACN,CACI,GAAIA,EAAY,OAAS,IAAK,CAC5B,KAAK,YAAY,mDAAmD,EACpE,MACN,CACI,GAAI,CAAC,KAAK,MAAO,CACf,KAAK,YAAY,+BAA+B,EAChD,MACN,CAEI,KAAM,CAAE,IAAAE,EAAK,IAAAC,CAAG,EAAK,KAAK,UAAU,eAAgB,EAGpD,MAAM,KAAK,UAAU,SAASH,EAAa,KAAK,MAAOE,EAAKC,CAAG,CACnE,CASE,YAAY6I,EAAW,CACrB,MAAMC,EAAY,SAAS,cAAc,uBAAuB,EAChE,GAAKA,EAEL,GAAID,EACFC,EAAU,UAAY,iDACtBA,EAAU,SAAW,OAChB,CAEL,MAAMC,EAAc,+CACpBD,EAAU,UAAYC,EACtBD,EAAU,SAAW,EAC3B,CACA,CAME,SAAU,CACRlC,GAAW,KAAK,MAAM,CAC1B,CAEE,YAAYpD,EAASwF,EAAO,OAAQ,CAElC,QAAQ,IAAI,IAAIA,EAAK,aAAa,MAAMxF,CAAO,EAAE,EACjD,MAAMA,CAAO,CACjB,CACA,CCjTe,MAAMyF,EAAgB,CACnC,YAAYjH,EAAM,CAChB,KAAK,KAAOA,EACZ,KAAK,MAAQ,IAAIb,CACrB,CAEE,MAAM,eAAeT,EAAIT,EAAO,CAC9B,GAAI,CAEF,OADc,MAAM,KAAK,MAAM,eAAeS,EAAIT,CAAK,CAExD,OAAQP,EAAO,CACd,MAAM,IAAI,MAAM,kCAAkCA,EAAM,OAAO,EAAE,CACvE,CACA,CAEE,QAAQ2B,EAAatB,EAAKC,EAAKyB,EAAW,CACxC,GAAI1B,GAAOC,EAAK,CACd,MAAMuB,EAAMH,EAAQC,EAAatB,EAAKC,EAAK,EAAE,EAC7CwB,EAAUD,EAAKxB,EAAKC,EAAKyB,CAAS,CACxC,CACA,CACA,CCnBe,MAAMyH,EAAW,CAC9B,aAAc,CACZ,KAAK,UAAY,IAAID,GAAgB,IAAI,CAC7C,CAEE,MAAM,KAAK,CAAE,GAAAvI,GAAM,CACjB,MAAMT,EAAQ0D,EAAU,EACxB,GAAI,CAAC1D,EAAO,CACV,OAAO,SAAS,KAAO,UACvB,MACN,CAEI,MAAMmD,EAAUnB,EAAc,MAAO,CAAE,MAAO,kBAAkB,CAAE,EAClEmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA0BpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,EAEtD,KAAK,oBAAqB,EAE1B,GAAI,CACF,MAAMJ,EAAQ,MAAM,KAAK,UAAU,eAAetC,EAAIT,CAAK,EAC3D,KAAK,aAAa+C,CAAK,CACxB,OAAQtD,EAAO,CACd,KAAK,UAAUA,EAAM,OAAO,CAClC,CACA,CAEE,qBAAsB,CACpB,MAAMyJ,EAAU,SAAS,eAAe,UAAU,EAC5CC,EAAkB,SAAS,eAAe,eAAe,EACzDC,EAAW,SAAS,eAAe,aAAa,EAEtDF,EAAQ,iBAAiB,QAAS,IAAM,CACtC,OAAO,QAAQ,KAAM,CAC3B,CAAK,EAEDC,EAAgB,iBAAiB,QAAS,IAAM,CAC1C,KAAK,cACP,KAAK,aAAa,KAAK,YAAY,CAE3C,CAAK,EAEDC,EAAS,iBAAiB,QAAS,IAAM,CACnC,KAAK,cACP,KAAK,WAAW,KAAK,YAAY,CAEzC,CAAK,CACL,CAEE,aAAarG,EAAO,CAClB,KAAK,aAAeA,EACpB,MAAMsG,EAAc,SAAS,eAAe,cAAc,EAE1DA,EAAY,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,gBAKZtG,EAAM,KAAK,OAAO,CAAC,EAAE,YAAa,CAAA;AAAA;AAAA;AAAA,yCAGTA,EAAM,IAAI;AAAA,mDACAA,EAAM,SAAS;AAAA,kBAChD,IAAI,KAAKA,EAAM,SAAS,EAAE,mBAAmB,QAAS,CACtD,QAAS,OACT,KAAM,UACN,MAAO,OACP,IAAK,UACL,KAAM,UACN,OAAQ,SAC1B,CAAiB,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBASGA,EAAM,QAAQ;AAAA,oCACCA,EAAM,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAOHA,EAAM,WAAW;AAAA;AAAA;AAAA,YAGhDA,EAAM,KAAOA,EAAM,IAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CAQUA,EAAM,IAAI,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA,gDAGnBA,EAAM,IAAI,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,YAKtD,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAcRA,EAAM,KAAOA,EAAM,KACrB,WAAW,IAAM,CACf,KAAK,UAAU,QAAQ,aAAcA,EAAM,IAAKA,EAAM,IAAKA,EAAM,IAAI,CACtE,EAAE,GAAG,CAEZ,CAEE,MAAM,aAAaA,EAAO,CACxB,GAAI,CACF,MAAMH,EAAY,CAACG,CAAK,CAAC,EACzB,KAAK,YAAY,2BAA2B,EAG5C,MAAMuG,EAAU,SAAS,eAAe,eAAe,EACvDA,EAAQ,UAAY,wCACpBA,EAAQ,SAAW,GACnB,WAAW,IAAM,CACfA,EAAQ,UAAY,qDACpBA,EAAQ,SAAW,EACpB,EAAE,GAAI,CACR,OAAQ7J,EAAO,CACd,KAAK,YAAY,yBAAyBA,EAAM,OAAO,EAAE,CAC/D,CACA,CAEE,WAAWsD,EAAO,CAChB,GAAI,UAAU,MACZ,UAAU,MAAM,CACd,MAAO,YAAYA,EAAM,IAAI,GAC7B,KAAMA,EAAM,YACZ,IAAK,OAAO,SAAS,IAC7B,CAAO,EAAE,MAAMwG,GAAO,QAAQ,IAAI,iBAAkBA,CAAG,CAAC,MAC7C,CAEL,MAAMC,EAAM,OAAO,SAAS,KAC5B,UAAU,UAAU,UAAUA,CAAG,EAAE,KAAK,IAAM,CAC5C,KAAK,YAAY,iCAAiC,CAC1D,CAAO,EAAE,MAAM,IAAM,CACb,KAAK,YAAY,sDAAsD,CAC/E,CAAO,CACP,CACA,CAEE,UAAUjG,EAAS,CACjB,MAAM8F,EAAc,SAAS,eAAe,cAAc,EAC1DA,EAAY,UAAY;AAAA;AAAA;AAAA;AAAA,aAIf9F,CAAO;AAAA;AAAA;AAAA;AAAA,MAMhB,SAAS,eAAe,WAAW,EAAE,iBAAiB,QAAS,IAAM,CACnE,OAAO,SAAS,OAAQ,CAC9B,CAAK,CACL,CAEE,YAAYA,EAAS,CAEnB,MAAMkG,EAAQzH,EAAc,MAAO,CAAE,MAAO,oBAAoB,CAAE,EAClEyH,EAAM,YAAclG,EACpB,SAAS,KAAK,YAAYkG,CAAK,EAE/B,WAAW,IAAM,CACfA,EAAM,UAAU,IAAI,MAAM,CAC3B,EAAE,GAAG,EAEN,WAAW,IAAM,CACfA,EAAM,UAAU,OAAO,MAAM,EAC7B,WAAW,IAAM,CACf,SAAS,KAAK,YAAYA,CAAK,CAChC,EAAE,GAAG,CACP,EAAE,GAAI,CACX,CACA,CChOe,MAAMC,EAAe,CAClC,YAAY3H,EAAM,CAChB,KAAK,KAAOA,CAChB,CAEE,MAAM,MAAM,CAAE,MAAAxC,EAAO,SAAAC,GAAY,CAC/B,GAAI,CACF,MAAMN,EAAW,MAAMQ,EAAM,CAAE,MAAAH,EAAO,SAAAC,CAAQ,CAAE,EAChD,GAAIN,EAAS,MAAO,MAAM,IAAI,MAAMA,EAAS,OAAO,EAEpDuE,EAAUvE,EAAS,YAAY,KAAK,EAGpC,aAAa,QAAQ,WAAY,KAAK,UAAU,CAC9C,KAAMA,EAAS,YAAY,MAAQK,EAAM,MAAM,GAAG,EAAE,CAAC,EACrD,MAAOA,CACf,CAAO,CAAC,EAEF,KAAK,KAAK,YAAY,iBAAiB,EACvC,OAAO,SAAS,KAAO,IACxB,OAAQE,EAAO,CACVA,EAAM,UAAY,iBACpB,KAAK,KAAK,YACR,+DACD,EAED,KAAK,KAAK,YAAY,gBAAgBA,EAAM,OAAO,EAAE,CAE7D,CACA,CACA,CC9Be,MAAMkK,EAAU,CAC7B,aAAc,CACZ,KAAK,UAAY,IAAID,GAAe,IAAI,CAC5C,CAEE,MAAM,MAAO,CACX,MAAMvG,EAAUnB,EAAc,MAAO,CAAE,MAAO,gBAAgB,CAAE,EAChEmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAepB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,EAEtD,SACG,eAAe,YAAY,EAC3B,iBAAiB,SAAU,MAAOvB,GAAM,CACvCA,EAAE,eAAgB,EAClB,MAAMrC,EAAQ,SAAS,eAAe,OAAO,EAAE,MACzCC,EAAW,SAAS,eAAe,UAAU,EAAE,MACrD,MAAM,KAAK,UAAU,MAAM,CAAE,MAAAD,EAAO,SAAAC,CAAQ,CAAE,CACtD,CAAO,CACP,CAEE,YAAY+D,EAAS,CACnB,MAAMA,CAAO,CACjB,CACA,CCrCe,MAAMqG,EAAkB,CACrC,YAAY7H,EAAM,CAChB,KAAK,KAAOA,CAChB,CAEE,MAAM,SAAS,CAAE,KAAAzC,EAAM,MAAAC,EAAO,SAAAC,CAAQ,EAAI,CACxC,GAAI,CACF,MAAMN,EAAW,MAAMG,EAAS,CAAE,KAAAC,EAAM,MAAAC,EAAO,SAAAC,EAAU,EACzD,GAAIN,EAAS,MAAO,MAAM,IAAI,MAAMA,EAAS,OAAO,EAEpD,MAAM2K,EAAgB,MAAMnK,EAAM,CAAE,MAAAH,EAAO,SAAAC,CAAQ,CAAE,EACrDiE,EAAUoG,EAAc,YAAY,KAAK,EAGzC,aAAa,QAAQ,WAAY,KAAK,UAAU,CAC9C,KAAMvK,EACN,MAAOC,CACf,CAAO,CAAC,EAEF,KAAK,KAAK,YAAY,wCAAwC,EAC9D,OAAO,SAAS,KAAO,IACxB,OAAQE,EAAO,CACVA,EAAM,UAAY,yBACpB,KAAK,KAAK,YACR,+DACD,EACQA,EAAM,UAAY,qCAC3B,KAAK,KAAK,YACR,oDACD,EAED,KAAK,KAAK,YAAY,qBAAqBA,EAAM,OAAO,EAAE,CAElE,CACA,CACA,CCpCe,MAAMqK,EAAa,CAChC,aAAc,CACZ,KAAK,UAAY,IAAIF,GAAkB,IAAI,CAC/C,CAEE,MAAM,MAAO,CACX,MAAMzG,EAAUnB,EAAc,MAAO,CAAE,MAAO,gBAAgB,CAAE,EAChEmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAmBpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,EAEtD,SACG,eAAe,eAAe,EAC9B,iBAAiB,SAAU,MAAOvB,GAAM,CACvCA,EAAE,eAAgB,EAClB,MAAMtC,EAAO,SAAS,eAAe,MAAM,EAAE,MAAM,KAAM,EACnDC,EAAQ,SAAS,eAAe,OAAO,EAAE,MAAM,KAAM,EACrDC,EAAW,SAAS,eAAe,UAAU,EAAE,MAErD,GAAI,CAACF,GAAQ,CAACC,GAAS,CAACC,EAAU,CAChC,KAAK,YAAY,0BAA0B,EAC3C,MACV,CACQ,MAAM,KAAK,UAAU,SAAS,CAAE,KAAAF,EAAM,MAAAC,EAAO,SAAAC,EAAU,CAC/D,CAAO,CACP,CAEE,YAAY+D,EAAS,CACnB,MAAMA,CAAO,CACjB,CACA,CC/Ce,MAAMwG,EAAc,CACjC,aAAc,CACZ,KAAK,aAAe,GACpB,KAAK,aAAe,IACxB,CAEE,MAAM,MAAO,CACX,MAAM/J,EAAQ0D,EAAU,EACxB,GAAI,CAAC1D,EAAO,CACV,KAAK,YAAY,qBAAqB,EACtC,OAAO,SAAS,KAAO,UACvB,MACN,CAEI,MAAMmD,EAAUnB,EAAc,MAAO,CAAE,MAAO,qBAAqB,CAAE,EACrEmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA4FpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,EAEtD,MAAM,KAAK,uBAAuBnD,CAAK,CAC3C,CAEE,MAAM,uBAAuBA,EAAO,CAElC,KAAK,oBAAqB,EAG1B,MAAM,KAAK,sBAAuB,EAGlC,MAAM,KAAK,wBAAyB,EAGpC,KAAK,oBAAoBA,CAAK,EAG9B,KAAK,SAAU,CACnB,CAEE,qBAAsB,CACpB,MAAMgK,EAAmB,SAAS,eAAe,iBAAiB,EAE9D,kBAAmB,WAAa,gBAAiB,QACnDA,EAAiB,YAAc,cAC/BA,EAAiB,UAAY,yBAE7BA,EAAiB,YAAc,kBAC/BA,EAAiB,UAAY,qBAEnC,CAEE,MAAM,uBAAwB,CAC5B,MAAMC,EAAqB,SAAS,eAAe,mBAAmB,EAEtE,GAAI,iBAAkB,OAEpB,OADmB,aAAa,WACd,CAChB,IAAK,UACHA,EAAmB,YAAc,YACjCA,EAAmB,UAAY,uBAC/B,MACF,IAAK,SACHA,EAAmB,YAAc,WACjCA,EAAmB,UAAY,qBAC/B,MACF,QACEA,EAAmB,YAAc,kBACjCA,EAAmB,UAAY,sBACzC,MAEMA,EAAmB,YAAc,kBACjCA,EAAmB,UAAY,oBAErC,CAEE,MAAM,yBAA0B,CAC9B,MAAMC,EAAuB,SAAS,eAAe,qBAAqB,EAE1E,GAAI,kBAAmB,WAAa,gBAAiB,OACnD,GAAI,CACF,MAAMxE,EAAe,MAAM,UAAU,cAAc,MACnD,KAAK,aAAe,MAAMA,EAAa,YAAY,gBAAiB,EAEhE,KAAK,cACP,KAAK,aAAe,GACpBwE,EAAqB,YAAc,WACnCA,EAAqB,UAAY,yBAEjC,KAAK,aAAe,GACpBA,EAAqB,YAAc,mBACnCA,EAAqB,UAAY,qBAEpC,OAAQzK,EAAO,CACd,QAAQ,MAAM,sCAAuCA,CAAK,EAC1DyK,EAAqB,YAAc,UACnCA,EAAqB,UAAY,oBACzC,MAEMA,EAAqB,YAAc,kBACnCA,EAAqB,UAAY,oBAEvC,CAEE,oBAAoBlK,EAAO,CACzB,MAAMmK,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAiB,SAAS,eAAe,iBAAiB,EAC1DC,EAAU,SAAS,eAAe,uBAAuB,EAE/DF,EAAa,iBAAiB,QAAS,SAAY,CACjD,MAAM,KAAK,gBAAgBnK,CAAK,CACtC,CAAK,EAEDoK,EAAe,iBAAiB,QAAS,SAAY,CACnD,MAAM,KAAK,kBAAmB,CACpC,CAAK,EAEDC,EAAQ,iBAAiB,QAAS,IAAM,CACtC,KAAK,iBAAkB,CAC7B,CAAK,CACL,CAEE,MAAM,gBAAgBrK,EAAO,CAC3B,MAAMmK,EAAe,SAAS,eAAe,eAAe,EACtDhC,EAAegC,EAAa,UAElCA,EAAa,UAAY,qDACzBA,EAAa,SAAW,GAExB,GAAI,CAEF,GAAI,CADkB,MAAM9E,EAA+B,EACvC,CAClB,KAAK,YAAY,mDAAmD,EACpE,MACR,CAEM,MAAMI,EAA0BzF,CAAK,EACrC,KAAK,aAAe,GACpB,MAAM,KAAK,wBAAyB,EACpC,KAAK,SAAU,EACf,KAAK,YAAY,2CAA2C,CAC7D,OAAQP,EAAO,CACd,QAAQ,MAAM,sBAAuBA,CAAK,EAC1C,KAAK,YAAY,wBAAwBA,EAAM,OAAO,EAAE,CAC9D,QAAc,CACR0K,EAAa,UAAYhC,EACzBgC,EAAa,SAAW,EAC9B,CACA,CAEE,MAAM,mBAAoB,CACxB,MAAMC,EAAiB,SAAS,eAAe,iBAAiB,EAC1DjC,EAAeiC,EAAe,UAEpCA,EAAe,UAAY,uDAC3BA,EAAe,SAAW,GAE1B,GAAI,CACE,KAAK,eACP,MAAM,KAAK,aAAa,YAAa,EACrC,KAAK,aAAe,GACpB,KAAK,aAAe,KACpB,MAAM,KAAK,wBAAyB,EACpC,KAAK,SAAU,EACf,KAAK,YAAY,+CAA+C,EAEnE,OAAQ3K,EAAO,CACd,QAAQ,MAAM,wBAAyBA,CAAK,EAC5C,KAAK,YAAY,0BAA0BA,EAAM,OAAO,EAAE,CAChE,QAAc,CACR2K,EAAe,UAAYjC,EAC3BiC,EAAe,SAAW,EAChC,CACA,CAEE,kBAAmB,CACb,aAAa,aAAe,UAC9B,IAAI,aAAa,oBAAqB,CACpC,KAAM,6CACN,KAAM,0BACN,MAAO,uBACf,CAAO,EAED,KAAK,YAAY,0DAA0D,CAEjF,CAEE,UAAW,CACT,MAAME,EAAkB,SAAS,eAAe,kBAAkB,EAC5DC,EAAa,SAAS,eAAe,aAAa,EAClDJ,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAiB,SAAS,eAAe,iBAAiB,EAC1DC,EAAU,SAAS,eAAe,uBAAuB,EAEzDG,EAAe,kBAAmB,WACpB,gBAAiB,QACjB,aAAa,aAAe,SAE5C,KAAK,cACPF,EAAgB,UAAY,0BAC5BC,EAAW,YAAc,SACzBJ,EAAa,MAAM,QAAU,OAC7BC,EAAe,MAAM,QAAU,cAC/BC,EAAQ,MAAM,QAAU,eACfG,GACTF,EAAgB,UAAY,4BAC5BC,EAAW,YAAc,iBACzBJ,EAAa,MAAM,QAAU,cAC7BC,EAAe,MAAM,QAAU,OAC/BC,EAAQ,MAAM,QAAU,SAExBC,EAAgB,UAAY,yBAC5BC,EAAW,YAAc,gBACzBJ,EAAa,MAAM,QAAU,OAC7BC,EAAe,MAAM,QAAU,OAC/BC,EAAQ,MAAM,QAAU,OAE9B,CAEE,YAAY9G,EAAS,CAEnB,MAAMkG,EAAQzH,EAAc,MAAO,CAAE,MAAO,oBAAoB,CAAE,EAClEyH,EAAM,YAAclG,EACpB,SAAS,KAAK,YAAYkG,CAAK,EAE/B,WAAW,IAAM,CACfA,EAAM,UAAU,IAAI,MAAM,CAC3B,EAAE,GAAG,EAEN,WAAW,IAAM,CACfA,EAAM,UAAU,OAAO,MAAM,EAC7B,WAAW,IAAM,CACf,SAAS,KAAK,YAAYA,CAAK,CAChC,EAAE,GAAG,CACP,EAAE,GAAI,CACX,CACA,CCtUe,MAAMgB,EAAc,CACjC,aAAc,CACZ,KAAK,QAAU,CAAE,CACrB,CAEE,MAAM,MAAO,CACX,MAAMtH,EAAUnB,EAAc,MAAO,CACnC,MAAO,iBACP,KAAM,SACN,aAAc,gBACpB,CAAK,EAEDmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MASpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,EAEtD,MAAM,KAAK,cAAe,CAC9B,CAEE,MAAM,eAAgB,CACpB,GAAI,CACF,KAAK,QAAU,MAAMH,EAAkB,EACvC,KAAK,eAAgB,CACtB,OAAQvD,EAAO,CACd,KAAK,YAAY,gCAAgCA,EAAM,OAAO,EAAE,CACtE,CACA,CAEE,gBAAiB,CACf,MAAMiL,EAAgB,SAAS,eAAe,gBAAgB,EAE9D,GAAI,KAAK,QAAQ,SAAW,EAAG,CAC7BA,EAAc,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,QAM1B,MACN,CAEIA,EAAc,UAAY,GAE1B,KAAK,QAAQ,QAAS3H,GAAU,CAC9B,MAAMM,EAAYrB,EAAc,MAAO,CACrC,MAAO,aACP,KAAM,SACd,CAAO,EAEDqB,EAAU,UAAY;AAAA,cACdN,EAAM,IAAI;AAAA,aACXA,EAAM,WAAW;AAAA;AAAA,iBAEbA,EAAM,QAAQ;AAAA,oCACKA,EAAM,YAAY,UAAU,EAAG,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,0BAI5C,IAAI,KAAKA,EAAM,SAAS,EAAE,mBAAmB,QAAS,CACtE,KAAM,UACN,MAAO,OACP,IAAK,SACf,CAAS,CAAC;AAAA,UAEAA,EAAM,KAAOA,EAAM,IACf;AAAA,0BACYA,EAAM,EAAE;AAAA;AAAA;AAAA;AAAA,uBAKpB,EACd;AAAA;AAAA;AAAA;AAAA,6BAI6BA,EAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAQ/B2H,EAAc,YAAYrH,CAAS,EAE/BN,EAAM,KAAOA,EAAM,KACrB,KAAK,QAAQ,OAAOA,EAAM,EAAE,GAAIA,EAAM,IAAKA,EAAM,IAAKA,EAAM,IAAI,CAExE,CAAK,EAGD,SAAS,iBAAiB,sBAAsB,EAAE,QAAQO,GAAO,CAC/DA,EAAI,iBAAiB,QAAS,MAAO1B,GAAM,CACzC,MAAM+I,EAAU/I,EAAE,OAAO,QAAQ,QACjC,MAAM,KAAK,eAAe+I,CAAO,CACzC,CAAO,CACP,CAAK,CACL,CAEE,MAAM,eAAeA,EAAS,CAC5B,GAAI,CACF,MAAM1H,GAAY0H,CAAO,EACzB,MAAM,KAAK,gBACX,KAAK,YAAY,uCAAuC,CACzD,OAAQlL,EAAO,CACd,KAAK,YAAY,2BAA2BA,EAAM,OAAO,EAAE,CACjE,CACA,CAEE,QAAQ2B,EAAatB,EAAKC,EAAKyB,EAAW,CACxC,GAAI1B,GAAOC,EAAK,CACd,MAAMuB,EAAMH,EAAQC,EAAatB,EAAKC,EAAK,EAAE,EAC7CwB,EAAUD,EAAKxB,EAAKC,EAAKyB,CAAS,CACxC,CACA,CAEE,YAAY+B,EAAS,CACnB,MAAMA,CAAO,CACjB,CACA,CClIe,MAAMqH,EAAU,CAC7B,MAAM,MAAO,CACX,MAAMzH,EAAUnB,EAAc,MAAO,CACnC,MAAO,kBACP,KAAM,MACZ,CAAK,EAEDmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAoJpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,CAC1D,CACA,CC/Je,MAAM0H,CAAa,CAChC,MAAO,CACL,MAAM1H,EAAUnB,EAAc,MAAO,CAAE,MAAO,qBAAqB,CAAE,EACrEmB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA,MAKpB,SAAS,eAAe,SAAS,EAAE,UAAY,GAC/C,SAAS,eAAe,SAAS,EAAE,YAAYA,CAAO,CAC1D,CACA,CCZO,SAAS2H,EAAuBnJ,EAAU,CAC/C,MAAMwB,EAAU,SAAS,eAAe,SAAS,EACjDA,EAAQ,MAAM,QAAU,IACxB,WAAW,IAAM,CACfxB,EAAU,EACVwB,EAAQ,MAAM,QAAU,GACzB,EAAE,GAAG,CACR,CCQA,MAAM4H,EAAS,CACb,KAAMnH,GACN,SAAUV,GACV,YAAae,GACb,cAAeqD,GACf,eAAgB2B,GAChB,UAAWU,GACX,aAAcG,GACd,cAAeC,GACf,cAAeU,GACf,UAAWG,GACX,QAASC,CACX,EAKA,IAAIG,EAAsB,KAEnB,SAASC,IAAa,CAC3BC,EAAgB,EAChB,OAAO,iBAAiB,aAAc,IAAM,CAC1CA,EAAgB,EAChBC,EAAY,CAChB,CAAG,EACD,OAAO,iBAAiB,OAAQ,IAAM,CACpCD,EAAgB,EAChBC,EAAY,CAChB,CAAG,EAED,SAAS,eAAe,aAAa,EAAE,iBAAiB,QAAUvJ,GAAM,CACtEA,EAAE,eAAgB,EAClB+B,GAAa,EACbuH,EAAgB,EAChB,OAAO,SAAS,KAAO,SAC3B,CAAG,CACH,CAEA,SAASA,GAAiB,CAExB,MAAMlL,EAAQ0D,EAAU,EAClB0H,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAgB,SAAS,eAAe,gBAAgB,EACxDC,EAAgB,SAAS,eAAe,gBAAgB,EACxDC,EAAc,SAAS,eAAe,cAAc,EAE1D,GAAIxL,GAMF,GALAoL,EAAU,MAAM,QAAU,OAC1BC,EAAW,MAAM,QAAU,SACvBC,IAAeA,EAAc,MAAM,QAAU,UAC7CC,IAAeA,EAAc,MAAM,QAAU,UAE7CC,EAAa,CACf,MAAMC,EAAWC,GAAa,EAC9BF,EAAY,YAAc,OAAOC,EAAS,MAAQ,MAAM,GACxDD,EAAY,MAAM,QAAU,QAClC,OAEIJ,EAAU,MAAM,QAAU,SAC1BC,EAAW,MAAM,QAAU,OACvBC,IAAeA,EAAc,MAAM,QAAU,QAC7CC,IAAeA,EAAc,MAAM,QAAU,QAC7CC,IAAaA,EAAY,MAAM,QAAU,OAEjD,CAEA,SAASE,IAAc,CAErB,GAAI,CACF,MAAMD,EAAW,aAAa,QAAQ,UAAU,EAChD,OAAOA,EAAW,KAAK,MAAMA,CAAQ,EAAI,CAAE,KAAM,MAAQ,CAC1D,MAAe,CACd,MAAO,CAAE,KAAM,MAAQ,CAC3B,CACA,CAEA,SAASN,GAAa,CAKlBH,GACA,OAAOA,EAAoB,SAAY,YAEvCA,EAAoB,QAAS,EAI/B,MAAMW,EAAO,OAAO,SAAS,MAAQ,KAC/BC,EAAQ,OAAO,KAAKb,CAAM,EAAE,KAAM3I,GACxB,IAAI,OAAO,IAAIA,EAAI,QAAQ,MAAO,SAAS,CAAC,GAAG,EAChD,KAAKuJ,CAAI,CACvB,EAED,GAAIC,EAAO,CACT,MAAMC,EAAYd,EAAOa,CAAK,EACxB7J,EAAO,IAAI8J,EAKjB,GAFAb,EAAsBjJ,EAElB6J,IAAU,eAAgB,CAC5B,MAAME,EAAQH,EAAK,MACjB,IAAI,OAAO,IAAIC,EAAM,QAAQ,MAAO,SAAS,CAAC,GAAG,CAClD,EACKnL,EAAKqL,EAAQA,EAAM,CAAC,EAAI,KAC9BhB,EAAuB,IAAM/I,EAAK,KAAK,CAAE,GAAAtB,CAAI,CAAA,CAAC,CACpD,MACMqK,EAAuB,IAAM/I,EAAK,MAAM,CAE9C,KAAS,CACL,MAAMgK,EAAe,IAAIlB,EACzBG,EAAsBe,EACtB,OAAO,SAAS,KAAO,QACvBjB,EAAuB,IAAMiB,EAAa,MAAM,CACpD,CACA,CCpIO,MAAMC,EAAmB,CAC9B,aAAc,CACZ,KAAK,QAAU,IAAI,IACnB,KAAK,UAAY,IAAI,GACzB,CAGE,gBAAgBC,EAAU,CACxB,MAAMC,EAAY,YAAY,IAAK,EAEnC,MAAO,CACL,IAAK,IAAM,CAET,MAAMC,EADU,YAAY,IAAK,EACND,EAC3B,YAAK,QAAQ,IAAI,aAAaD,CAAQ,GAAIE,CAAQ,EAClD,QAAQ,IAAI,QAAQF,CAAQ,cAAcE,EAAS,QAAQ,CAAC,CAAC,IAAI,EAC1DA,CACf,CACK,CACL,CAGE,gBAAiB,CACf,GAAI,yBAA0B,OAAQ,CACpC,MAAMC,EAAgB,IAAI,qBAAqB,CAACC,EAASC,IAAa,CACpED,EAAQ,QAAQE,GAAS,CACvB,GAAIA,EAAM,eAAgB,CACxB,MAAMC,EAAMD,EAAM,OAClBC,EAAI,IAAMA,EAAI,QAAQ,IACtBA,EAAI,UAAU,OAAO,MAAM,EAC3BF,EAAS,UAAUE,CAAG,CAClC,CACA,CAAS,CACT,CAAO,EAED,SAAS,iBAAiB,eAAe,EAAE,QAAQA,GAAO,CACxDJ,EAAc,QAAQI,CAAG,CACjC,CAAO,CACP,CACA,CAGE,0BAA2B,CACC,CACxB,yBACA,mDACA,gFACD,EAEiB,QAAQC,GAAY,CACpC,MAAMC,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,IAAM,UACXA,EAAK,GAAKD,EAAS,SAAS,MAAM,EAAI,QAAU,SAChDC,EAAK,KAAOD,EACZ,SAAS,KAAK,YAAYC,CAAI,CACpC,CAAK,CACL,CAGE,kBAAmB,CAEb,wBAAyB,SACP,IAAI,oBAAqBC,GAAc,CACzD,MAAMN,EAAUM,EAAU,WAAY,EAChCC,EAAYP,EAAQA,EAAQ,OAAS,CAAC,EAC5C,QAAQ,IAAI,OAAQO,EAAU,SAAS,CAC/C,CAAO,EACW,QAAQ,CAAE,WAAY,CAAC,0BAA0B,CAAC,CAAE,EAG5C,IAAI,oBAAqBD,GAAc,CACzCA,EAAU,WAAY,EAC9B,QAAQJ,GAAS,CACvB,QAAQ,IAAI,OAAQA,EAAM,gBAAkBA,EAAM,SAAS,CACrE,CAAS,CACT,CAAO,EACW,QAAQ,CAAE,WAAY,CAAC,aAAa,CAAC,CAAE,EAEzD,CAGE,YAAa,CACX,OAAO,OAAO,YAAY,KAAK,OAAO,CAC1C,CACA,CCpFO,MAAMM,EAAa,CACxB,aAAc,CACZ,KAAK,yBAA0B,EAC/B,KAAK,WAAa,CAAE,EACpB,KAAK,UAAY,EACrB,CAEE,0BAA2B,CAEzB,OAAO,iBAAiB,QAAUC,GAAU,OAC1C,KAAK,SAAS,CACZ,KAAM,aACN,QAASA,EAAM,QACf,SAAUA,EAAM,SAChB,OAAQA,EAAM,OACd,MAAOA,EAAM,MACb,OAAOC,EAAAD,EAAM,QAAN,YAAAC,EAAa,MACpB,UAAW,IAAI,KAAI,EAAG,YAAW,CACzC,CAAO,CACP,CAAK,EAGD,OAAO,iBAAiB,qBAAuBD,GAAU,SACvD,KAAK,SAAS,CACZ,KAAM,UACN,UAASC,EAAAD,EAAM,SAAN,YAAAC,EAAc,UAAW,8BAClC,OAAOC,EAAAF,EAAM,SAAN,YAAAE,EAAc,MACrB,UAAW,IAAI,KAAI,EAAG,YAAW,CACzC,CAAO,CACP,CAAK,EAGD,OAAO,iBAAiB,UAAW,IAAM,CACvC,KAAK,sBAAsB,8CAA8C,CAC/E,CAAK,EAED,OAAO,iBAAiB,SAAU,IAAM,CACtC,KAAK,wBAAwB,sBAAsB,CACzD,CAAK,CACL,CAEE,SAASvN,EAAO,CACd,QAAQ,MAAM,gBAAiBA,CAAK,EAGpC,KAAK,WAAW,KAAKA,CAAK,EAGtB,KAAK,WAAW,OAAS,KAAK,WAChC,KAAK,WAAW,MAAO,EAIzB,GAAI,CACF,aAAa,QAAQ,aAAc,KAAK,UAAU,KAAK,WAAW,MAAM,GAAG,CAAC,CAAC,CAC9E,MAAW,CAEhB,CAGQ,KAAK,gBAAgBA,CAAK,GAC5B,KAAK,sBAAsB,uDAAuD,CAExF,CAEE,gBAAgBA,EAAO,CASrB,MARyB,CACvB,WACA,SACA,OACA,kBACA,gBACD,EAEuB,KAAKwN,GAC3BA,EAAQ,KAAKxN,EAAM,OAAO,GAAKwN,EAAQ,KAAKxN,EAAM,OAAS,EAAE,CAC9D,CACL,CAEE,sBAAsB8D,EAAS,CAC7B,KAAK,UAAUA,EAAS,OAAO,CACnC,CAEE,wBAAwBA,EAAS,CAC/B,KAAK,UAAUA,EAAS,SAAS,CACrC,CAEE,UAAUA,EAASwF,EAAO,OAAQ,CAChC,MAAMU,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,sBAAsBV,CAAI,GAC5CU,EAAM,YAAclG,EAEpB,SAAS,KAAK,YAAYkG,CAAK,EAE/B,WAAW,IAAMA,EAAM,UAAU,IAAI,MAAM,EAAG,GAAG,EAEjD,WAAW,IAAM,CACfA,EAAM,UAAU,OAAO,MAAM,EAC7B,WAAW,IAAM,CACX,SAAS,KAAK,SAASA,CAAK,GAC9B,SAAS,KAAK,YAAYA,CAAK,CAElC,EAAE,GAAG,CACP,EAAE,GAAI,CACX,CAGE,iBAAkB,CAChB,OAAO,KAAK,UAChB,CAGE,aAAc,CACZ,KAAK,WAAa,CAAE,EACpB,aAAa,WAAW,YAAY,CACxC,CACA,CCpHO,MAAMyD,EAAU,CACrB,aAAc,CACZ,KAAK,OAAS,CAAE,EAChB,KAAK,UAAY,KAAK,kBAAmB,EACzC,KAAK,UAAY,KAAK,IAAK,CAC/B,CAEE,mBAAoB,CAClB,MAAO,WAAa,KAAK,IAAK,EAAG,IAAM,KAAK,OAAQ,EAAC,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,CACjF,CAGE,cAAc9M,EAAM,CAClB,KAAK,WAAW,YAAa,CAC3B,KAAAA,EACA,UAAW,KAAK,IAAK,EACrB,WAAY,KAAK,SACvB,CAAK,CACL,CAGE,WAAW+M,EAAWC,EAAa,GAAI,OACrC,MAAMN,EAAQ,CACZ,MAAOK,EACP,WAAY,CACV,GAAGC,EACH,UAAW,KAAK,IAAK,EACrB,WAAY,KAAK,UACjB,WAAY,UAAU,UACtB,SAAU,GAAG,OAAO,UAAU,IAAI,OAAO,WAAW,GACpD,aAAYL,EAAA,UAAU,aAAV,YAAAA,EAAsB,gBAAiB,SAC3D,CACK,EAED,KAAK,OAAO,KAAKD,CAAK,EACtB,QAAQ,IAAI,mBAAoBA,CAAK,EAGjC,KAAK,OAAO,OAAS,KACvB,KAAK,OAAO,MAAO,EAIrB,KAAK,YAAa,CACtB,CAGE,sBAAsBO,EAAQ1C,EAAS,CACrC,KAAK,WAAW,oBAAqB,CACnC,OAAA0C,EACA,SAAU1C,CAChB,CAAK,CACL,CAGE,iBAAiB2C,EAAQjL,EAAO,CAC9B,KAAK,WAAW,cAAe,CAC7B,OAAAiL,EACA,MAAAjL,EACA,KAAM,OAAO,SAAS,IAC5B,CAAK,CACL,CAGE,WAAWkL,EAAWhK,EAAS,CAC7B,KAAK,WAAW,QAAS,CACvB,KAAMgK,EACN,QAAShK,EAAQ,UAAU,EAAG,GAAG,EACjC,KAAM,OAAO,SAAS,IAC5B,CAAK,CACL,CAGE,aAAc,CACZ,GAAI,CACF,MAAMiK,EAAe,KAAK,OAAO,MAAM,GAAG,EAC1C,aAAa,QAAQ,mBAAoB,KAAK,UAAUA,CAAY,CAAC,CACtE,OAAQ/N,EAAO,CACd,QAAQ,KAAK,oCAAqCA,CAAK,CAC7D,CACA,CAGE,qBAAsB,CACpB,MAAMgO,EAAkB,KAAK,IAAK,EAAG,KAAK,UACpCC,EAAY,KAAK,OAAO,OAAO9L,GAAKA,EAAE,QAAU,WAAW,EAAE,OAC7D+L,EAAoB,KAAK,OAAO,OAAO/L,GAAKA,EAAE,QAAU,mBAAmB,EAAE,OAC7EgM,EAAS,KAAK,OAAO,OAAOhM,GAAKA,EAAE,QAAU,OAAO,EAAE,OAE5D,MAAO,CACL,WAAY,KAAK,UACjB,iBAAkB6L,EAClB,WAAYC,EACZ,mBAAoBC,EACpB,OAAQC,EACR,aAAc,KAAK,OAAO,MAC3B,CACL,CAGE,YAAa,CACX,MAAO,CACL,QAAS,KAAK,oBAAqB,EACnC,OAAQ,KAAK,OAAO,IAAId,IAAU,CAChC,GAAGA,EACH,WAAY,CACV,GAAGA,EAAM,WAET,WAAY,MACtB,CACA,EAAQ,CACH,CACL,CACA,CAGO,MAAMe,EAAY,IAAIX,GAG7B,OAAO,iBAAiB,aAAc,IAAM,CAC1CW,EAAU,cAAc,OAAO,SAAS,IAAI,CAC9C,CAAC,EAGD,OAAO,iBAAiB,sBAAuB,IAAM,CACnDA,EAAU,WAAW,sBAAsB,CAC7C,CAAC,EAGD,OAAO,iBAAiB,mBAAoB,IAAM,CAC5C,SAAS,OACXA,EAAU,WAAW,kBAAkB,EAEvCA,EAAU,WAAW,kBAAkB,CAE3C,CAAC,ECvIM,MAAMC,EAAqB,CAChC,aAAc,CACZ,KAAK,wBAAyB,EAC9B,KAAK,yBAA0B,EAC/B,KAAK,qBAAsB,EAC3B,KAAK,4BAA6B,CACtC,CAEE,yBAA0B,CAExB,SAAS,iBAAiB,UAAYhB,GAAU,CAE9C,GAAIA,EAAM,QAAUA,EAAM,MAAQ,IAAK,CACrCA,EAAM,eAAgB,EACtB,MAAMiB,EAAc,SAAS,eAAe,cAAc,EACtDA,IACFA,EAAY,MAAO,EACnB,KAAK,uBAAuB,wBAAwB,EAE9D,CAGM,GAAIjB,EAAM,QAAUA,EAAM,MAAQ,IAAK,CACrCA,EAAM,eAAgB,EACtB,MAAMkB,EAAM,SAAS,cAAc,KAAK,EACxC,GAAIA,EAAK,CACP,MAAMC,EAAYD,EAAI,cAAc,GAAG,EACnCC,IACFA,EAAU,MAAO,EACjB,KAAK,uBAAuB,yBAAyB,EAEjE,CACA,CAGM,GAAInB,EAAM,QAAUA,EAAM,MAAQ,IAAK,CACrCA,EAAM,eAAgB,EAEtB,MAAMoB,EAAc,SAAS,cAAc,sBAAsB,EAC7DA,IACFA,EAAY,MAAO,EACnB,KAAK,uBAAuB,gBAAgB,EAEtD,CAGUpB,EAAM,MAAQ,UAChB,KAAK,iBAAkB,CAE/B,CAAK,EAGD,KAAK,oBAAqB,CAC9B,CAEE,qBAAsB,CACpB,SAAS,iBAAiB,UAAYA,GAAU,CAC9C,MAAMqB,EAAgB,SAAS,cACzB5J,EAAa,MAAM,KAAK,SAAS,iBAAiB,aAAa,CAAC,EAEtE,GAAIA,EAAW,SAAS4J,CAAa,EAAG,CACtC,MAAMC,EAAe7J,EAAW,QAAQ4J,CAAa,EACrD,IAAIE,EAAYD,EAEhB,OAAQtB,EAAM,IAAG,CACf,IAAK,aACHuB,EAAY,KAAK,IAAID,EAAe,EAAG7J,EAAW,OAAS,CAAC,EAC5D,MACF,IAAK,YACH8J,EAAY,KAAK,IAAID,EAAe,EAAG,CAAC,EACxC,MACF,IAAK,YAEHC,EAAY,KAAK,IAAID,EAAe,EAAG7J,EAAW,OAAS,CAAC,EAC5D,MACF,IAAK,UAEH8J,EAAY,KAAK,IAAID,EAAe,EAAG,CAAC,EACxC,MACF,QACE,MACZ,CAEYC,IAAcD,IAChBtB,EAAM,eAAgB,EACtBvI,EAAW8J,CAAS,EAAE,MAAO,EAEvC,CACA,CAAK,CACL,CAEE,0BAA2B,CAEzB,KAAK,WAAa,SAAS,cAAc,KAAK,EAC9C,KAAK,WAAW,aAAa,YAAa,QAAQ,EAClD,KAAK,WAAW,aAAa,cAAe,MAAM,EAClD,KAAK,WAAW,UAAY,UAC5B,KAAK,WAAW,MAAM,QAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAWhC,SAAS,KAAK,YAAY,KAAK,UAAU,EAGzC,KAAK,mBAAoB,CAC7B,CAEE,oBAAqB,CACnB,MAAM/B,EAAW,IAAI,iBAAkBgC,GAAc,CACnDA,EAAU,QAASC,GAAa,CAC9B,GAAIA,EAAS,OAAS,aAAeA,EAAS,OAAO,KAAO,UAAW,CACrE,MAAMC,EAAaD,EAAS,OAAO,cAAc,QAAQ,EACrDC,GACF,WAAW,IAAM,CACf,KAAK,uBAAuB,gBAAgBA,EAAW,WAAW,EAAE,CACrE,EAAE,GAAG,CAElB,CACA,CAAO,CACP,CAAK,EAEKjH,EAAiB,SAAS,eAAe,SAAS,EACpDA,GACF+E,EAAS,QAAQ/E,EAAgB,CAAE,UAAW,GAAM,QAAS,GAAM,CAEzE,CAEE,uBAAuBhE,EAAS,CAC1B,KAAK,aACP,KAAK,WAAW,YAAcA,EAE9B,WAAW,IAAM,CACf,KAAK,WAAW,YAAc,EAC/B,EAAE,GAAI,EAEb,CAEE,sBAAuB,CAErB,IAAIkL,EAAqB,KAEzB,SAAS,iBAAiB,UAAY3B,GAAU,CAC9C2B,EAAqB3B,EAAM,MACjC,CAAK,EAGD,KAAK,aAAe,IAAM,CACpB2B,GAAsB,SAAS,SAASA,CAAkB,GAC5DA,EAAmB,MAAO,CAE7B,EAGD,KAAK,eAAgB,CACzB,CAEE,gBAAiB,CACf,SAAS,iBAAiB,UAAY3B,GAAU,CAC9C,GAAIA,EAAM,MAAQ,MAAO,CACvB,MAAM4B,EAAQ,SAAS,cAAc,sBAAsB,EAC3D,GAAIA,EAAO,CACT,MAAMC,EAAoBD,EAAM,iBAC9B,0EACD,EAED,GAAIC,EAAkB,SAAW,EAAG,OAEpC,MAAMC,EAAeD,EAAkB,CAAC,EAClCE,EAAcF,EAAkBA,EAAkB,OAAS,CAAC,EAE9D7B,EAAM,SACJ,SAAS,gBAAkB8B,IAC7B9B,EAAM,eAAgB,EACtB+B,EAAY,MAAO,GAGjB,SAAS,gBAAkBA,IAC7B/B,EAAM,eAAgB,EACtB8B,EAAa,MAAO,EAGlC,CACA,CACA,CAAK,CACL,CAEE,6BAA8B,CAExB,OAAO,WAAW,0BAA0B,EAAE,SAChD,SAAS,KAAK,UAAU,IAAI,eAAe,EAIzC,OAAO,WAAW,kCAAkC,EAAE,SACxD,SAAS,KAAK,UAAU,IAAI,gBAAgB,EAI9C,OAAO,WAAW,0BAA0B,EAAE,iBAAiB,SAAW,GAAM,CAC9E,SAAS,KAAK,UAAU,OAAO,gBAAiB,EAAE,OAAO,CAC/D,CAAK,EAED,OAAO,WAAW,kCAAkC,EAAE,iBAAiB,SAAW,GAAM,CACtF,SAAS,KAAK,UAAU,OAAO,iBAAkB,EAAE,OAAO,CAChE,CAAK,CACL,CAEE,kBAAmB,CACjB,MAAME,EAAc,SAAS,cAAc,sBAAsB,EAC7DA,IACFA,EAAY,OAAS,GACrB,KAAK,aAAc,EACnB,KAAK,uBAAuB,cAAc,EAEhD,CAGE,mBAAoB,CAElB,SAAS,iBAAiB,aAAa,EAAE,QAAQ,CAAClK,EAAMmK,IAAU,SAChE,GAAI,CAACnK,EAAK,aAAa,YAAY,EAAG,CACpC,MAAMmB,IAAQgH,EAAAnI,EAAK,cAAc,IAAI,IAAvB,YAAAmI,EAA0B,cAAe,QACjDiC,IAAShC,EAAApI,EAAK,cAAc,iBAAiB,IAApC,YAAAoI,EAAuC,cAAe,iBACrEpI,EAAK,aAAa,aAAc,SAASmK,EAAQ,CAAC,KAAKhJ,CAAK,OAAOiJ,CAAM,EAAE,CACnF,CACA,CAAK,EAGD,SAAS,iBAAiB,0BAA0B,EAAE,QAAQC,GAAU,OACtE,MAAMC,EAAOD,EAAO,YAAY,KAAM,EAChCE,GAAOpC,EAAAkC,EAAO,cAAc,WAAW,IAAhC,YAAAlC,EAAmC,YAC5CmC,EACFD,EAAO,aAAa,aAAcC,CAAI,EAC7BC,GACTF,EAAO,aAAa,aAAc,eAAeE,CAAI,OAAO,CAEpE,CAAK,CACL,CAGE,oBAAqB,CACnB,MAAMC,EAAS,CAAE,EAGjB,gBAAS,iBAAiB,gBAAgB,EAAE,QAAQ5C,GAAO,CACzD4C,EAAO,KAAK,2BAA2B5C,EAAI,GAAG,EAAE,CACtD,CAAK,EAGD,SAAS,iBAAiB,gDAAgD,EAAE,QAAQ6C,GAAS,CAC7E,SAAS,cAAc,cAAcA,EAAM,EAAE,IAAI,GAE7DD,EAAO,KAAK,wBAAwBC,EAAM,IAAI,QAAQ,CAE9D,CAAK,EAGgB,SAAS,iBAAiB,wBAAwB,EACtD,SAAW,GACtBD,EAAO,KAAK,gCAAgC,EAI9C,KAAK,mBAAmBA,CAAM,EAEvBA,CACX,CAEE,mBAAmBA,EAAQ,CAER,SAAS,iBAAiB,GAAG,EACrC,QAAQjN,GAAW,CAC1B,MAAMmN,EAAS,OAAO,iBAAiBnN,CAAO,EACxCoN,EAAQD,EAAO,MACfE,EAAkBF,EAAO,gBAG3BC,IAAU,sBAAwBC,IAAoB,sBACxDJ,EAAO,KAAK,0DAA0D,CAE9E,CAAK,CACL,CACA,CAGO,MAAMK,GAAuB,IAAI3B,GAGlCxB,GAAW,IAAI,iBAAiB,IAAM,CAC1CmD,GAAqB,kBAAmB,CAC1C,CAAC,EAEDnD,GAAS,QAAQ,SAAS,KAAM,CAAE,UAAW,GAAM,QAAS,GAAM,EC5RlE,MAAMoD,EAAqB,IAAI1D,GACzB2D,GAAe,IAAI9C,GAEzB,eAAe+C,IAAO,CACpB,MAAMC,EAAiBH,EAAmB,gBAAgB,UAAU,EAEpE,GAAI,CAeF,GAbA,MAAMjN,EAAQ,EACdwI,GAAY,EAGZ6E,GAAoB,EACpBC,GAAqB,EAGrBL,EAAmB,yBAA0B,EAC7CA,EAAmB,eAAgB,EACnCA,EAAmB,iBAAkB,EAGjC,kBAAmB,UAAW,CAChC,MAAMM,EAAK,IAAIC,EAAQ,QAAQ,EAE/BD,EAAG,iBAAiB,YAAclD,GAAU,CACtCA,EAAM,UACRoD,EAAuBF,CAAE,EAE3BnC,EAAU,WAAW,eAAgB,CAAE,SAAUf,EAAM,SAAU,CACzE,CAAO,EAEDkD,EAAG,iBAAiB,UAAYlD,GAAU,CACxCoD,EAAuBF,CAAE,EACzBnC,EAAU,WAAW,YAAY,CACzC,CAAO,EAEDmC,EAAG,iBAAiB,cAAgBlD,GAAU,CAC5C,OAAO,SAAS,OAAQ,EACxBe,EAAU,WAAW,gBAAgB,CAC7C,CAAO,EAEDmC,EAAG,SAAU,CACnB,CAGInC,EAAU,WAAW,iBAAiB,CACvC,OAAQpO,EAAO,CACdkQ,GAAa,SAAS,CACpB,KAAM,iBACN,QAASlQ,EAAM,QACf,MAAOA,EAAM,MACb,UAAW,IAAI,KAAM,EAAC,YAAa,CACzC,CAAK,CACL,QAAY,CACRoQ,EAAe,IAAK,CACxB,CACA,CAEA,SAASC,IAAqB,CAC5B,IAAIK,EACJ,MAAMtM,EAAa,SAAS,eAAe,iBAAiB,EAE5D,OAAO,iBAAiB,sBAAwBjC,GAAM,CACpDA,EAAE,eAAgB,EAClBuO,EAAiBvO,EAEbiC,IACFA,EAAW,MAAM,QAAU,QAG7BgK,EAAU,WAAW,0BAA0B,CACnD,CAAG,EAEGhK,GACFA,EAAW,iBAAiB,QAAS,SAAY,CAC/C,GAAIsM,EAAgB,CAClBA,EAAe,OAAQ,EACvB,MAAMC,EAAS,MAAMD,EAAe,WAEpCtC,EAAU,WAAW,wBAAyB,CAC5C,QAASuC,EAAO,OAC1B,CAAS,EAEGA,EAAO,UAAY,aACrBvM,EAAW,MAAM,QAAU,QAE7BsM,EAAiB,IACzB,CACA,CAAK,EAIC,OAAO,WAAW,4BAA4B,EAAE,UAC9CtM,IACFA,EAAW,MAAM,QAAU,QAE7BgK,EAAU,WAAW,wBAAwB,EAEjD,CAEA,SAASkC,IAAsB,CAC7B,MAAMM,EAAS,SAAS,cAAc,eAAe,EACrD,GAAI,CAACA,EAAQ,OAGb,MAAMC,EAAwB,SAAS,cAAc,IAAI,EACzDA,EAAsB,GAAK,yBAC3BA,EAAsB,MAAM,QAAU,OAEtC,MAAMC,EAAkB,SAAS,cAAc,QAAQ,EACvDA,EAAgB,GAAK,mBACrBA,EAAgB,UAAY,mBAC5BA,EAAgB,UACd,8EACFA,EAAgB,aAAa,aAAc,2BAA2B,EAEtED,EAAsB,YAAYC,CAAe,EAGjD,MAAM1M,EAAa,SAAS,eAAe,iBAAiB,EACxDA,GAAcA,EAAW,cAC3BwM,EAAO,aAAaC,EAAuBzM,EAAW,aAAa,EAEnEwM,EAAO,YAAYC,CAAqB,EAI1CC,EAAgB,iBAAiB,QAASC,EAAwB,EAGlEC,EAAsB,CACxB,CAEA,eAAeD,IAA2B,CACxC,MAAMxQ,EAAQ0D,EAAU,EACxB,GAAI,CAAC1D,EAAO,CACV0Q,EAAU,6CAA8C,SAAS,EACjE,OAAO,SAAS,KAAO,UACvB,MACJ,CAEE,MAAMH,EAAkB,SAAS,eAAe,kBAAkB,EAClE,GAAKA,EAEL,GAAI,CACFA,EAAgB,UACd,oDACFA,EAAgB,SAAW,IAEZ,MAAMjL,EAAuB,GAEjC,cAET,MAAMO,GAA4B7F,CAAK,EACvC0Q,EAAU,sCAAuC,SAAS,EAC1D7C,EAAU,WAAW,wBAAwB,IAG7C,MAAMpI,EAA0BzF,CAAK,EACrC0Q,EAAU,qCAAsC,SAAS,EACzD7C,EAAU,WAAW,uBAAuB,EAE/C,OAAQpO,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,EACpDiR,EAAU,UAAUjR,EAAM,OAAO,GAAI,OAAO,EAC5CoO,EAAU,WAAW,4BAA6B,CAChD,MAAOpO,EAAM,OACnB,CAAK,CACL,QAAY,CAGR,MAAMgR,EAAsB,CAChC,CACA,CAEA,eAAeA,GAAuB,CACpC,MAAMH,EAAwB,SAAS,eACrC,wBACD,EACKC,EAAkB,SAAS,eAAe,kBAAkB,EAElE,GAAI,GAACD,GAAyB,CAACC,GAE/B,GAAI,CACF,MAAMI,EAAS,MAAMrL,EAAuB,EAC9B5B,EAAU,GAGXiN,EAAO,aAClBL,EAAsB,MAAM,QAAU,QACtCC,EAAgB,SAAW,GAEvBI,EAAO,cACTJ,EAAgB,UACd,wEACFA,EAAgB,UAAY,8BAC5BA,EAAgB,aACd,aACA,4BACD,GACQI,EAAO,aAAe,UAC/BJ,EAAgB,UACd,uEACFA,EAAgB,UAAY,gCAC5BA,EAAgB,aAAa,aAAc,2BAA2B,IAEtEA,EAAgB,UACd,wEACFA,EAAgB,UAAY,2BAC5BA,EAAgB,aACd,aACA,2CACD,EACDA,EAAgB,SAAW,KAG7BD,EAAsB,MAAM,QAAU,MAEzC,OAAQ7Q,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,EACtD6Q,EAAsB,MAAM,QAAU,MAC1C,CACA,CAEA,SAASJ,EAAuBF,EAAI,CAClC,MAAMY,EAAe,SAAS,cAAc,KAAK,EACjDA,EAAa,UAAY,gBACzBA,EAAa,aAAa,OAAQ,OAAO,EACzCA,EAAa,aAAa,YAAa,WAAW,EAClDA,EAAa,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQzB,SAAS,KAAK,YAAYA,CAAY,EAEtC,SAAS,eAAe,YAAY,EAAE,iBAAiB,QAAS,IAAM,CACpEZ,EAAG,mBAAoB,EACvBY,EAAa,OAAQ,EACrB/C,EAAU,WAAW,qBAAqB,CAC9C,CAAG,EAED,SAAS,eAAe,gBAAgB,EAAE,iBAAiB,QAAS,IAAM,CACxE+C,EAAa,OAAQ,EACrB/C,EAAU,WAAW,sBAAsB,CAC/C,CAAG,CACH,CAEA,SAAS6C,EAAUnN,EAASwF,EAAO,UAAW,CAC5C,MAAMU,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UAAY,sBAAsBV,CAAI,GAC5CU,EAAM,YAAclG,EACpBkG,EAAM,aAAa,OAAQ,OAAO,EAClCA,EAAM,aAAa,YAAa,QAAQ,EAExC,SAAS,KAAK,YAAYA,CAAK,EAE/B,WAAW,IAAM,CACfA,EAAM,UAAU,IAAI,MAAM,CAC3B,EAAE,GAAG,EAEN,WAAW,IAAM,CACfA,EAAM,UAAU,OAAO,MAAM,EAC7B,WAAW,IAAM,CACX,SAAS,KAAK,SAASA,CAAK,GAC9B,SAAS,KAAK,YAAYA,CAAK,CAElC,EAAE,GAAG,CACP,EAAE,GAAI,CACT,CAGA,OAAO,iBAAiB,aAAc,IAAM,CAC1C,WAAWgH,EAAsB,GAAG,EACpC5C,EAAU,cAAc,OAAO,SAAS,IAAI,CAC9C,CAAC,EAGD,OAAO,iBAAiB,UAAYjM,GAAM,CACpCA,EAAE,MAAQ,UACZ,WAAW6O,EAAsB,GAAG,EACpC5C,EAAU,WAAW,qBAAsB,CACzC,OAAQ,eACd,CAAK,EAEL,CAAC,EAGD,OAAO,iBAAiB,SAAU,IAAM,CACtC6C,EAAU,sBAAuB,SAAS,EAC1C7C,EAAU,WAAW,qBAAqB,CAC5C,CAAC,EAED,OAAO,iBAAiB,UAAW,IAAM,CACvC6C,EAAU,iDAAkD,SAAS,EACrE7C,EAAU,WAAW,iBAAiB,CACxC,CAAC,EAGD,OAAO,iBAAiB,OAAQ,IAAM,CAEpC,WAAW,IAAM,CACf,MAAMgD,EAAa,YAAY,iBAAiB,YAAY,EAAE,CAAC,EAC3DA,IACFhD,EAAU,iBACR,iBACAgD,EAAW,aAAeA,EAAW,cACtC,EACDhD,EAAU,iBACR,qBACAgD,EAAW,yBACTA,EAAW,0BACd,EAEJ,EAAE,CAAC,CACN,CAAC,EAGDjB,GAAM"}